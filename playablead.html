<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <style>
        /* 1. Reset & Variables */
        :root {
            --color-bg: #f5f7fa;
            --color-panel-bg: #ffffff;
            --color-border: #e0e3eb;
            --color-text-primary: #333333;
            --color-text-secondary: #7f8c8d;
            --color-primary: #3498db;
            --color-primary-dark: #2980b9;
            --color-success: #2ecc71;
            --color-danger: #e74c3c;
            /* V10.0: Define neutral color for Close All button */
            --color-neutral-bg: #95a5a6;
            --color-warning: #f1c40f;
            --font-main: 'Helvetica Neue', Arial, sans-serif;
            --shadow-main: 0 4px 12px rgba(0, 0, 0, 0.05);
            --radius-main: 8px;

            /* Chart Specific */
            --chart-bg: #ffffff;
            --chart-grid: #f0f0f0;
            --chart-date-separator: #cccccc;
            --chart-crosshair: #777777;
            --color-bull: #26a69a;
            --color-bear: #ef5350;

            /* V9.0: Layout variables */
            --side-panel-width: 320px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-main);
            background-color: var(--color-bg);
            color: var(--color-text-primary);
            /* V9.0: Ensure body takes full height and is structured for the app layout */
            display: flex;
            flex-direction: column;
            /* V10.0: Use dvh for better mobile viewport handling, fallback to 100vh */
            height: 100dvh;
            /* Fallback for older browsers */
            @supports not (height: 100dvh) {
                height: 100vh;
            }
            overflow: hidden;
        }

        /* 2. Layout Structure (V10.0 Overhaul - Dynamic Grid/Flex Hybrid) */
        .header {
            background-color: var(--color-panel-bg);
            padding: 8px 15px; 
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            z-index: 10;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0; /* Prevent shrinking */
            /* V9.0 (R1): Implement flex-wrap for natural responsiveness */
            flex-wrap: wrap;
            gap: 5px 15px; /* row-gap column-gap */
        }

        /* V10.0: New main container structure */
        .main-container-v9 {
            /* V10.0 Mobile (Default): Use Grid for dynamic chart height */
            /* Chart Row: flexible (1fr), minimum 200px. Bottom Content Row: auto height */
            display: grid;
            grid-template-rows: minmax(200px, 1fr) auto;
            /* flex-direction: column; <-- Removed */
            flex: 1;
            overflow: hidden;
            min-height: 0; 
        }

        /* V10.0: Chart container takes flexible space (within grid track) */
        .chart-container-v9 {
            /* flex: 1; <-- Removed, managed by grid */
            display: flex;
            flex-direction: column;
            overflow: hidden;
            padding: 10px;
            /* min-height: 200px; <-- Managed by grid minmax */
        }
        
        /* V10.0: Bottom Content Area (Tabs content) */
        .bottom-content-v9 {
            background-color: var(--color-panel-bg);
            border-top: 1px solid var(--color-border);
            display: flex;
            flex-direction: column;
            /* flex-shrink: 0; <-- Removed, managed by grid */
            /* V10.0 Mobile (Default): Height is 'auto' based on grid track */
            /* height: 35vh; <-- Removed */
            /* max-height: 400px; <-- Removed */
        }

        /* V10.0: Ensure the Positions/History tab doesn't become excessively tall on mobile when active */
        #tabPositionsHistory {
             /* Limit height on mobile to ensure chart visibility, allows internal scrolling */
             max-height: 50vh;
        }
        
        /* V9.0: Bottom Navigation Bar */
        .bottom-nav-bar-v9 {
            background-color: var(--color-panel-bg);
            /* border-top: 1px solid var(--color-border); <-- Moved to bottom-content-v9 */
            flex-shrink: 0;
            z-index: 30;
            display: flex;
            /* box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.05); <-- Removed shadow as it's no longer floating */
            /* Safe area padding moved to the new footer */
            /* padding-bottom: env(safe-area-inset-bottom); <-- Removed */
        }

        .nav-btn-v9 {
            flex: 1;
            padding: 12px 10px;
            text-align: center;
            cursor: pointer;
            background: none;
            border: none;
            font-size: 16px;
            color: var(--color-text-secondary);
            transition: color 0.2s, background-color 0.2s;
        }

        .nav-btn-v9.active {
            color: var(--color-primary);
            font-weight: bold;
            /* V9.0 Mobile (Default): Top border indicator */
            box-shadow: inset 0 2px 0 0 var(--color-primary);
        }

        .nav-btn-v9:hover {
            background-color: var(--color-bg);
        }

        /* V9.0: Tab Content Management */
        .tab-content-v9 {
            display: none;
            flex-direction: column;
            /* flex: 1; <-- Removed by default in V10.0 for content-based height on mobile */
            overflow: hidden;
        }

        .tab-content-v9.active {
            display: flex;
        }

        /* V9.0: Specific styles for Ordering Tab content */
        #tabOrder {
            /* V9.0 Mobile (Default): Padding and centering */
            padding: 10px;
            gap: 8px;
            /* justify-content: center; <-- Removed in V10.0 as height is now content-based */
        }

        /* V10.0: Footer Advertisement Styling */
        .footer-ad {
            background-color: var(--color-panel-bg);
            color: var(--color-text-secondary);
            text-align: center;
            padding: 5px 10px;
            font-size: 12px;
            border-top: 1px solid var(--color-border);
            flex-shrink: 0; /* Prevent shrinking */
            /* Ensure visibility on iOS devices with safe area, combining padding and safe area */
            padding-bottom: max(5px, env(safe-area-inset-bottom));
        }

        /* V10.1: Footer Ad Link Styling */
        .footer-ad a {
            color: inherit; /* Make the link the same color as the surrounding text */
            text-decoration: none; /* Remove default underline */
        }
        .footer-ad a:hover {
             text-decoration: underline; /* Add underline on hover for clarity */
        }

        /* ------------------------------------------------- */
        /* Desktop Responsiveness Adjustments (V10.0 Overhaul) */
        /* ------------------------------------------------- */
        @media (min-width: 901px) {
            /* V10.0 Desktop: Switch to a side-by-side layout (Using Flex) */
            .main-container-v9 {
                display: flex;
                flex-direction: row; 
                /* Reset grid properties */
                grid-template-rows: unset;
            }

            .chart-container-v9 {
                padding-right: 0; /* No padding on the right side where the panel is */
                /* Restore flex behavior for desktop */
                flex: 1;
            }

            /* V10.0 Desktop: Bottom Content becomes the Side Panel */
            .bottom-content-v9 {
                width: var(--side-panel-width);
                height: auto; /* Full height of the container */
                /* max-height: none; */
                border-top: none;
                border-left: 1px solid var(--color-border);
                padding: 10px 0;
                /* Restore flex-shrink for desktop */
                flex-shrink: 0;
            }

            #tabPositionsHistory {
                /* Reset mobile constraint */
                max-height: none;
                /* Allow it to fill the side panel height */
                flex: 1;
            }

            /* V9.0 Desktop: Bottom Nav Bar becomes Top Tab Selector in the Side Panel */
            .bottom-nav-bar-v9 {
                /* Reset bottom bar styles */
                box-shadow: none;
                /* padding-bottom: 0; */
                border-top: none;
                /* Apply styles similar to the existing panel-tabs */
                border-bottom: 1px solid var(--color-border);
            }

            .nav-btn-v9 {
                /* Adjust button styles to look like tabs */
                padding: 12px;
                font-size: 14px;
                background-color: var(--color-bg);
            }
            
            .nav-btn-v9.active {
                background-color: var(--color-panel-bg);
                /* Switch indicator from top border to bottom border */
                box-shadow: inset 0 -2px 0 0 var(--color-primary);
            }

            /* V10.0 Desktop: Adjust ordering tab padding and alignment */
            #tabOrder {
                padding: 20px;
                gap: 15px;
                justify-content: flex-start;
            }
        }


        /* Mobile Responsiveness Adjustments (V9.0 Inherited from V8.0) */
        @media (max-width: 900px) {

            .chart-container-v9 {
                /* V9.0: Chart takes full width on mobile, reduced padding */
                padding: 5px;
            }

            .header {
                padding: 6px 10px;
            }
            .hud, .hud-right {
                gap: 10px;
            }
            .hud-value {
                font-size: 14px;
            }
            .progress-container {
                width: 80px;
            }
        }

        /* 3. Header (HUD) Components (V9.0 R1 Update) */
        .hud {
            display: flex;
            gap: 15px; 
            align-items: center;
            /* V9.0 (R1): Allow wrapping */
            flex-wrap: wrap;
        }

        .hud-item {
            display: flex;
            flex-direction: column;
        }

        .hud-label {
            font-size: 11px;
            color: var(--color-text-secondary);
        }

        .hud-value {
            font-size: 15px;
            font-weight: bold;
        }

        .timer-warning {
            color: var(--color-danger);
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.1);
            }
            100% {
                transform: scale(1);
            }
        }

        #hud-pl.positive { color: var(--color-success); }
        #hud-pl.negative { color: var(--color-danger); }

        .hud-right {
            display: flex;
            gap: 15px;
            align-items: center;
            /* V9.0 (R1): Allow wrapping */
            flex-wrap: wrap;
        }

        .progress-container {
            width: 120px;
        }

        .progress-bar {
            height: 6px;
            background-color: var(--color-border);
            border-radius: 3px;
            overflow: hidden;
            margin-top: 3px;
        }

        .progress-fill {
            height: 100%;
            width: 0%;
            background-color: var(--color-primary);
            transition: width 0.3s ease;
        }

        /* 4. Chart Components (V11.0 Updates) */
        .chart-wrap {
            position: relative;
            flex: 1;
            background-color: var(--chart-bg);
            border-radius: var(--radius-main);
            box-shadow: var(--shadow-main);
            overflow: hidden;
            cursor: crosshair;
            /* V11.0: Crucial for preventing default browser zoom/pan behavior (Feature 3) */
            touch-action: none; 
        }

        #chartCanvas {
            position: absolute;
            top: 0;
            left: 0;
        }

        .chart-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .position-line {
            position: absolute;
            left: 0;
            display: flex;
            align-items: center;
            pointer-events: none;
            transition: opacity 0.2s;
        }

        .position-line-dash {
            flex: 1;
            height: 1px;
            border-top-style: dashed;
            border-top-width: 1px;
        }

        .position-label {
            padding: 3px 6px;
            font-size: 12px;
            border-radius: 3px;
            color: white;
            font-weight: bold;
            margin-left: 5px;
            margin-right: 5px;
            white-space: nowrap;
        }

        .position-pl {
            padding: 3px 6px;
            font-size: 12px;
            border-radius: 3px;
            background-color: rgba(255, 255, 255, 0.9);
            margin-right: 5px;
            font-weight: bold;
            box-shadow: var(--shadow-main);
        }

        /* 5. Controls & Toolbar (V11.0 Updates) */
        
        .controls-overlay-container {
            position: absolute;
            top: 10px;
            left: 10px;
            right: 10px;
            z-index: 5;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            pointer-events: none;
        }

        .controls {
            display: flex;
            align-items: center;
            gap: 10px;
            pointer-events: auto;
            /* V11.0: Use slightly transparent background and backdrop filter (Feature 2) */
            background-color: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(5px); 
            padding: 8px;
            border-radius: var(--radius-main);
            box-shadow: var(--shadow-main);
            /* V11.0: Transition for opacity changes */
            transition: opacity 0.3s ease, background-color 0.3s ease;
        }
        
        /* V11.0: Styling for collapsed state (Feature 2) */
        .controls-collapsed {
            /* Reduce opacity when collapsed (Using 0.6 for slightly better visibility than 0.5) */
            opacity: 0.6;
            /* Reduce background intensity */
            background-color: rgba(255, 255, 255, 0.5);
            /* Apply specific blur as requested */
            backdrop-filter: blur(2px);
        }

        /* V11.0: Restore opacity on hover or focus, even when collapsed (Feature 2) */
        .controls:hover,
        .controls:focus-within {
            opacity: 1;
            background-color: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(5px);
        }

        .collapsible-controls {
            display: flex;
            gap: 10px;
            transition: max-width 0.4s ease, opacity 0.4s ease, margin-left 0.4s ease, padding-left 0.4s ease, border-left-width 0.4s ease;
            overflow: hidden;
            max-width: 500px;
            opacity: 1;
            /* V9.0: Added separator only when expanded */
        }

        .controls-left:not(.controls-collapsed) .collapsible-controls {
            border-left: 1px solid var(--color-border); 
            padding-left: 10px;
            margin-left: 5px;
        }

        .controls-collapsed .collapsible-controls {
            max-width: 0;
            opacity: 0;
            margin-left: 0; 
            padding-left: 0;
            border-left-width: 0;
        }
        
        .btn-toggle-controls {
            font-size: 12px;
            padding: 4px 8px;
            min-height: 28px;
        }

        .btn {
            padding: 8px 12px;
            border: none;
            border-radius: var(--radius-main);
            cursor: pointer;
            font-weight: bold;
            transition: transform 0.1s, background-color 0.2s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
            user-select: none;
            line-height: 1.2;
            min-height: 32px; 
        }

        .btn:hover:not(:disabled) {
            opacity: 0.9;
        }

        .btn:active:not(:disabled) {
            transform: scale(0.98);
        }
        .btn:disabled {
            opacity: 0.5;
            cursor: default;
            transform: scale(1);
        }

        .btn-primary {
            background-color: var(--color-primary);
            color: white;
        }

        .btn-secondary {
            background-color: var(--color-border);
            color: var(--color-text-primary);
        }
        
        .btn-danger {
            background-color: var(--color-danger);
            color: white;
        }

        /* V10.0: New style for the neutral Close All button */
        .btn-neutral {
            background-color: var(--color-neutral-bg);
            color: white;
        }

        .btn-end-game {
             background-color: var(--color-panel-bg);
             color: var(--color-danger);
             border: 1px solid var(--color-danger);
        }
        .btn-end-game:hover:not(:disabled) {
            background-color: var(--color-danger);
            color: white;
        }

        .speed-selector {
            display: flex;
            border: 1px solid var(--color-border);
            border-radius: var(--radius-main);
            overflow: hidden;
        }

        .speed-btn {
            padding: 8px 10px;
            background-color: var(--color-panel-bg);
            border: none;
            cursor: pointer;
            font-size: 14px;
        }

        .speed-btn.active {
            background-color: var(--color-primary);
            color: white;
        }

        .speed-btn:not(:last-child) {
            border-right: 1px solid var(--color-border);
        }

        /* 6. Trading Interface (V10.0 Adjustments) */
        
        /* 6.1 Ordering Controls (Adjusted for V9.0 layout flexibility) */
        
        .order-controls {
            display: flex;
            gap: 15px;
            /* V9.0 Desktop (Default): Vertical stack */
            flex-direction: column; 
            align-items: stretch;
        }
        
        .input-group-horizontal {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .input-group-horizontal label {
            font-size: 14px;
            color: var(--color-text-secondary);
            white-space: nowrap;
            /* V9.0 Desktop (Default): Define width for labels in vertical stack */
            width: 50px; 
        }

        .input-field {
            padding: 8px 10px; 
            border: 1px solid var(--color-border);
            font-size: 16px;
            text-align: center;
            /* V9.0: Remove fixed width, allow it to fill the container */
            width: auto; 
            flex: 1;
            height: 36px;
             -moz-appearance: textfield;
             border-radius: var(--radius-main); 
        }

        .input-field.scrubbable {
            cursor: ew-resize;
        }

        .input-field::-webkit-outer-spin-button,
        .input-field::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        
        .trade-actions {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .btn-trade {
            padding: 12px 10px; /* Reduced horizontal padding slightly in V10.0 for the 3-button layout */
            font-size: 18px;
            color: white;
            flex: 1;
        }

        .btn-buy {
            background-color: var(--color-bull);
        }

        .btn-sell {
            background-color: var(--color-bear);
        }
        

        /* Info bar for estimates */
        .order-info-bar {
            display: flex;
            /* V10.0: Center the estimates now that the button is moved */
            justify-content: center;
            align-items: center;
            border-top: 1px solid var(--color-border);
            padding-top: 8px;
            margin-top: 5px;
        }
        
        .estimates {
            font-size: 12px;
            color: var(--color-text-secondary);
            display: flex;
            gap: 15px;
        }
        
        /* V9.0: Mobile adjustments for Ordering Controls (Reverting to Horizontal) */
        @media (max-width: 900px) {

            .order-controls {
                /* V9.0 Mobile: Horizontal layout */
                flex-direction: row;
                gap: 10px;
                justify-content: space-between;
                align-items: center;
            }

            .input-group-horizontal label {
                /* V9.0 Mobile: Remove fixed width for labels */
                width: auto;
            }

            .input-field {
                /* V9.0 Mobile: Apply fixed width as space is limited */
                width: 80px; 
                font-size: 14px;
                padding: 6px 5px;
                height: 32px;
            }
            .btn-trade {
                font-size: 16px;
                /* V10.0: Adjusted padding for 3-button layout on mobile */
                padding: 10px 8px;
            }

            .order-info-bar {
                 padding-top: 6px;
                 margin-top: 0;
                 /* V10.0: Ensure centering on mobile too */
                 justify-content: center;
            }
            .estimates {
                gap: 10px;
                font-size: 11px;
            }
        }

        /* 6.2 Positions & History (Inherited from V8.0, now inside V9.0 structure) */

        .challenge-info {
            display: none; 
        }

        .panel-tabs {
            display: flex;
            border-bottom: 1px solid var(--color-border);
            flex-shrink: 0; 
        }

        .tab-btn {
            flex: 1;
            padding: 12px;
            text-align: center;
            cursor: pointer;
            background-color: var(--color-bg);
            border: none;
            font-weight: bold;
        }

        .tab-btn.active {
            background-color: var(--color-panel-bg);
            color: var(--color-primary);
            border-bottom: 2px solid var(--color-primary);
        }


        .tabs-wrapper {
            flex: 1;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            min-height: 0; 
        }

        /* V9.0: Note: This refers to the INTERNAL tabs (Positions/History), not the main V9 tabs */
        .tab-content {
            padding: 15px;
            display: none;
            flex-direction: column;
            gap: 15px;
            flex-grow: 1;
            overflow-y: auto; 
        }

        .tab-content.active {
            display: flex;
        }

        .positions-list, .history-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
            flex: 1; 
        }

        .empty-state {
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
            color: var(--color-text-secondary);
            font-size: 14px;
            padding: 20px;
            flex: 1; 
            height: 100%;
        }

        .trade-item {
            background-color: var(--color-bg);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-main);
            padding: 10px;
            font-size: 14px;
        }

        .trade-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-weight: bold;
        }

        .trade-type.BUY { color: var(--color-bull); }
        .trade-type.SELL { color: var(--color-bear); }

        .trade-details {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 5px;
        }

        .trade-detail-label {
            font-size: 12px;
            color: var(--color-text-secondary);
        }

        .trade-actions-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 10px;
        }

        .btn-small {
            padding: 5px 10px;
            font-size: 12px;
        }

        /* V8.0.1/V9.0: Mobile Optimization Overhaul (Chart Controls) */
        @media (max-width: 900px) {

            /* Vertical Chart Controls on Mobile */
            .controls-overlay-container {
                top: 5px;
                left: 5px;
                right: 5px;
                align-items: flex-start; 
            }

            .controls {
                 padding: 5px;
                 gap: 5px;
            }

            .controls-left {
                flex-direction: column;
                align-items: stretch;
            }

            .collapsible-controls {
                flex-direction: column;
                
                /* Adjust transition for vertical collapse (using max-height instead of max-width) */
                transition: max-height 0.4s ease, opacity 0.4s ease, margin-top 0.4s ease, padding-top 0.4s ease, border-top-width 0.4s ease;
                max-width: none; /* Remove max-width constraint */
                max-height: 500px; /* Set a large max-height for animation */
            }
            
            /* V9.0: Styling when controls are NOT collapsed (for vertical stack separation) */
            .controls-left:not(.controls-collapsed) .collapsible-controls {
                /* Reset horizontal styles */
                padding-left: 0;
                margin-left: 0;
                border-left: none;
                /* Add a top border when stacked vertically */
                border-top: 1px solid var(--color-border);
                padding-top: 5px;
                margin-top: 5px;
            }


            .controls-collapsed .collapsible-controls {
                /* Adjust collapse properties for vertical animation */
                max-width: none; 
                max-height: 0;
                opacity: 0;
                margin-top: 0;
                padding-top: 0;
                border-top-width: 0;
            }

            .speed-selector {
                display: flex;
            }

            .speed-btn {
                flex: 1;
            }
            
            .btn {
                font-size: 12px;
                padding: 6px 8px;
                min-height: 28px;
            }
        }

        /* V8.0.2/V9.0: Optimization for small mobile devices (<600px) */
        @media (max-width: 600px) {
            /* Header Fix (V9.0 R1 relies on flex-wrap) */
            .header {
                padding: 4px 8px;
                gap: 5px;
            }
            
            .hud, .hud-right {
                gap: 8px; /* V9.0 Reduced gap further */
            }

            .hud-label {
                font-size: 10px;
            }

            .hud-value {
                font-size: 13px;
            }

            @media (max-width: 380px) {
                .hud .hud-item:first-child {
                   display: none;
                }
            }
            
            .progress-container {
                width: auto;
                flex: 1;
                max-width: 120px;
            }

            /* V10.0: Bottom Content Area Fixes (Ordering Tab) */

            #tabOrder {
                padding: 5px;
                gap: 5px;
            }

            .order-controls {
                gap: 5px;
            }
            
            .input-group-horizontal label {
                font-size: 12px;
            }

            .input-field {
                width: 60px; /* Further reduced width */
                font-size: 12px;
                padding: 5px 3px;
                height: 28px;
            }

            .trade-actions {
                gap: 5px;
            }

            .btn-trade {
                font-size: 14px;
                /* V10.0: Further reduced padding for 3-button layout on very small screens */
                padding: 8px 3px;
            }
            
            .order-info-bar {
                padding-top: 4px;
            }

            .estimates {
                font-size: 10px;
                gap: 8px;
            }
        }


        /* 7. Modals & Overlays (Inherited from V8.0) */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background-color: var(--color-panel-bg);
            padding: 30px;
            border-radius: var(--radius-main);
            box-shadow: var(--shadow-main);
            max-width: 550px;
            width: 90%;
            text-align: center;
            transform: scale(0.95);
            transition: transform 0.3s ease;
            max-height: 90vh;
            overflow-y: auto; 
        }

        .modal-overlay.active .modal-content {
            transform: scale(1);
        }

        .modal-title {
            font-size: 24px;
            margin-bottom: 15px;
            font-weight: bold;
        }

        .modal-body {
            font-size: 16px;
            margin-bottom: 25px;
            line-height: 1.5;
        }

        .cta-button {
            background-color: var(--color-success);
            color: white;
            padding: 15px 30px;
            font-size: 18px;
            letter-spacing: 1px;
            text-decoration: none;
        }

        /* 7.1 Tutorial Specific */
        .tutorial-highlight {
            position: absolute;
            border: 3px dashed var(--color-primary);
            border-radius: var(--radius-main);
            box-shadow: 0 0 0 9999px rgba(0, 0, 0, 0.6);
            z-index: 1001;
            pointer-events: none;
            transition: top 0.3s, left 0.3s, width 0.3s, height 0.3s;
        }

        .tutorial-message {
            position: absolute;
            background-color: var(--color-primary);
            color: white;
            padding: 15px;
            border-radius: var(--radius-main);
            max-width: 300px;
            z-index: 1002;
            box-shadow: var(--shadow-main);
            transition: top 0.3s, left 0.3s;
        }
        
        /* 7.2 Achievements & Feedback */
        .achievements-section {
            margin-top: 25px;
            border-top: 1px solid var(--color-border);
            padding-top: 15px;
            text-align: left;
        }
        .achievements-list {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            list-style-type: none;
            padding: 0;
            margin-top: 10px;
        }
        @media (max-width: 500px) {
            .achievements-list {
                grid-template-columns: 1fr;
            }
        }

        .achievement-item {
            background-color: var(--color-bg);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-main);
            padding: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 14px;
        }
        .achievement-icon {
            font-size: 20px;
        }
        
        /* 7.3 Achievement Notifications (Toasts) */
        #notification-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1010;
            display: flex;
            flex-direction: column;
            gap: 10px;
            pointer-events: none;
        }

        @media (max-width: 900px) {
            #notification-container {
                /* V9.0: Top position might need dynamic adjustment via JS if header wraps, but use a safe default */
                top: 60px; 
                right: 10px;
                left: 10px;
                align-items: center;
            }
        }
        
         @media (max-width: 600px) {
            #notification-container {
                /* Further adjustment for potentially wrapped header */
                top: 85px; 
            }
        }

        .notification-toast {
            background-color: var(--color-primary-dark);
            color: white;
            padding: 15px 20px;
            border-radius: var(--radius-main);
            box-shadow: var(--shadow-main);
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            gap: 5px;
            max-width: 350px;
            width: 100%;
            opacity: 0;
            transform: translateY(-20px);
            transition: opacity 0.5s, transform 0.5s;
        }
        .notification-toast.show {
            opacity: 1;
            transform: translateY(0);
        }

        /* 8. Utilities & Loader */
        .hidden {
            display: none !important;
        }

        .loader-wrap {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--color-bg);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            gap: 20px;
            text-align: center;
            padding: 20px;
        }

        .loading-spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: var(--color-primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .file-upload-prompt {
            background-color: var(--color-panel-bg);
            padding: 30px;
            border-radius: var(--radius-main);
            box-shadow: var(--shadow-main);
            border: 1px solid var(--color-border);
            max-width: 450px;
        }
    </style>
</head>
<body>
    <!-- Loader -->
    <div class="loader-wrap" id="loader">
        <div id="loader-status">
            <div class="loading-spinner"></div>
            <p>正在載入數據與初始化圖表...</p>
        </div>
        <div id="fileUploadFallback" class="file-upload-prompt hidden">
            <p style="color: var(--color-danger); margin-bottom: 15px; font-weight: bold;">⚠️ 數據載入失敗</p>
            <p id="loader-error-message" style="margin-bottom: 15px;"></p>
            <p>這可能是由於瀏覽器的本地檔案存取限制 (CORS) 或檔案格式不正確。</p>
            <p style="margin-bottom: 20px;">請手動上傳 <strong>XAUUSD_M15.csv</strong> 檔案以繼續：</p>
            <input type="file" id="csvFileInput" accept=".csv">
        </div>
    </div>

    <div id="notification-container"></div>

    <!-- Header -->
    <header class="header">
        <div class="hud">
            <div class="hud-item">
                <span class="hud-label">模擬日期</span>
                <span class="hud-value" id="hud-date">--/--/-- --:--</span>
            </div>
            <div class="hud-item">
                <!-- 修改：強調是虛擬帳戶 -->
                <span class="hud-label">學習分數</span>
                <span class="hud-value" id="hud-equity">5000 分</span>
            </div>
            <div class="hud-item">
                <span class="hud-label">階段表現</span>
                <span class="hud-value" id="hud-pl">0 分</span>
            </div>
        </div>
        <div class="hud-right">
            <div class="hud-item">
                <span class="hud-label">剩餘時間</span>
                <span class="hud-value" id="hud-timer">01:00</span>
            </div>
            <div class="hud-item progress-container">
                <span class="hud-label">挑戰進度</span>
                <div class="progress-bar">
                    <div class="progress-fill" id="hud-progress"></div>
                </div>
            </div>
        </div>
    </header>

    <!-- V9.0: New Main Container Structure -->
    <div class="main-container-v9">
        
        <!-- V9.0: Chart Container -->
        <div class="chart-container-v9">

            <div class="chart-wrap" id="chartWrap">
                 <!-- Overlay Controls -->
                <div class="controls-overlay-container">
                    <!-- V9.0 (R3): Added controls-collapsed by default -->
                    <div class="controls controls-left controls-collapsed" id="chartControls">
                        
                        <div class="collapsible-controls">
                            <button class="btn btn-primary" id="btnPlayPause">▶️ 播放</button>
                            <button class="btn btn-secondary" id="btnStepForward">➡️ 逐K前進</button>
                            <div class="speed-selector" id="speedSelector">
                                <button class="speed-btn active" data-speed="1">1x</button>
                                <button class="speed-btn" data-speed="5">5x</button>
                                <button class="speed-btn" data-speed="20">20x</button>
                                <button class="speed-btn" data-speed="40">40x</button>
                            </div>
                            <button class="btn btn-secondary" id="btnZoomIn">🔍+</button>
                            <button class="btn btn-secondary" id="btnZoomOut">🔍-</button>
                        </div>
                         <!-- V9.0 (R3): Changed initial text to "展開設定" -->
                        <button class="btn btn-secondary btn-toggle-controls" id="btnToggleControls">展開設定</button>
                    </div>
                    <div class="controls controls-right">
                         <button class="btn btn-end-game" id="btnEndGame">結束挑戰</button>
                    </div>
                </div>

                <canvas id="chartCanvas"></canvas>
                <div class="chart-overlay" id="chartOverlay">
                    </div>
            </div>
        </div>

        <!-- V9.0: Bottom Content Area (Becomes Side Panel on Desktop) -->
        <div class="bottom-content-v9" id="bottomContent">
            
            <!-- V9.0: Navigation Bar (Moved here for Desktop view compatibility) -->
            <nav class="bottom-nav-bar-v9" id="bottomNavBar">
                <button class="nav-btn-v9 active" data-target="tabOrder">下單</button>
                <button class="nav-btn-v9" data-target="tabPositionsHistory">倉位/紀錄 (<span id="positionsCountNav">0</span>)</button>
            </nav>

            <!-- Tab Content 1: Ordering -->
            <div class="tab-content-v9 active" id="tabOrder">
                <!-- Content moved from old bottom-bar -->
                <div class="order-controls">
                    <div class="input-group-horizontal">
                       <label for="inputSL">SL</label>
                       <input type="number" class="input-field scrubbable" id="inputSL" placeholder="價格" step="0.1" min="0" data-scrub-step="0.5">
                    </div>
                    <div class="input-group-horizontal">
                       <label for="inputLots">手數</label>
                       <input type="number" class="input-field scrubbable" id="inputLots" value="1.00" step="0.01" min="0.01" data-scrub-step="0.05" disabled>
                   </div>
                   <div class="input-group-horizontal">
                       <label for="inputTP">TP</label>
                       <input type="number" class="input-field scrubbable" id="inputTP" placeholder="價格" step="0.1" min="0" data-scrub-step="0.5">
                   </div>
               </div>
               <!-- V10.0: Modified trade-actions for 3-button layout -->
               <div class="trade-actions">
                   <button class="btn btn-trade btn-sell" id="btnSell">賣出</button>
                   <!-- Moved btnCloseAllGlobal here and updated style -->
                   <button class="btn btn-trade btn-neutral" id="btnCloseAllGlobal">全部平倉</button>
                   <button class="btn btn-trade btn-buy" id="btnBuy">買入</button>
               </div>
               <div class="order-info-bar">
                   <div class="estimates">
                       <span id="estimateSL"></span>
                       <span id="estimateTP"></span>
                   </div>
                   <!-- btnCloseAllGlobal removed from here -->
               </div>
            </div>

            <!-- Tab Content 2: Positions/History -->
            <div class="tab-content-v9" id="tabPositionsHistory">
                <!-- Content moved from old side-panel -->
                <div class="challenge-info" id="challengeInfo">
                    <!-- 修改：強調模擬性質 -->
                    <h4>🏆 7日內5分鐘模擬挑戰</h4>
                    <!-- 修改：避免強調收益，改為強調技巧與績效 -->
                    <p>從隨機歷史日期開始，在7日內盡力提升交易技巧與模擬績效！</p>
                </div>

                <div class="panel-tabs">
                    <button class="tab-btn active" data-target="tabPositions">持倉 (<span id="positionsCount">0</span>)</button>
                    <button class="tab-btn" data-target="tabHistory">紀錄</button>
                </div>
                
                <div class="tabs-wrapper">
                    <div class="tab-content active" id="tabPositions">
                        <div class="positions-list" id="positionsList">
                            <div class="empty-state" id="emptyPositions">目前沒有持倉。</div>
                        </div>
                    </div>

                    <div class="tab-content" id="tabHistory">
                        <div class="history-list" id="historyList">
                            <div class="empty-state" id="emptyHistory">還沒有交易紀錄。</div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <!-- V10.1: Footer for advertisement with link -->
    <!-- 修改：強調本遊戲為教學模擬用途 -->
    <footer class="footer-ad">
        本模擬遊戲由 <a href="https://www.massenlighten.com" target="_blank">眾曜智庫</a> 提供用於教學目的
    </footer>
    

    <!-- Modals -->
    <div class="modal-overlay" id="eventModal">
        <div class="modal-content">
            <h2 class="modal-title" id="eventTitle">⚠️ 重大財經事件</h2>
            <div class="modal-body" id="eventBody" style="text-align: left;">
                </div>
            <button class="btn btn-primary" id="eventContinueBtn">繼續模擬</button>
        </div>
    </div>

    <div class="modal-overlay" id="endGameModal">
        <div class="modal-content">
            <canvas id="celebrationCanvas" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 1;"></canvas>
            <h2 class="modal-title">🎉 挑戰結束！</h2>
            <div class="modal-body" style="text-align: center;">
                <!-- 修改：強調模擬成績 -->
                <p>您的最終模擬成績：</p>
                <h1 id="finalScore" style="font-size: 36px; margin: 10px 0;">$10000.00</h1>
                <p id="finalRoR" style="font-size: 20px;"></p>
                <p id="finalTime" style="font-size: 16px; color: var(--color-text-secondary);"></p>
                
                <div id="endGameStats"></div>
                
                <div class="achievements-section" id="achievementsSection">
                    <h3>🏆 已解鎖成就</h3>
                    <ul class="achievements-list" id="achievementsList">
                        </ul>
                </div>

            </div>
            <div class="cta-area" style="margin-bottom: 15px;">
              <a href="https://line.me/R/app/1656872168-4Xavv951" target="_blank" class="btn cta-button">🎮 遊玩完整版</a>
              <a href="https://line.me/R/app/1656872168-NmoJJ2m7" target="_blank" class="btn btn-secondary">📘 瞭解如何取得高分</a>
            </div>
            <button class="btn btn-secondary" id="restartButton">重新挑戰</button>
        </div>
    </div>

    <script>
        // ============================================================================
        // 專案：交易模擬學習 Playable Ad (Rework V11.0 - Compliance Update)
        // ============================================================================

        // Embedded trading data
        const tradingData = [
          {
            "time": 1743469200000,
            "open": 3123.04,
            "high": 3125.82,
            "low": 3122.98,
            "close": 3124.48
          },
          {
            "time": 1743470100000,
            "open": 3124.48,
            "high": 3124.48,
            "low": 3121.66,
            "close": 3123.22
          },
          {
            "time": 1743471000000,
            "open": 3123.22,
            "high": 3123.54,
            "low": 3122.17,
            "close": 3123.2
          },
          {
            "time": 1743471900000,
            "open": 3123.2,
            "high": 3123.7,
            "low": 3122.59,
            "close": 3122.82
          },
          {
            "time": 1743472800000,
            "open": 3122.82,
            "high": 3126.0,
            "low": 3122.82,
            "close": 3125.55
          },
          {
            "time": 1743473700000,
            "open": 3125.55,
            "high": 3125.86,
            "low": 3124.88,
            "close": 3125.46
          },
          {
            "time": 1743474600000,
            "open": 3125.46,
            "high": 3126.38,
            "low": 3125.06,
            "close": 3126.05
          },
          {
            "time": 1743475500000,
            "open": 3126.05,
            "high": 3126.46,
            "low": 3120.11,
            "close": 3120.55
          },
          {
            "time": 1743476400000,
            "open": 3120.56,
            "high": 3124.49,
            "low": 3120.4,
            "close": 3122.93
          },
          {
            "time": 1743477300000,
            "open": 3122.93,
            "high": 3125.61,
            "low": 3122.58,
            "close": 3124.31
          },
          {
            "time": 1743478200000,
            "open": 3124.31,
            "high": 3126.55,
            "low": 3124.09,
            "close": 3126.55
          },
          {
            "time": 1743479100000,
            "open": 3126.55,
            "high": 3128.03,
            "low": 3125.9,
            "close": 3127.26
          },
          {
            "time": 1743480000000,
            "open": 3127.26,
            "high": 3134.49,
            "low": 3126.57,
            "close": 3132.89
          },
          {
            "time": 1743480900000,
            "open": 3132.89,
            "high": 3134.73,
            "low": 3131.04,
            "close": 3133.5
          },
          {
            "time": 1743481800000,
            "open": 3133.49,
            "high": 3136.2,
            "low": 3129.86,
            "close": 3135.88
          },
          {
            "time": 1743482700000,
            "open": 3135.88,
            "high": 3138.25,
            "low": 3133.84,
            "close": 3135.44
          },
          {
            "time": 1743483600000,
            "open": 3135.43,
            "high": 3139.92,
            "low": 3133.04,
            "close": 3139.37
          },
          {
            "time": 1743484500000,
            "open": 3139.37,
            "high": 3143.55,
            "low": 3138.01,
            "close": 3142.54
          },
          {
            "time": 1743485400000,
            "open": 3142.6,
            "high": 3143.48,
            "low": 3140.81,
            "close": 3142.78
          },
          {
            "time": 1743486300000,
            "open": 3142.79,
            "high": 3145.67,
            "low": 3142.44,
            "close": 3145.16
          },
          {
            "time": 1743487200000,
            "open": 3145.17,
            "high": 3145.19,
            "low": 3142.62,
            "close": 3144.14
          },
          {
            "time": 1743488100000,
            "open": 3144.14,
            "high": 3145.05,
            "low": 3143.0,
            "close": 3144.85
          },
          {
            "time": 1743489000000,
            "open": 3144.85,
            "high": 3146.11,
            "low": 3143.69,
            "close": 3144.22
          },
          {
            "time": 1743489900000,
            "open": 3144.22,
            "high": 3147.41,
            "low": 3144.22,
            "close": 3146.09
          },
          {
            "time": 1743490800000,
            "open": 3146.08,
            "high": 3148.02,
            "low": 3144.58,
            "close": 3146.55
          },
          {
            "time": 1743491700000,
            "open": 3146.55,
            "high": 3146.6,
            "low": 3142.87,
            "close": 3143.8
          },
          {
            "time": 1743492600000,
            "open": 3143.8,
            "high": 3145.79,
            "low": 3143.34,
            "close": 3144.22
          },
          {
            "time": 1743493500000,
            "open": 3144.22,
            "high": 3145.61,
            "low": 3144.03,
            "close": 3144.8
          },
          {
            "time": 1743494400000,
            "open": 3144.81,
            "high": 3145.2,
            "low": 3141.7,
            "close": 3142.69
          },
          {
            "time": 1743495300000,
            "open": 3142.69,
            "high": 3145.77,
            "low": 3142.6,
            "close": 3145.17
          },
          {
            "time": 1743496200000,
            "open": 3145.17,
            "high": 3149.02,
            "low": 3144.31,
            "close": 3145.37
          },
          {
            "time": 1743497100000,
            "open": 3145.37,
            "high": 3146.31,
            "low": 3130.52,
            "close": 3132.09
          },
          {
            "time": 1743498000000,
            "open": 3132.06,
            "high": 3132.88,
            "low": 3126.66,
            "close": 3130.95
          },
          {
            "time": 1743498900000,
            "open": 3130.95,
            "high": 3138.23,
            "low": 3130.14,
            "close": 3136.23
          },
          {
            "time": 1743499800000,
            "open": 3136.23,
            "high": 3138.13,
            "low": 3133.28,
            "close": 3133.5
          },
          {
            "time": 1743500700000,
            "open": 3133.49,
            "high": 3136.74,
            "low": 3131.82,
            "close": 3133.7
          },
          {
            "time": 1743501600000,
            "open": 3133.81,
            "high": 3136.7,
            "low": 3131.29,
            "close": 3136.48
          },
          {
            "time": 1743502500000,
            "open": 3136.62,
            "high": 3137.8,
            "low": 3130.94,
            "close": 3132.7
          },
          {
            "time": 1743503400000,
            "open": 3132.76,
            "high": 3133.32,
            "low": 3125.87,
            "close": 3126.28
          },
          {
            "time": 1743504300000,
            "open": 3126.22,
            "high": 3128.51,
            "low": 3124.14,
            "close": 3127.59
          },
          {
            "time": 1743505200000,
            "open": 3127.59,
            "high": 3135.37,
            "low": 3126.44,
            "close": 3135.2
          },
          {
            "time": 1743506100000,
            "open": 3135.17,
            "high": 3135.67,
            "low": 3131.42,
            "close": 3132.36
          },
          {
            "time": 1743507000000,
            "open": 3132.36,
            "high": 3133.98,
            "low": 3131.1,
            "close": 3132.45
          },
          {
            "time": 1743507900000,
            "open": 3132.45,
            "high": 3133.33,
            "low": 3129.55,
            "close": 3131.06
          },
          {
            "time": 1743508800000,
            "open": 3131.06,
            "high": 3132.88,
            "low": 3130.17,
            "close": 3131.55
          },
          {
            "time": 1743509700000,
            "open": 3131.55,
            "high": 3134.11,
            "low": 3130.96,
            "close": 3132.44
          },
          {
            "time": 1743510600000,
            "open": 3132.33,
            "high": 3133.54,
            "low": 3131.2,
            "close": 3133.09
          },
          {
            "time": 1743511500000,
            "open": 3133.09,
            "high": 3133.61,
            "low": 3130.38,
            "close": 3132.43
          },
          {
            "time": 1743512400000,
            "open": 3132.43,
            "high": 3135.83,
            "low": 3130.82,
            "close": 3135.25
          },
          {
            "time": 1743513300000,
            "open": 3135.27,
            "high": 3138.95,
            "low": 3134.87,
            "close": 3136.18
          },
          {
            "time": 1743514200000,
            "open": 3136.17,
            "high": 3137.81,
            "low": 3131.82,
            "close": 3133.93
          },
          {
            "time": 1743515100000,
            "open": 3133.93,
            "high": 3134.74,
            "low": 3132.18,
            "close": 3132.31
          },
          {
            "time": 1743516000000,
            "open": 3132.32,
            "high": 3133.9,
            "low": 3130.85,
            "close": 3133.74
          },
          {
            "time": 1743516900000,
            "open": 3133.74,
            "high": 3135.92,
            "low": 3129.35,
            "close": 3130.8
          },
          {
            "time": 1743517800000,
            "open": 3130.81,
            "high": 3133.69,
            "low": 3129.98,
            "close": 3132.77
          },
          {
            "time": 1743518700000,
            "open": 3132.65,
            "high": 3133.3,
            "low": 3128.71,
            "close": 3130.4
          },
          {
            "time": 1743519600000,
            "open": 3130.4,
            "high": 3133.09,
            "low": 3127.77,
            "close": 3132.12
          },
          {
            "time": 1743520500000,
            "open": 3132.18,
            "high": 3134.45,
            "low": 3130.9,
            "close": 3133.69
          },
          {
            "time": 1743521400000,
            "open": 3133.69,
            "high": 3134.62,
            "low": 3131.01,
            "close": 3133.25
          },
          {
            "time": 1743522300000,
            "open": 3133.25,
            "high": 3134.31,
            "low": 3132.19,
            "close": 3133.39
          },
          {
            "time": 1743523200000,
            "open": 3133.46,
            "high": 3137.14,
            "low": 3131.42,
            "close": 3134.71
          },
          {
            "time": 1743524100000,
            "open": 3134.79,
            "high": 3135.11,
            "low": 3128.24,
            "close": 3129.28
          },
          {
            "time": 1743525000000,
            "open": 3129.26,
            "high": 3135.1,
            "low": 3128.33,
            "close": 3132.64
          },
          {
            "time": 1743525900000,
            "open": 3132.66,
            "high": 3134.52,
            "low": 3131.04,
            "close": 3133.98
          },
          {
            "time": 1743526800000,
            "open": 3133.87,
            "high": 3135.46,
            "low": 3124.37,
            "close": 3125.51
          },
          {
            "time": 1743527700000,
            "open": 3125.55,
            "high": 3130.54,
            "low": 3123.92,
            "close": 3127.13
          },
          {
            "time": 1743528600000,
            "open": 3126.94,
            "high": 3130.09,
            "low": 3124.52,
            "close": 3127.16
          },
          {
            "time": 1743529500000,
            "open": 3127.16,
            "high": 3131.74,
            "low": 3126.1,
            "close": 3128.75
          },
          {
            "time": 1743530400000,
            "open": 3128.81,
            "high": 3133.09,
            "low": 3128.09,
            "close": 3131.01
          },
          {
            "time": 1743531300000,
            "open": 3131.01,
            "high": 3131.62,
            "low": 3125.74,
            "close": 3126.62
          },
          {
            "time": 1743532200000,
            "open": 3126.65,
            "high": 3127.31,
            "low": 3119.37,
            "close": 3121.28
          },
          {
            "time": 1743533100000,
            "open": 3121.29,
            "high": 3124.23,
            "low": 3113.45,
            "close": 3113.73
          },
          {
            "time": 1743534000000,
            "open": 3113.67,
            "high": 3116.83,
            "low": 3106.7,
            "close": 3107.17
          },
          {
            "time": 1743534900000,
            "open": 3107.04,
            "high": 3108.83,
            "low": 3100.85,
            "close": 3107.89
          },
          {
            "time": 1743535800000,
            "open": 3107.94,
            "high": 3110.67,
            "low": 3105.29,
            "close": 3107.13
          },
          {
            "time": 1743536700000,
            "open": 3107.14,
            "high": 3110.87,
            "low": 3106.39,
            "close": 3106.68
          },
          {
            "time": 1743537600000,
            "open": 3106.68,
            "high": 3108.73,
            "low": 3105.81,
            "close": 3108.64
          },
          {
            "time": 1743538500000,
            "open": 3108.64,
            "high": 3114.31,
            "low": 3108.63,
            "close": 3113.99
          },
          {
            "time": 1743539400000,
            "open": 3113.97,
            "high": 3114.59,
            "low": 3112.18,
            "close": 3113.12
          },
          {
            "time": 1743540300000,
            "open": 3113.11,
            "high": 3114.5,
            "low": 3112.69,
            "close": 3113.75
          },
          {
            "time": 1743541200000,
            "open": 3113.73,
            "high": 3117.15,
            "low": 3113.4,
            "close": 3116.82
          },
          {
            "time": 1743542100000,
            "open": 3116.82,
            "high": 3117.33,
            "low": 3114.09,
            "close": 3116.47
          },
          {
            "time": 1743543000000,
            "open": 3116.47,
            "high": 3118.74,
            "low": 3113.42,
            "close": 3113.58
          },
          {
            "time": 1743543900000,
            "open": 3113.59,
            "high": 3115.14,
            "low": 3113.41,
            "close": 3114.18
          },
          {
            "time": 1743544800000,
            "open": 3114.19,
            "high": 3115.2,
            "low": 3113.83,
            "close": 3115.15
          },
          {
            "time": 1743545700000,
            "open": 3115.14,
            "high": 3118.34,
            "low": 3115.01,
            "close": 3117.08
          },
          {
            "time": 1743546600000,
            "open": 3117.12,
            "high": 3117.57,
            "low": 3116.38,
            "close": 3116.81
          },
          {
            "time": 1743547500000,
            "open": 3116.81,
            "high": 3118.99,
            "low": 3116.7,
            "close": 3118.65
          },
          {
            "time": 1743548400000,
            "open": 3118.69,
            "high": 3118.96,
            "low": 3118.12,
            "close": 3118.37
          },
          {
            "time": 1743549300000,
            "open": 3118.37,
            "high": 3119.95,
            "low": 3118.11,
            "close": 3119.64
          },
          {
            "time": 1743550200000,
            "open": 3119.64,
            "high": 3120.71,
            "low": 3118.35,
            "close": 3118.62
          },
          {
            "time": 1743551100000,
            "open": 3118.62,
            "high": 3119.55,
            "low": 3113.3,
            "close": 3114.32
          },
          {
            "time": 1743555600000,
            "open": 3113.86,
            "high": 3114.89,
            "low": 3112.16,
            "close": 3112.41
          },
          {
            "time": 1743556500000,
            "open": 3112.4,
            "high": 3112.6,
            "low": 3107.94,
            "close": 3111.48
          },
          {
            "time": 1743557400000,
            "open": 3111.48,
            "high": 3113.67,
            "low": 3111.43,
            "close": 3112.91
          },
          {
            "time": 1743558300000,
            "open": 3112.91,
            "high": 3113.46,
            "low": 3111.07,
            "close": 3111.39
          },
          {
            "time": 1743559200000,
            "open": 3111.48,
            "high": 3114.03,
            "low": 3111.32,
            "close": 3112.02
          },
          {
            "time": 1743560100000,
            "open": 3112.02,
            "high": 3113.38,
            "low": 3111.88,
            "close": 3112.67
          },
          {
            "time": 1743561000000,
            "open": 3112.67,
            "high": 3113.82,
            "low": 3111.39,
            "close": 3113.81
          },
          {
            "time": 1743561900000,
            "open": 3113.81,
            "high": 3116.27,
            "low": 3113.28,
            "close": 3115.23
          },
          {
            "time": 1743562800000,
            "open": 3115.16,
            "high": 3115.4,
            "low": 3113.08,
            "close": 3113.78
          },
          {
            "time": 1743563700000,
            "open": 3113.79,
            "high": 3121.89,
            "low": 3113.38,
            "close": 3121.68
          },
          {
            "time": 1743564600000,
            "open": 3121.68,
            "high": 3123.08,
            "low": 3120.45,
            "close": 3120.79
          },
          {
            "time": 1743565500000,
            "open": 3120.79,
            "high": 3123.74,
            "low": 3120.44,
            "close": 3122.96
          },
          {
            "time": 1743566400000,
            "open": 3122.96,
            "high": 3132.77,
            "low": 3121.43,
            "close": 3132.53
          },
          {
            "time": 1743567300000,
            "open": 3132.53,
            "high": 3134.22,
            "low": 3130.64,
            "close": 3133.62
          },
          {
            "time": 1743568200000,
            "open": 3133.6,
            "high": 3135.33,
            "low": 3129.3,
            "close": 3130.22
          },
          {
            "time": 1743569100000,
            "open": 3130.22,
            "high": 3134.01,
            "low": 3129.64,
            "close": 3133.23
          },
          {
            "time": 1743570000000,
            "open": 3133.23,
            "high": 3135.74,
            "low": 3132.19,
            "close": 3132.82
          },
          {
            "time": 1743570900000,
            "open": 3132.82,
            "high": 3133.77,
            "low": 3130.77,
            "close": 3132.27
          },
          {
            "time": 1743571800000,
            "open": 3132.29,
            "high": 3132.83,
            "low": 3130.07,
            "close": 3131.58
          },
          {
            "time": 1743572700000,
            "open": 3131.58,
            "high": 3133.7,
            "low": 3128.58,
            "close": 3128.62
          },
          {
            "time": 1743573600000,
            "open": 3128.54,
            "high": 3132.14,
            "low": 3127.26,
            "close": 3131.56
          },
          {
            "time": 1743574500000,
            "open": 3131.56,
            "high": 3131.76,
            "low": 3128.82,
            "close": 3129.35
          },
          {
            "time": 1743575400000,
            "open": 3129.35,
            "high": 3129.43,
            "low": 3126.22,
            "close": 3127.93
          },
          {
            "time": 1743576300000,
            "open": 3127.92,
            "high": 3127.94,
            "low": 3124.64,
            "close": 3125.59
          },
          {
            "time": 1743577200000,
            "open": 3125.59,
            "high": 3126.8,
            "low": 3124.86,
            "close": 3125.7
          },
          {
            "time": 1743578100000,
            "open": 3125.7,
            "high": 3126.03,
            "low": 3124.13,
            "close": 3124.23
          },
          {
            "time": 1743579000000,
            "open": 3124.23,
            "high": 3124.66,
            "low": 3118.2,
            "close": 3119.53
          },
          {
            "time": 1743579900000,
            "open": 3119.53,
            "high": 3120.6,
            "low": 3115.59,
            "close": 3116.1
          },
          {
            "time": 1743580800000,
            "open": 3116.11,
            "high": 3117.55,
            "low": 3114.26,
            "close": 3116.72
          },
          {
            "time": 1743581700000,
            "open": 3116.72,
            "high": 3117.93,
            "low": 3112.34,
            "close": 3112.76
          },
          {
            "time": 1743582600000,
            "open": 3112.76,
            "high": 3117.34,
            "low": 3110.0,
            "close": 3116.38
          },
          {
            "time": 1743583500000,
            "open": 3116.38,
            "high": 3119.21,
            "low": 3115.52,
            "close": 3118.08
          },
          {
            "time": 1743584400000,
            "open": 3118.09,
            "high": 3119.1,
            "low": 3114.12,
            "close": 3115.56
          },
          {
            "time": 1743585300000,
            "open": 3115.56,
            "high": 3119.69,
            "low": 3115.51,
            "close": 3116.52
          },
          {
            "time": 1743586200000,
            "open": 3116.51,
            "high": 3118.94,
            "low": 3114.64,
            "close": 3118.49
          },
          {
            "time": 1743587100000,
            "open": 3118.49,
            "high": 3119.01,
            "low": 3116.46,
            "close": 3116.58
          },
          {
            "time": 1743588000000,
            "open": 3116.58,
            "high": 3117.27,
            "low": 3112.16,
            "close": 3113.82
          },
          {
            "time": 1743588900000,
            "open": 3113.74,
            "high": 3118.37,
            "low": 3113.55,
            "close": 3116.77
          },
          {
            "time": 1743589800000,
            "open": 3116.77,
            "high": 3119.69,
            "low": 3115.89,
            "close": 3119.69
          },
          {
            "time": 1743590700000,
            "open": 3119.69,
            "high": 3126.15,
            "low": 3119.34,
            "close": 3125.25
          },
          {
            "time": 1743591600000,
            "open": 3125.28,
            "high": 3127.65,
            "low": 3123.46,
            "close": 3125.56
          },
          {
            "time": 1743592500000,
            "open": 3125.57,
            "high": 3130.26,
            "low": 3124.8,
            "close": 3128.52
          },
          {
            "time": 1743593400000,
            "open": 3128.48,
            "high": 3133.8,
            "low": 3128.07,
            "close": 3133.19
          },
          {
            "time": 1743594300000,
            "open": 3133.19,
            "high": 3133.88,
            "low": 3131.02,
            "close": 3131.33
          },
          {
            "time": 1743595200000,
            "open": 3131.37,
            "high": 3131.52,
            "low": 3127.98,
            "close": 3128.82
          },
          {
            "time": 1743596100000,
            "open": 3128.82,
            "high": 3131.15,
            "low": 3127.91,
            "close": 3130.75
          },
          {
            "time": 1743597000000,
            "open": 3130.75,
            "high": 3131.29,
            "low": 3126.99,
            "close": 3129.1
          },
          {
            "time": 1743597900000,
            "open": 3129.1,
            "high": 3131.32,
            "low": 3128.78,
            "close": 3131.11
          },
          {
            "time": 1743598800000,
            "open": 3131.11,
            "high": 3131.43,
            "low": 3128.95,
            "close": 3130.17
          },
          {
            "time": 1743599700000,
            "open": 3130.17,
            "high": 3130.26,
            "low": 3125.77,
            "close": 3127.0
          },
          {
            "time": 1743600600000,
            "open": 3127.01,
            "high": 3127.74,
            "low": 3116.64,
            "close": 3117.27
          },
          {
            "time": 1743601500000,
            "open": 3117.28,
            "high": 3117.32,
            "low": 3110.23,
            "close": 3114.52
          },
          {
            "time": 1743602400000,
            "open": 3114.51,
            "high": 3120.85,
            "low": 3114.38,
            "close": 3119.63
          },
          {
            "time": 1743603300000,
            "open": 3119.62,
            "high": 3123.92,
            "low": 3117.68,
            "close": 3122.89
          },
          {
            "time": 1743604200000,
            "open": 3122.88,
            "high": 3123.58,
            "low": 3118.95,
            "close": 3121.59
          },
          {
            "time": 1743605100000,
            "open": 3121.59,
            "high": 3122.96,
            "low": 3119.77,
            "close": 3121.34
          },
          {
            "time": 1743606000000,
            "open": 3121.36,
            "high": 3122.05,
            "low": 3117.93,
            "close": 3119.8
          },
          {
            "time": 1743606900000,
            "open": 3119.8,
            "high": 3126.12,
            "low": 3117.13,
            "close": 3125.93
          },
          {
            "time": 1743607800000,
            "open": 3125.94,
            "high": 3127.32,
            "low": 3122.35,
            "close": 3124.25
          },
          {
            "time": 1743608700000,
            "open": 3124.25,
            "high": 3124.75,
            "low": 3122.32,
            "close": 3122.46
          },
          {
            "time": 1743609600000,
            "open": 3122.42,
            "high": 3126.97,
            "low": 3120.8,
            "close": 3123.97
          },
          {
            "time": 1743610500000,
            "open": 3123.97,
            "high": 3127.12,
            "low": 3122.74,
            "close": 3125.8
          },
          {
            "time": 1743611400000,
            "open": 3125.8,
            "high": 3132.05,
            "low": 3124.83,
            "close": 3127.6
          },
          {
            "time": 1743612300000,
            "open": 3127.65,
            "high": 3127.65,
            "low": 3116.69,
            "close": 3122.25
          },
          {
            "time": 1743613200000,
            "open": 3122.31,
            "high": 3124.66,
            "low": 3119.43,
            "close": 3124.13
          },
          {
            "time": 1743614100000,
            "open": 3124.13,
            "high": 3128.54,
            "low": 3123.69,
            "close": 3126.77
          },
          {
            "time": 1743615000000,
            "open": 3126.85,
            "high": 3127.49,
            "low": 3124.08,
            "close": 3125.89
          },
          {
            "time": 1743615900000,
            "open": 3125.89,
            "high": 3129.38,
            "low": 3124.65,
            "close": 3125.01
          },
          {
            "time": 1743616800000,
            "open": 3125.01,
            "high": 3128.2,
            "low": 3124.03,
            "close": 3125.73
          },
          {
            "time": 1743617700000,
            "open": 3125.73,
            "high": 3128.14,
            "low": 3120.91,
            "close": 3124.56
          },
          {
            "time": 1743618600000,
            "open": 3124.61,
            "high": 3127.99,
            "low": 3124.09,
            "close": 3127.41
          },
          {
            "time": 1743619500000,
            "open": 3127.41,
            "high": 3127.87,
            "low": 3125.25,
            "close": 3125.92
          },
          {
            "time": 1743620400000,
            "open": 3125.94,
            "high": 3130.28,
            "low": 3125.94,
            "close": 3129.94
          },
          {
            "time": 1743621300000,
            "open": 3129.94,
            "high": 3134.27,
            "low": 3129.07,
            "close": 3132.44
          },
          {
            "time": 1743622200000,
            "open": 3132.64,
            "high": 3134.12,
            "low": 3130.9,
            "close": 3132.67
          },
          {
            "time": 1743623100000,
            "open": 3132.63,
            "high": 3133.75,
            "low": 3127.25,
            "close": 3131.47
          },
          {
            "time": 1743624000000,
            "open": 3131.46,
            "high": 3131.46,
            "low": 3128.69,
            "close": 3129.54
          },
          {
            "time": 1743624900000,
            "open": 3129.54,
            "high": 3129.55,
            "low": 3123.33,
            "close": 3124.38
          },
          {
            "time": 1743625800000,
            "open": 3124.29,
            "high": 3124.46,
            "low": 3120.79,
            "close": 3123.86
          },
          {
            "time": 1743626700000,
            "open": 3123.86,
            "high": 3124.87,
            "low": 3122.61,
            "close": 3123.59
          },
          {
            "time": 1743627600000,
            "open": 3123.58,
            "high": 3126.28,
            "low": 3122.09,
            "close": 3123.37
          },
          {
            "time": 1743628500000,
            "open": 3123.37,
            "high": 3125.26,
            "low": 3118.84,
            "close": 3119.07
          },
          {
            "time": 1743629400000,
            "open": 3119.06,
            "high": 3123.2,
            "low": 3118.83,
            "close": 3122.84
          },
          {
            "time": 1743630300000,
            "open": 3122.83,
            "high": 3123.52,
            "low": 3121.1,
            "close": 3121.97
          },
          {
            "time": 1743631200000,
            "open": 3122.06,
            "high": 3125.24,
            "low": 3121.65,
            "close": 3123.21
          },
          {
            "time": 1743632100000,
            "open": 3123.21,
            "high": 3126.26,
            "low": 3122.07,
            "close": 3125.72
          },
          {
            "time": 1743633000000,
            "open": 3125.79,
            "high": 3127.27,
            "low": 3125.57,
            "close": 3126.54
          },
          {
            "time": 1743633900000,
            "open": 3126.54,
            "high": 3126.72,
            "low": 3124.16,
            "close": 3124.37
          },
          {
            "time": 1743634800000,
            "open": 3124.35,
            "high": 3125.24,
            "low": 3105.26,
            "close": 3118.19
          },
          {
            "time": 1743635700000,
            "open": 3118.05,
            "high": 3143.38,
            "low": 3107.01,
            "close": 3133.05
          },
          {
            "time": 1743636600000,
            "open": 3132.09,
            "high": 3137.46,
            "low": 3122.88,
            "close": 3130.47
          },
          {
            "time": 1743637500000,
            "open": 3130.47,
            "high": 3137.54,
            "low": 3125.84,
            "close": 3133.41
          },
          {
            "time": 1743642000000,
            "open": 3142.31,
            "high": 3146.48,
            "low": 3124.03,
            "close": 3144.54
          },
          {
            "time": 1743642900000,
            "open": 3144.6,
            "high": 3147.39,
            "low": 3132.07,
            "close": 3136.77
          },
          {
            "time": 1743643800000,
            "open": 3136.77,
            "high": 3144.58,
            "low": 3135.84,
            "close": 3142.53
          },
          {
            "time": 1743644700000,
            "open": 3142.58,
            "high": 3146.13,
            "low": 3141.16,
            "close": 3145.89
          },
          {
            "time": 1743645600000,
            "open": 3145.95,
            "high": 3157.04,
            "low": 3145.95,
            "close": 3156.82
          },
          {
            "time": 1743646500000,
            "open": 3157.02,
            "high": 3159.99,
            "low": 3155.79,
            "close": 3159.79
          },
          {
            "time": 1743647400000,
            "open": 3159.74,
            "high": 3161.22,
            "low": 3157.21,
            "close": 3161.21
          },
          {
            "time": 1743648300000,
            "open": 3160.81,
            "high": 3167.67,
            "low": 3159.44,
            "close": 3162.69
          },
          {
            "time": 1743649200000,
            "open": 3162.72,
            "high": 3164.92,
            "low": 3149.42,
            "close": 3150.55
          },
          {
            "time": 1743650100000,
            "open": 3150.5,
            "high": 3152.12,
            "low": 3140.67,
            "close": 3148.23
          },
          {
            "time": 1743651000000,
            "open": 3148.23,
            "high": 3155.59,
            "low": 3144.48,
            "close": 3146.8
          },
          {
            "time": 1743651900000,
            "open": 3146.79,
            "high": 3153.02,
            "low": 3146.2,
            "close": 3151.38
          },
          {
            "time": 1743652800000,
            "open": 3151.38,
            "high": 3156.5,
            "low": 3148.36,
            "close": 3151.89
          },
          {
            "time": 1743653700000,
            "open": 3151.9,
            "high": 3154.57,
            "low": 3148.03,
            "close": 3152.46
          },
          {
            "time": 1743654600000,
            "open": 3152.44,
            "high": 3163.05,
            "low": 3152.22,
            "close": 3160.05
          },
          {
            "time": 1743655500000,
            "open": 3160.03,
            "high": 3160.41,
            "low": 3150.77,
            "close": 3153.51
          },
          {
            "time": 1743656400000,
            "open": 3153.31,
            "high": 3155.38,
            "low": 3150.45,
            "close": 3151.97
          },
          {
            "time": 1743657300000,
            "open": 3152.05,
            "high": 3154.66,
            "low": 3148.05,
            "close": 3150.08
          },
          {
            "time": 1743658200000,
            "open": 3150.08,
            "high": 3151.06,
            "low": 3144.71,
            "close": 3148.84
          },
          {
            "time": 1743659100000,
            "open": 3148.86,
            "high": 3149.11,
            "low": 3142.26,
            "close": 3145.19
          },
          {
            "time": 1743660000000,
            "open": 3145.37,
            "high": 3152.27,
            "low": 3144.9,
            "close": 3149.22
          },
          {
            "time": 1743660900000,
            "open": 3149.21,
            "high": 3149.42,
            "low": 3146.47,
            "close": 3148.27
          },
          {
            "time": 1743661800000,
            "open": 3148.35,
            "high": 3149.92,
            "low": 3146.23,
            "close": 3147.86
          },
          {
            "time": 1743662700000,
            "open": 3147.86,
            "high": 3150.26,
            "low": 3147.04,
            "close": 3148.0
          },
          {
            "time": 1743663600000,
            "open": 3148.0,
            "high": 3149.7,
            "low": 3147.08,
            "close": 3149.22
          },
          {
            "time": 1743664500000,
            "open": 3149.22,
            "high": 3149.75,
            "low": 3147.29,
            "close": 3148.09
          },
          {
            "time": 1743665400000,
            "open": 3148.09,
            "high": 3148.19,
            "low": 3145.84,
            "close": 3146.05
          },
          {
            "time": 1743666300000,
            "open": 3146.05,
            "high": 3146.11,
            "low": 3139.14,
            "close": 3140.4
          },
          {
            "time": 1743667200000,
            "open": 3140.38,
            "high": 3141.01,
            "low": 3135.41,
            "close": 3136.05
          },
          {
            "time": 1743668100000,
            "open": 3136.06,
            "high": 3136.11,
            "low": 3127.57,
            "close": 3130.64
          },
          {
            "time": 1743669000000,
            "open": 3130.64,
            "high": 3133.97,
            "low": 3126.32,
            "close": 3127.81
          },
          {
            "time": 1743669900000,
            "open": 3127.74,
            "high": 3133.35,
            "low": 3124.19,
            "close": 3131.86
          },
          {
            "time": 1743670800000,
            "open": 3131.84,
            "high": 3134.05,
            "low": 3127.87,
            "close": 3130.93
          },
          {
            "time": 1743671700000,
            "open": 3130.99,
            "high": 3131.4,
            "low": 3121.55,
            "close": 3122.4
          },
          {
            "time": 1743672600000,
            "open": 3122.29,
            "high": 3126.25,
            "low": 3116.52,
            "close": 3124.48
          },
          {
            "time": 1743673500000,
            "open": 3124.49,
            "high": 3131.68,
            "low": 3122.25,
            "close": 3127.61
          },
          {
            "time": 1743674400000,
            "open": 3127.68,
            "high": 3128.05,
            "low": 3119.92,
            "close": 3121.04
          },
          {
            "time": 1743675300000,
            "open": 3121.06,
            "high": 3125.87,
            "low": 3120.1,
            "close": 3125.04
          },
          {
            "time": 1743676200000,
            "open": 3125.01,
            "high": 3126.45,
            "low": 3121.21,
            "close": 3122.39
          },
          {
            "time": 1743677100000,
            "open": 3122.33,
            "high": 3130.21,
            "low": 3121.88,
            "close": 3129.13
          },
          {
            "time": 1743678000000,
            "open": 3129.24,
            "high": 3132.16,
            "low": 3127.34,
            "close": 3129.56
          },
          {
            "time": 1743678900000,
            "open": 3129.56,
            "high": 3131.61,
            "low": 3128.0,
            "close": 3128.43
          },
          {
            "time": 1743679800000,
            "open": 3128.43,
            "high": 3130.81,
            "low": 3128.01,
            "close": 3128.67
          },
          {
            "time": 1743680700000,
            "open": 3128.7,
            "high": 3129.95,
            "low": 3126.17,
            "close": 3129.15
          },
          {
            "time": 1743681600000,
            "open": 3129.1,
            "high": 3129.4,
            "low": 3126.95,
            "close": 3128.61
          },
          {
            "time": 1743682500000,
            "open": 3128.61,
            "high": 3129.64,
            "low": 3124.97,
            "close": 3125.75
          },
          {
            "time": 1743683400000,
            "open": 3125.68,
            "high": 3129.18,
            "low": 3124.4,
            "close": 3127.88
          },
          {
            "time": 1743684300000,
            "open": 3127.88,
            "high": 3128.27,
            "low": 3121.67,
            "close": 3121.67
          },
          {
            "time": 1743685200000,
            "open": 3121.68,
            "high": 3123.09,
            "low": 3112.4,
            "close": 3119.29
          },
          {
            "time": 1743686100000,
            "open": 3119.29,
            "high": 3119.9,
            "low": 3104.78,
            "close": 3107.63
          },
          {
            "time": 1743687000000,
            "open": 3107.64,
            "high": 3108.31,
            "low": 3101.15,
            "close": 3107.24
          },
          {
            "time": 1743687900000,
            "open": 3107.24,
            "high": 3112.95,
            "low": 3089.49,
            "close": 3095.6
          },
          {
            "time": 1743688800000,
            "open": 3095.59,
            "high": 3099.72,
            "low": 3087.85,
            "close": 3098.1
          },
          {
            "time": 1743689700000,
            "open": 3098.19,
            "high": 3100.01,
            "low": 3092.0,
            "close": 3092.27
          },
          {
            "time": 1743690600000,
            "open": 3092.23,
            "high": 3093.31,
            "low": 3085.37,
            "close": 3091.04
          },
          {
            "time": 1743691500000,
            "open": 3091.04,
            "high": 3097.36,
            "low": 3089.6,
            "close": 3093.18
          },
          {
            "time": 1743692400000,
            "open": 3093.18,
            "high": 3094.78,
            "low": 3087.46,
            "close": 3090.53
          },
          {
            "time": 1743693300000,
            "open": 3090.54,
            "high": 3091.03,
            "low": 3075.08,
            "close": 3078.61
          },
          {
            "time": 1743694200000,
            "open": 3078.69,
            "high": 3079.26,
            "low": 3062.14,
            "close": 3065.88
          },
          {
            "time": 1743695100000,
            "open": 3065.88,
            "high": 3080.3,
            "low": 3065.12,
            "close": 3076.4
          },
          {
            "time": 1743696000000,
            "open": 3076.32,
            "high": 3076.38,
            "low": 3054.27,
            "close": 3059.38
          },
          {
            "time": 1743696900000,
            "open": 3059.33,
            "high": 3069.7,
            "low": 3056.39,
            "close": 3065.41
          },
          {
            "time": 1743697800000,
            "open": 3065.4,
            "high": 3088.92,
            "low": 3064.08,
            "close": 3086.74
          },
          {
            "time": 1743698700000,
            "open": 3086.72,
            "high": 3093.45,
            "low": 3084.2,
            "close": 3086.19
          },
          {
            "time": 1743699600000,
            "open": 3086.11,
            "high": 3116.58,
            "low": 3086.11,
            "close": 3114.45
          },
          {
            "time": 1743700500000,
            "open": 3114.39,
            "high": 3126.69,
            "low": 3111.07,
            "close": 3125.35
          },
          {
            "time": 1743701400000,
            "open": 3125.45,
            "high": 3127.89,
            "low": 3117.79,
            "close": 3123.79
          },
          {
            "time": 1743702300000,
            "open": 3123.85,
            "high": 3135.49,
            "low": 3123.85,
            "close": 3128.88
          },
          {
            "time": 1743703200000,
            "open": 3128.92,
            "high": 3129.42,
            "low": 3110.35,
            "close": 3111.63
          },
          {
            "time": 1743704100000,
            "open": 3111.58,
            "high": 3113.47,
            "low": 3104.05,
            "close": 3106.38
          },
          {
            "time": 1743705000000,
            "open": 3106.5,
            "high": 3113.56,
            "low": 3105.63,
            "close": 3112.88
          },
          {
            "time": 1743705900000,
            "open": 3112.88,
            "high": 3112.93,
            "low": 3105.68,
            "close": 3110.67
          },
          {
            "time": 1743706800000,
            "open": 3110.69,
            "high": 3114.22,
            "low": 3104.2,
            "close": 3108.78
          },
          {
            "time": 1743707700000,
            "open": 3108.73,
            "high": 3109.4,
            "low": 3101.91,
            "close": 3108.49
          },
          {
            "time": 1743708600000,
            "open": 3108.51,
            "high": 3110.81,
            "low": 3106.52,
            "close": 3109.42
          },
          {
            "time": 1743709500000,
            "open": 3109.42,
            "high": 3110.67,
            "low": 3107.35,
            "close": 3107.58
          },
          {
            "time": 1743710400000,
            "open": 3107.59,
            "high": 3107.6,
            "low": 3102.13,
            "close": 3103.88
          },
          {
            "time": 1743711300000,
            "open": 3103.89,
            "high": 3105.58,
            "low": 3100.78,
            "close": 3100.96
          },
          {
            "time": 1743712200000,
            "open": 3101.02,
            "high": 3107.83,
            "low": 3100.11,
            "close": 3106.63
          },
          {
            "time": 1743713100000,
            "open": 3106.63,
            "high": 3109.88,
            "low": 3106.14,
            "close": 3109.56
          },
          {
            "time": 1743714000000,
            "open": 3109.56,
            "high": 3110.28,
            "low": 3106.98,
            "close": 3107.32
          },
          {
            "time": 1743714900000,
            "open": 3107.32,
            "high": 3108.44,
            "low": 3102.95,
            "close": 3104.93
          },
          {
            "time": 1743715800000,
            "open": 3104.94,
            "high": 3106.89,
            "low": 3102.19,
            "close": 3106.57
          },
          {
            "time": 1743716700000,
            "open": 3106.55,
            "high": 3111.72,
            "low": 3105.49,
            "close": 3111.66
          },
          {
            "time": 1743717600000,
            "open": 3111.65,
            "high": 3112.81,
            "low": 3110.25,
            "close": 3111.72
          },
          {
            "time": 1743718500000,
            "open": 3111.72,
            "high": 3113.26,
            "low": 3106.75,
            "close": 3107.2
          },
          {
            "time": 1743719400000,
            "open": 3107.21,
            "high": 3107.3,
            "low": 3102.59,
            "close": 3104.81
          },
          {
            "time": 1743720300000,
            "open": 3104.68,
            "high": 3108.18,
            "low": 3101.67,
            "close": 3107.57
          },
          {
            "time": 1743721200000,
            "open": 3107.58,
            "high": 3109.44,
            "low": 3107.42,
            "close": 3107.76
          },
          {
            "time": 1743722100000,
            "open": 3107.76,
            "high": 3110.93,
            "low": 3107.7,
            "close": 3110.03
          },
          {
            "time": 1743723000000,
            "open": 3110.0,
            "high": 3117.83,
            "low": 3109.82,
            "close": 3117.32
          },
          {
            "time": 1743723900000,
            "open": 3117.32,
            "high": 3119.82,
            "low": 3112.97,
            "close": 3113.38
          },
          {
            "time": 1743728400000,
            "open": 3114.6,
            "high": 3115.18,
            "low": 3113.25,
            "close": 3114.43
          },
          {
            "time": 1743729300000,
            "open": 3114.43,
            "high": 3115.07,
            "low": 3112.92,
            "close": 3114.56
          },
          {
            "time": 1743730200000,
            "open": 3114.56,
            "high": 3116.75,
            "low": 3114.37,
            "close": 3116.12
          },
          {
            "time": 1743731100000,
            "open": 3116.04,
            "high": 3116.21,
            "low": 3112.46,
            "close": 3115.4
          },
          {
            "time": 1743732000000,
            "open": 3115.4,
            "high": 3115.45,
            "low": 3109.85,
            "close": 3111.29
          },
          {
            "time": 1743732900000,
            "open": 3111.29,
            "high": 3112.97,
            "low": 3110.61,
            "close": 3112.67
          },
          {
            "time": 1743733800000,
            "open": 3112.67,
            "high": 3115.34,
            "low": 3112.51,
            "close": 3114.52
          },
          {
            "time": 1743734700000,
            "open": 3114.52,
            "high": 3116.36,
            "low": 3112.89,
            "close": 3112.96
          },
          {
            "time": 1743735600000,
            "open": 3112.96,
            "high": 3115.12,
            "low": 3111.98,
            "close": 3112.64
          },
          {
            "time": 1743736500000,
            "open": 3112.64,
            "high": 3113.35,
            "low": 3109.17,
            "close": 3109.26
          },
          {
            "time": 1743737400000,
            "open": 3109.29,
            "high": 3111.08,
            "low": 3106.07,
            "close": 3110.93
          },
          {
            "time": 1743738300000,
            "open": 3110.91,
            "high": 3111.69,
            "low": 3108.57,
            "close": 3110.68
          },
          {
            "time": 1743739200000,
            "open": 3110.68,
            "high": 3115.81,
            "low": 3110.44,
            "close": 3114.65
          },
          {
            "time": 1743740100000,
            "open": 3114.67,
            "high": 3114.92,
            "low": 3111.79,
            "close": 3113.88
          },
          {
            "time": 1743741000000,
            "open": 3113.88,
            "high": 3114.39,
            "low": 3109.19,
            "close": 3110.1
          },
          {
            "time": 1743741900000,
            "open": 3110.1,
            "high": 3112.76,
            "low": 3109.48,
            "close": 3109.84
          },
          {
            "time": 1743742800000,
            "open": 3109.82,
            "high": 3112.97,
            "low": 3107.54,
            "close": 3112.84
          },
          {
            "time": 1743743700000,
            "open": 3112.76,
            "high": 3112.88,
            "low": 3104.45,
            "close": 3104.72
          },
          {
            "time": 1743744600000,
            "open": 3104.85,
            "high": 3106.1,
            "low": 3091.35,
            "close": 3098.5
          },
          {
            "time": 1743745500000,
            "open": 3098.5,
            "high": 3099.25,
            "low": 3092.91,
            "close": 3096.86
          },
          {
            "time": 1743746400000,
            "open": 3096.82,
            "high": 3099.1,
            "low": 3087.03,
            "close": 3093.76
          },
          {
            "time": 1743747300000,
            "open": 3093.76,
            "high": 3094.3,
            "low": 3089.84,
            "close": 3093.51
          },
          {
            "time": 1743748200000,
            "open": 3093.51,
            "high": 3095.62,
            "low": 3091.81,
            "close": 3094.92
          },
          {
            "time": 1743749100000,
            "open": 3094.91,
            "high": 3098.46,
            "low": 3092.79,
            "close": 3098.46
          },
          {
            "time": 1743750000000,
            "open": 3098.47,
            "high": 3100.46,
            "low": 3096.07,
            "close": 3099.54
          },
          {
            "time": 1743750900000,
            "open": 3099.54,
            "high": 3101.76,
            "low": 3098.23,
            "close": 3098.92
          },
          {
            "time": 1743751800000,
            "open": 3098.92,
            "high": 3104.51,
            "low": 3097.54,
            "close": 3104.3
          },
          {
            "time": 1743752700000,
            "open": 3104.24,
            "high": 3105.0,
            "low": 3098.2,
            "close": 3100.12
          },
          {
            "time": 1743753600000,
            "open": 3099.97,
            "high": 3105.01,
            "low": 3098.87,
            "close": 3101.98
          },
          {
            "time": 1743754500000,
            "open": 3101.98,
            "high": 3107.54,
            "low": 3101.52,
            "close": 3106.06
          },
          {
            "time": 1743755400000,
            "open": 3106.06,
            "high": 3106.06,
            "low": 3101.79,
            "close": 3102.87
          },
          {
            "time": 1743756300000,
            "open": 3102.87,
            "high": 3108.86,
            "low": 3102.64,
            "close": 3108.85
          },
          {
            "time": 1743757200000,
            "open": 3108.89,
            "high": 3109.95,
            "low": 3106.46,
            "close": 3107.5
          },
          {
            "time": 1743758100000,
            "open": 3107.5,
            "high": 3107.94,
            "low": 3102.54,
            "close": 3102.91
          },
          {
            "time": 1743759000000,
            "open": 3102.91,
            "high": 3104.66,
            "low": 3100.72,
            "close": 3101.28
          },
          {
            "time": 1743759900000,
            "open": 3101.3,
            "high": 3103.5,
            "low": 3100.59,
            "close": 3101.11
          },
          {
            "time": 1743760800000,
            "open": 3101.05,
            "high": 3102.6,
            "low": 3095.02,
            "close": 3100.2
          },
          {
            "time": 1743761700000,
            "open": 3100.2,
            "high": 3103.51,
            "low": 3092.95,
            "close": 3100.39
          },
          {
            "time": 1743762600000,
            "open": 3100.39,
            "high": 3100.48,
            "low": 3093.71,
            "close": 3093.87
          },
          {
            "time": 1743763500000,
            "open": 3093.87,
            "high": 3096.66,
            "low": 3092.07,
            "close": 3092.85
          },
          {
            "time": 1743764400000,
            "open": 3092.85,
            "high": 3094.13,
            "low": 3088.32,
            "close": 3089.1
          },
          {
            "time": 1743765300000,
            "open": 3089.13,
            "high": 3089.39,
            "low": 3082.0,
            "close": 3084.66
          },
          {
            "time": 1743766200000,
            "open": 3084.83,
            "high": 3084.83,
            "low": 3078.49,
            "close": 3083.21
          },
          {
            "time": 1743767100000,
            "open": 3083.21,
            "high": 3085.86,
            "low": 3081.48,
            "close": 3084.24
          },
          {
            "time": 1743768000000,
            "open": 3084.24,
            "high": 3092.43,
            "low": 3083.91,
            "close": 3090.95
          },
          {
            "time": 1743768900000,
            "open": 3090.95,
            "high": 3096.01,
            "low": 3090.0,
            "close": 3093.73
          },
          {
            "time": 1743769800000,
            "open": 3093.74,
            "high": 3093.78,
            "low": 3088.2,
            "close": 3088.23
          },
          {
            "time": 1743770700000,
            "open": 3088.22,
            "high": 3094.73,
            "low": 3086.65,
            "close": 3090.68
          },
          {
            "time": 1743771600000,
            "open": 3090.69,
            "high": 3100.18,
            "low": 3090.64,
            "close": 3095.31
          },
          {
            "time": 1743772500000,
            "open": 3095.31,
            "high": 3107.04,
            "low": 3093.92,
            "close": 3106.89
          },
          {
            "time": 1743773400000,
            "open": 3106.93,
            "high": 3116.2,
            "low": 3104.45,
            "close": 3111.24
          },
          {
            "time": 1743774300000,
            "open": 3111.15,
            "high": 3115.63,
            "low": 3104.74,
            "close": 3110.47
          },
          {
            "time": 1743775200000,
            "open": 3110.34,
            "high": 3136.67,
            "low": 3109.16,
            "close": 3134.5
          },
          {
            "time": 1743776100000,
            "open": 3134.49,
            "high": 3134.55,
            "low": 3126.23,
            "close": 3127.34
          },
          {
            "time": 1743777000000,
            "open": 3127.34,
            "high": 3129.26,
            "low": 3107.0,
            "close": 3109.52
          },
          {
            "time": 1743777900000,
            "open": 3109.52,
            "high": 3112.24,
            "low": 3095.75,
            "close": 3110.35
          },
          {
            "time": 1743778800000,
            "open": 3110.71,
            "high": 3111.82,
            "low": 3091.65,
            "close": 3092.81
          },
          {
            "time": 1743779700000,
            "open": 3092.65,
            "high": 3104.22,
            "low": 3091.4,
            "close": 3096.91
          },
          {
            "time": 1743780600000,
            "open": 3097.23,
            "high": 3101.54,
            "low": 3070.82,
            "close": 3088.91
          },
          {
            "time": 1743781500000,
            "open": 3088.91,
            "high": 3090.24,
            "low": 3069.91,
            "close": 3071.18
          },
          {
            "time": 1743782400000,
            "open": 3071.26,
            "high": 3082.66,
            "low": 3070.12,
            "close": 3082.39
          },
          {
            "time": 1743783300000,
            "open": 3082.39,
            "high": 3087.42,
            "low": 3075.69,
            "close": 3075.79
          },
          {
            "time": 1743784200000,
            "open": 3075.52,
            "high": 3080.36,
            "low": 3059.97,
            "close": 3074.81
          },
          {
            "time": 1743785100000,
            "open": 3074.83,
            "high": 3077.01,
            "low": 3061.51,
            "close": 3061.98
          },
          {
            "time": 1743786000000,
            "open": 3061.83,
            "high": 3061.83,
            "low": 3047.43,
            "close": 3048.91
          },
          {
            "time": 1743786900000,
            "open": 3048.76,
            "high": 3058.8,
            "low": 3041.9,
            "close": 3047.79
          },
          {
            "time": 1743787800000,
            "open": 3047.76,
            "high": 3051.53,
            "low": 3041.88,
            "close": 3042.76
          },
          {
            "time": 1743788700000,
            "open": 3042.75,
            "high": 3050.64,
            "low": 3027.19,
            "close": 3038.49
          },
          {
            "time": 1743789600000,
            "open": 3038.39,
            "high": 3050.39,
            "low": 3031.48,
            "close": 3044.25
          },
          {
            "time": 1743790500000,
            "open": 3044.05,
            "high": 3044.67,
            "low": 3023.74,
            "close": 3026.29
          },
          {
            "time": 1743791400000,
            "open": 3026.31,
            "high": 3035.56,
            "low": 3017.51,
            "close": 3017.93
          },
          {
            "time": 1743792300000,
            "open": 3017.93,
            "high": 3025.08,
            "low": 3017.04,
            "close": 3021.92
          },
          {
            "time": 1743793200000,
            "open": 3021.92,
            "high": 3026.2,
            "low": 3017.91,
            "close": 3022.54
          },
          {
            "time": 1743794100000,
            "open": 3022.34,
            "high": 3032.46,
            "low": 3020.92,
            "close": 3030.78
          },
          {
            "time": 1743795000000,
            "open": 3030.71,
            "high": 3036.82,
            "low": 3026.79,
            "close": 3032.58
          },
          {
            "time": 1743795900000,
            "open": 3032.59,
            "high": 3032.68,
            "low": 3029.26,
            "close": 3030.97
          },
          {
            "time": 1743796800000,
            "open": 3031.01,
            "high": 3032.94,
            "low": 3024.64,
            "close": 3027.3
          },
          {
            "time": 1743797700000,
            "open": 3027.4,
            "high": 3027.91,
            "low": 3017.33,
            "close": 3018.55
          },
          {
            "time": 1743798600000,
            "open": 3018.14,
            "high": 3028.55,
            "low": 3015.85,
            "close": 3023.97
          },
          {
            "time": 1743799500000,
            "open": 3023.91,
            "high": 3026.54,
            "low": 3022.82,
            "close": 3025.82
          },
          {
            "time": 1743800400000,
            "open": 3025.82,
            "high": 3027.76,
            "low": 3022.31,
            "close": 3024.3
          },
          {
            "time": 1743801300000,
            "open": 3024.3,
            "high": 3025.61,
            "low": 3021.63,
            "close": 3024.61
          },
          {
            "time": 1743802200000,
            "open": 3025.09,
            "high": 3026.21,
            "low": 3021.66,
            "close": 3021.98
          },
          {
            "time": 1743803100000,
            "open": 3021.97,
            "high": 3026.07,
            "low": 3018.04,
            "close": 3025.56
          },
          {
            "time": 1743804000000,
            "open": 3025.56,
            "high": 3027.87,
            "low": 3022.15,
            "close": 3023.68
          },
          {
            "time": 1743804900000,
            "open": 3023.68,
            "high": 3034.73,
            "low": 3022.12,
            "close": 3028.65
          },
          {
            "time": 1743805800000,
            "open": 3028.65,
            "high": 3031.62,
            "low": 3027.86,
            "close": 3030.1
          },
          {
            "time": 1743806700000,
            "open": 3030.25,
            "high": 3040.96,
            "low": 3030.11,
            "close": 3036.46
          },
          {
            "time": 1743807600000,
            "open": 3036.48,
            "high": 3038.57,
            "low": 3033.89,
            "close": 3038.53
          },
          {
            "time": 1743808500000,
            "open": 3038.53,
            "high": 3041.07,
            "low": 3036.0,
            "close": 3038.18
          },
          {
            "time": 1743809400000,
            "open": 3038.18,
            "high": 3038.61,
            "low": 3035.77,
            "close": 3035.98
          },
          {
            "time": 1743810300000,
            "open": 3036.0,
            "high": 3038.75,
            "low": 3035.83,
            "close": 3038.48
          },
          {
            "time": 1743987600000,
            "open": 3008.7,
            "high": 3038.65,
            "low": 3004.71,
            "close": 3031.68
          },
          {
            "time": 1743988500000,
            "open": 3031.65,
            "high": 3031.96,
            "low": 2999.04,
            "close": 3015.11
          },
          {
            "time": 1743989400000,
            "open": 3015.11,
            "high": 3021.74,
            "low": 3007.64,
            "close": 3016.82
          },
          {
            "time": 1743990300000,
            "open": 3016.76,
            "high": 3017.77,
            "low": 3004.53,
            "close": 3009.9
          },
          {
            "time": 1743991200000,
            "open": 3009.9,
            "high": 3017.15,
            "low": 3004.84,
            "close": 3009.15
          },
          {
            "time": 1743992100000,
            "open": 3008.96,
            "high": 3009.0,
            "low": 2983.72,
            "close": 2985.37
          },
          {
            "time": 1743993000000,
            "open": 2985.37,
            "high": 2990.61,
            "low": 2977.32,
            "close": 2987.5
          },
          {
            "time": 1743993900000,
            "open": 2987.5,
            "high": 3002.1,
            "low": 2984.28,
            "close": 2999.73
          },
          {
            "time": 1743994800000,
            "open": 2999.75,
            "high": 3009.43,
            "low": 2972.62,
            "close": 2981.83
          },
          {
            "time": 1743995700000,
            "open": 2981.74,
            "high": 2991.49,
            "low": 2976.08,
            "close": 2985.52
          },
          {
            "time": 1743996600000,
            "open": 2985.52,
            "high": 2992.82,
            "low": 2979.8,
            "close": 2982.88
          },
          {
            "time": 1743997500000,
            "open": 2982.89,
            "high": 2988.73,
            "low": 2973.09,
            "close": 2979.04
          },
          {
            "time": 1743998400000,
            "open": 2979.04,
            "high": 3008.77,
            "low": 2972.25,
            "close": 3006.76
          },
          {
            "time": 1743999300000,
            "open": 3006.62,
            "high": 3020.87,
            "low": 3004.73,
            "close": 3019.23
          },
          {
            "time": 1744000200000,
            "open": 3019.27,
            "high": 3054.95,
            "low": 3016.53,
            "close": 3052.22
          },
          {
            "time": 1744001100000,
            "open": 3052.22,
            "high": 3054.97,
            "low": 3036.35,
            "close": 3038.35
          },
          {
            "time": 1744002000000,
            "open": 3038.66,
            "high": 3055.43,
            "low": 3036.32,
            "close": 3052.91
          },
          {
            "time": 1744002900000,
            "open": 3052.94,
            "high": 3053.67,
            "low": 3040.04,
            "close": 3042.42
          },
          {
            "time": 1744003800000,
            "open": 3042.43,
            "high": 3045.04,
            "low": 3027.36,
            "close": 3032.56
          },
          {
            "time": 1744004700000,
            "open": 3032.56,
            "high": 3035.87,
            "low": 3024.33,
            "close": 3025.93
          },
          {
            "time": 1744005600000,
            "open": 3025.85,
            "high": 3030.19,
            "low": 3021.76,
            "close": 3026.2
          },
          {
            "time": 1744006500000,
            "open": 3026.15,
            "high": 3031.31,
            "low": 3025.6,
            "close": 3029.92
          },
          {
            "time": 1744007400000,
            "open": 3029.6,
            "high": 3034.0,
            "low": 3026.03,
            "close": 3027.23
          },
          {
            "time": 1744008300000,
            "open": 3027.23,
            "high": 3029.02,
            "low": 3017.34,
            "close": 3019.02
          },
          {
            "time": 1744009200000,
            "open": 3019.04,
            "high": 3031.86,
            "low": 3019.02,
            "close": 3027.13
          },
          {
            "time": 1744010100000,
            "open": 3027.02,
            "high": 3030.47,
            "low": 3023.98,
            "close": 3026.48
          },
          {
            "time": 1744011000000,
            "open": 3026.61,
            "high": 3032.89,
            "low": 3025.19,
            "close": 3028.25
          },
          {
            "time": 1744011900000,
            "open": 3028.25,
            "high": 3035.84,
            "low": 3026.15,
            "close": 3035.71
          },
          {
            "time": 1744012800000,
            "open": 3035.66,
            "high": 3037.54,
            "low": 3024.96,
            "close": 3029.6
          },
          {
            "time": 1744013700000,
            "open": 3029.6,
            "high": 3040.17,
            "low": 3029.29,
            "close": 3038.84
          },
          {
            "time": 1744014600000,
            "open": 3038.84,
            "high": 3044.61,
            "low": 3034.04,
            "close": 3039.35
          },
          {
            "time": 1744015500000,
            "open": 3039.35,
            "high": 3043.49,
            "low": 3031.75,
            "close": 3031.82
          },
          {
            "time": 1744016400000,
            "open": 3031.79,
            "high": 3033.57,
            "low": 3022.34,
            "close": 3026.83
          },
          {
            "time": 1744017300000,
            "open": 3026.82,
            "high": 3028.09,
            "low": 3016.74,
            "close": 3018.51
          },
          {
            "time": 1744018200000,
            "open": 3018.59,
            "high": 3031.55,
            "low": 3018.59,
            "close": 3027.86
          },
          {
            "time": 1744019100000,
            "open": 3027.73,
            "high": 3030.77,
            "low": 3018.76,
            "close": 3029.38
          },
          {
            "time": 1744020000000,
            "open": 3029.84,
            "high": 3030.74,
            "low": 3013.37,
            "close": 3014.32
          },
          {
            "time": 1744020900000,
            "open": 3014.37,
            "high": 3027.48,
            "low": 3013.79,
            "close": 3019.12
          },
          {
            "time": 1744021800000,
            "open": 3019.05,
            "high": 3026.56,
            "low": 3019.05,
            "close": 3019.21
          },
          {
            "time": 1744022700000,
            "open": 3019.22,
            "high": 3029.1,
            "low": 3015.9,
            "close": 3018.64
          },
          {
            "time": 1744023600000,
            "open": 3018.79,
            "high": 3028.3,
            "low": 3017.99,
            "close": 3027.79
          },
          {
            "time": 1744024500000,
            "open": 3027.79,
            "high": 3029.71,
            "low": 3023.09,
            "close": 3023.41
          },
          {
            "time": 1744025400000,
            "open": 3023.4,
            "high": 3028.85,
            "low": 3020.98,
            "close": 3027.5
          },
          {
            "time": 1744026300000,
            "open": 3027.53,
            "high": 3035.49,
            "low": 3026.8,
            "close": 3031.15
          },
          {
            "time": 1744027200000,
            "open": 3031.61,
            "high": 3033.46,
            "low": 3025.71,
            "close": 3027.85
          },
          {
            "time": 1744028100000,
            "open": 3027.85,
            "high": 3027.85,
            "low": 3019.64,
            "close": 3026.71
          },
          {
            "time": 1744029000000,
            "open": 3026.77,
            "high": 3031.7,
            "low": 3023.86,
            "close": 3025.63
          },
          {
            "time": 1744029900000,
            "open": 3025.62,
            "high": 3028.68,
            "low": 3019.73,
            "close": 3025.05
          },
          {
            "time": 1744030800000,
            "open": 3025.02,
            "high": 3030.81,
            "low": 3024.12,
            "close": 3026.69
          },
          {
            "time": 1744031700000,
            "open": 3026.66,
            "high": 3033.29,
            "low": 3026.35,
            "close": 3032.64
          },
          {
            "time": 1744032600000,
            "open": 3032.64,
            "high": 3036.57,
            "low": 3031.86,
            "close": 3032.38
          },
          {
            "time": 1744033500000,
            "open": 3032.37,
            "high": 3036.47,
            "low": 3030.16,
            "close": 3031.39
          },
          {
            "time": 1744034400000,
            "open": 3031.39,
            "high": 3042.44,
            "low": 3031.16,
            "close": 3040.39
          },
          {
            "time": 1744035300000,
            "open": 3040.4,
            "high": 3044.05,
            "low": 3038.72,
            "close": 3040.36
          },
          {
            "time": 1744036200000,
            "open": 3040.4,
            "high": 3046.07,
            "low": 3038.85,
            "close": 3039.67
          },
          {
            "time": 1744037100000,
            "open": 3039.62,
            "high": 3040.38,
            "low": 3030.24,
            "close": 3031.17
          },
          {
            "time": 1744038000000,
            "open": 3031.47,
            "high": 3031.68,
            "low": 3025.18,
            "close": 3025.8
          },
          {
            "time": 1744038900000,
            "open": 3025.8,
            "high": 3031.48,
            "low": 3024.66,
            "close": 3026.62
          },
          {
            "time": 1744039800000,
            "open": 3026.6,
            "high": 3030.19,
            "low": 3014.9,
            "close": 3020.51
          },
          {
            "time": 1744040700000,
            "open": 3020.42,
            "high": 3032.8,
            "low": 3019.8,
            "close": 3031.35
          },
          {
            "time": 1744041600000,
            "open": 3031.26,
            "high": 3034.07,
            "low": 3024.64,
            "close": 3027.67
          },
          {
            "time": 1744042500000,
            "open": 3027.67,
            "high": 3030.35,
            "low": 3021.61,
            "close": 3024.71
          },
          {
            "time": 1744043400000,
            "open": 3024.63,
            "high": 3026.73,
            "low": 3002.34,
            "close": 3007.1
          },
          {
            "time": 1744044300000,
            "open": 3007.01,
            "high": 3019.14,
            "low": 3004.08,
            "close": 3015.57
          },
          {
            "time": 1744045200000,
            "open": 3015.44,
            "high": 3032.42,
            "low": 3011.0,
            "close": 3027.27
          },
          {
            "time": 1744046100000,
            "open": 3027.13,
            "high": 3038.0,
            "low": 3005.58,
            "close": 3008.95
          },
          {
            "time": 1744047000000,
            "open": 3008.76,
            "high": 3013.85,
            "low": 2997.34,
            "close": 3003.42
          },
          {
            "time": 1744047900000,
            "open": 3003.35,
            "high": 3009.2,
            "low": 2996.6,
            "close": 2999.33
          },
          {
            "time": 1744048800000,
            "open": 2999.51,
            "high": 3004.73,
            "low": 2983.97,
            "close": 2984.77
          },
          {
            "time": 1744049700000,
            "open": 2984.67,
            "high": 2998.97,
            "low": 2984.27,
            "close": 2987.01
          },
          {
            "time": 1744050600000,
            "open": 2987.13,
            "high": 2988.8,
            "low": 2981.37,
            "close": 2984.63
          },
          {
            "time": 1744051500000,
            "open": 2984.65,
            "high": 2988.23,
            "low": 2980.12,
            "close": 2987.64
          },
          {
            "time": 1744052400000,
            "open": 2987.64,
            "high": 2987.95,
            "low": 2977.39,
            "close": 2979.94
          },
          {
            "time": 1744053300000,
            "open": 2979.93,
            "high": 2985.4,
            "low": 2975.31,
            "close": 2977.98
          },
          {
            "time": 1744054200000,
            "open": 2977.83,
            "high": 2984.87,
            "low": 2975.08,
            "close": 2975.19
          },
          {
            "time": 1744055100000,
            "open": 2975.2,
            "high": 2975.7,
            "low": 2970.23,
            "close": 2970.71
          },
          {
            "time": 1744056000000,
            "open": 2970.97,
            "high": 2975.28,
            "low": 2959.73,
            "close": 2966.25
          },
          {
            "time": 1744056900000,
            "open": 2966.32,
            "high": 2970.84,
            "low": 2956.87,
            "close": 2959.04
          },
          {
            "time": 1744057800000,
            "open": 2958.94,
            "high": 2969.05,
            "low": 2956.67,
            "close": 2968.31
          },
          {
            "time": 1744058700000,
            "open": 2968.29,
            "high": 2973.76,
            "low": 2966.18,
            "close": 2970.21
          },
          {
            "time": 1744059600000,
            "open": 2970.19,
            "high": 2973.5,
            "low": 2969.42,
            "close": 2970.98
          },
          {
            "time": 1744060500000,
            "open": 2970.98,
            "high": 2974.12,
            "low": 2969.23,
            "close": 2969.82
          },
          {
            "time": 1744061400000,
            "open": 2969.88,
            "high": 2976.71,
            "low": 2968.66,
            "close": 2971.77
          },
          {
            "time": 1744062300000,
            "open": 2971.88,
            "high": 2972.47,
            "low": 2964.11,
            "close": 2965.87
          },
          {
            "time": 1744063200000,
            "open": 2965.87,
            "high": 2972.87,
            "low": 2965.41,
            "close": 2971.84
          },
          {
            "time": 1744064100000,
            "open": 2971.77,
            "high": 2975.5,
            "low": 2969.55,
            "close": 2974.14
          },
          {
            "time": 1744065000000,
            "open": 2974.13,
            "high": 2982.01,
            "low": 2973.55,
            "close": 2978.51
          },
          {
            "time": 1744065900000,
            "open": 2978.71,
            "high": 2978.82,
            "low": 2974.93,
            "close": 2976.68
          },
          {
            "time": 1744066800000,
            "open": 2976.78,
            "high": 2980.62,
            "low": 2970.12,
            "close": 2979.35
          },
          {
            "time": 1744067700000,
            "open": 2979.35,
            "high": 2985.86,
            "low": 2979.31,
            "close": 2983.93
          },
          {
            "time": 1744068600000,
            "open": 2983.93,
            "high": 2986.0,
            "low": 2983.44,
            "close": 2985.19
          },
          {
            "time": 1744069500000,
            "open": 2985.2,
            "high": 2985.23,
            "low": 2982.66,
            "close": 2982.66
          },
          {
            "time": 1744074000000,
            "open": 2983.22,
            "high": 2987.31,
            "low": 2981.15,
            "close": 2983.67
          },
          {
            "time": 1744074900000,
            "open": 2983.67,
            "high": 2985.73,
            "low": 2982.42,
            "close": 2985.71
          },
          {
            "time": 1744075800000,
            "open": 2985.63,
            "high": 2988.47,
            "low": 2983.73,
            "close": 2983.86
          },
          {
            "time": 1744076700000,
            "open": 2983.83,
            "high": 2988.61,
            "low": 2983.56,
            "close": 2986.82
          },
          {
            "time": 1744077600000,
            "open": 2986.82,
            "high": 2987.48,
            "low": 2985.05,
            "close": 2985.85
          },
          {
            "time": 1744078500000,
            "open": 2985.85,
            "high": 2985.93,
            "low": 2981.7,
            "close": 2981.91
          },
          {
            "time": 1744079400000,
            "open": 2981.84,
            "high": 2983.29,
            "low": 2978.63,
            "close": 2980.03
          },
          {
            "time": 1744080300000,
            "open": 2980.03,
            "high": 2983.33,
            "low": 2980.03,
            "close": 2981.33
          },
          {
            "time": 1744081200000,
            "open": 2981.33,
            "high": 2987.18,
            "low": 2980.5,
            "close": 2985.33
          },
          {
            "time": 1744082100000,
            "open": 2985.36,
            "high": 2989.16,
            "low": 2983.74,
            "close": 2989.08
          },
          {
            "time": 1744083000000,
            "open": 2989.08,
            "high": 2992.72,
            "low": 2988.72,
            "close": 2991.74
          },
          {
            "time": 1744083900000,
            "open": 2991.74,
            "high": 2991.89,
            "low": 2983.05,
            "close": 2985.44
          },
          {
            "time": 1744084800000,
            "open": 2985.44,
            "high": 3000.98,
            "low": 2983.72,
            "close": 2995.36
          },
          {
            "time": 1744085700000,
            "open": 2995.42,
            "high": 2999.82,
            "low": 2989.68,
            "close": 2996.17
          },
          {
            "time": 1744086600000,
            "open": 2996.17,
            "high": 3003.17,
            "low": 2994.97,
            "close": 3000.11
          },
          {
            "time": 1744087500000,
            "open": 3000.09,
            "high": 3001.24,
            "low": 2996.23,
            "close": 2999.92
          },
          {
            "time": 1744088400000,
            "open": 2999.92,
            "high": 3004.7,
            "low": 2999.0,
            "close": 3002.51
          },
          {
            "time": 1744089300000,
            "open": 3002.51,
            "high": 3003.35,
            "low": 2998.32,
            "close": 2999.76
          },
          {
            "time": 1744090200000,
            "open": 2999.71,
            "high": 3004.94,
            "low": 2998.57,
            "close": 3003.67
          },
          {
            "time": 1744091100000,
            "open": 3003.67,
            "high": 3004.22,
            "low": 2999.52,
            "close": 3000.98
          },
          {
            "time": 1744092000000,
            "open": 3000.99,
            "high": 3001.1,
            "low": 2993.1,
            "close": 2995.45
          },
          {
            "time": 1744092900000,
            "open": 2995.45,
            "high": 3000.81,
            "low": 2994.05,
            "close": 2995.32
          },
          {
            "time": 1744093800000,
            "open": 2995.32,
            "high": 2998.61,
            "low": 2994.86,
            "close": 2998.33
          },
          {
            "time": 1744094700000,
            "open": 2998.36,
            "high": 2999.01,
            "low": 2993.7,
            "close": 2994.74
          },
          {
            "time": 1744095600000,
            "open": 2994.67,
            "high": 2999.78,
            "low": 2994.2,
            "close": 2998.48
          },
          {
            "time": 1744096500000,
            "open": 2998.59,
            "high": 2998.91,
            "low": 2995.31,
            "close": 2995.9
          },
          {
            "time": 1744097400000,
            "open": 2995.9,
            "high": 2997.41,
            "low": 2990.9,
            "close": 2995.53
          },
          {
            "time": 1744098300000,
            "open": 2995.53,
            "high": 3003.06,
            "low": 2994.61,
            "close": 3002.38
          },
          {
            "time": 1744099200000,
            "open": 3002.2,
            "high": 3004.5,
            "low": 3000.21,
            "close": 3004.25
          },
          {
            "time": 1744100100000,
            "open": 3004.25,
            "high": 3005.3,
            "low": 2999.87,
            "close": 3000.04
          },
          {
            "time": 1744101000000,
            "open": 3000.03,
            "high": 3005.16,
            "low": 2999.55,
            "close": 3000.39
          },
          {
            "time": 1744101900000,
            "open": 3000.43,
            "high": 3008.44,
            "low": 3000.39,
            "close": 3005.77
          },
          {
            "time": 1744102800000,
            "open": 3005.72,
            "high": 3006.41,
            "low": 3002.48,
            "close": 3004.6
          },
          {
            "time": 1744103700000,
            "open": 3004.62,
            "high": 3013.48,
            "low": 3004.3,
            "close": 3011.86
          },
          {
            "time": 1744104600000,
            "open": 3011.86,
            "high": 3015.93,
            "low": 3010.55,
            "close": 3013.7
          },
          {
            "time": 1744105500000,
            "open": 3013.7,
            "high": 3014.07,
            "low": 3011.19,
            "close": 3013.36
          },
          {
            "time": 1744106400000,
            "open": 3013.64,
            "high": 3013.64,
            "low": 3008.29,
            "close": 3012.22
          },
          {
            "time": 1744107300000,
            "open": 3012.25,
            "high": 3014.0,
            "low": 3007.6,
            "close": 3010.24
          },
          {
            "time": 1744108200000,
            "open": 3010.24,
            "high": 3011.46,
            "low": 3002.45,
            "close": 3003.21
          },
          {
            "time": 1744109100000,
            "open": 3003.25,
            "high": 3006.66,
            "low": 3001.93,
            "close": 3003.69
          },
          {
            "time": 1744110000000,
            "open": 3003.57,
            "high": 3008.05,
            "low": 3001.37,
            "close": 3007.48
          },
          {
            "time": 1744110900000,
            "open": 3007.48,
            "high": 3009.38,
            "low": 3006.35,
            "close": 3008.93
          },
          {
            "time": 1744111800000,
            "open": 3008.93,
            "high": 3009.13,
            "low": 3003.66,
            "close": 3007.46
          },
          {
            "time": 1744112700000,
            "open": 3007.46,
            "high": 3008.09,
            "low": 3004.3,
            "close": 3007.5
          },
          {
            "time": 1744113600000,
            "open": 3007.48,
            "high": 3007.48,
            "low": 3002.48,
            "close": 3003.15
          },
          {
            "time": 1744114500000,
            "open": 3003.15,
            "high": 3003.22,
            "low": 2994.86,
            "close": 2995.82
          },
          {
            "time": 1744115400000,
            "open": 2995.85,
            "high": 3007.74,
            "low": 2995.85,
            "close": 3006.46
          },
          {
            "time": 1744116300000,
            "open": 3006.36,
            "high": 3007.71,
            "low": 3003.22,
            "close": 3006.89
          },
          {
            "time": 1744117200000,
            "open": 3006.97,
            "high": 3008.6,
            "low": 3004.14,
            "close": 3005.46
          },
          {
            "time": 1744118100000,
            "open": 3005.34,
            "high": 3008.77,
            "low": 3004.65,
            "close": 3008.05
          },
          {
            "time": 1744119000000,
            "open": 3008.05,
            "high": 3009.97,
            "low": 3005.4,
            "close": 3008.21
          },
          {
            "time": 1744119900000,
            "open": 3008.21,
            "high": 3010.29,
            "low": 3007.1,
            "close": 3009.0
          },
          {
            "time": 1744120800000,
            "open": 3009.0,
            "high": 3011.89,
            "low": 3008.72,
            "close": 3011.43
          },
          {
            "time": 1744121700000,
            "open": 3011.44,
            "high": 3014.24,
            "low": 3010.41,
            "close": 3010.62
          },
          {
            "time": 1744122600000,
            "open": 3010.63,
            "high": 3013.32,
            "low": 3008.93,
            "close": 3009.25
          },
          {
            "time": 1744123500000,
            "open": 3009.26,
            "high": 3019.43,
            "low": 3009.22,
            "close": 3017.48
          },
          {
            "time": 1744124400000,
            "open": 3017.5,
            "high": 3019.56,
            "low": 3014.23,
            "close": 3017.58
          },
          {
            "time": 1744125300000,
            "open": 3017.52,
            "high": 3017.52,
            "low": 3003.31,
            "close": 3009.66
          },
          {
            "time": 1744126200000,
            "open": 3009.67,
            "high": 3012.99,
            "low": 3006.82,
            "close": 3007.07
          },
          {
            "time": 1744127100000,
            "open": 3007.07,
            "high": 3008.49,
            "low": 3002.48,
            "close": 3002.63
          },
          {
            "time": 1744128000000,
            "open": 3002.61,
            "high": 3020.58,
            "low": 3002.61,
            "close": 3018.62
          },
          {
            "time": 1744128900000,
            "open": 3018.62,
            "high": 3022.7,
            "low": 3013.26,
            "close": 3013.81
          },
          {
            "time": 1744129800000,
            "open": 3013.74,
            "high": 3017.16,
            "low": 3006.48,
            "close": 3006.88
          },
          {
            "time": 1744130700000,
            "open": 3006.95,
            "high": 3011.86,
            "low": 3004.01,
            "close": 3010.44
          },
          {
            "time": 1744131600000,
            "open": 3010.36,
            "high": 3018.07,
            "low": 3009.24,
            "close": 3011.57
          },
          {
            "time": 1744132500000,
            "open": 3011.55,
            "high": 3014.86,
            "low": 3008.43,
            "close": 3012.53
          },
          {
            "time": 1744133400000,
            "open": 3012.53,
            "high": 3017.6,
            "low": 3010.28,
            "close": 3014.11
          },
          {
            "time": 1744134300000,
            "open": 3014.11,
            "high": 3018.25,
            "low": 3005.82,
            "close": 3006.21
          },
          {
            "time": 1744135200000,
            "open": 3006.21,
            "high": 3008.07,
            "low": 3002.56,
            "close": 3004.59
          },
          {
            "time": 1744136100000,
            "open": 3004.63,
            "high": 3010.11,
            "low": 3004.47,
            "close": 3007.78
          },
          {
            "time": 1744137000000,
            "open": 3007.86,
            "high": 3012.4,
            "low": 3004.69,
            "close": 3005.12
          },
          {
            "time": 1744137900000,
            "open": 3005.14,
            "high": 3006.45,
            "low": 3001.36,
            "close": 3001.47
          },
          {
            "time": 1744138800000,
            "open": 3001.54,
            "high": 3001.54,
            "low": 2994.64,
            "close": 2999.28
          },
          {
            "time": 1744139700000,
            "open": 2999.38,
            "high": 2999.57,
            "low": 2992.46,
            "close": 2994.73
          },
          {
            "time": 1744140600000,
            "open": 2994.75,
            "high": 2996.04,
            "low": 2985.21,
            "close": 2985.48
          },
          {
            "time": 1744141500000,
            "open": 2985.47,
            "high": 2990.96,
            "low": 2984.37,
            "close": 2986.07
          },
          {
            "time": 1744142400000,
            "open": 2986.05,
            "high": 2986.43,
            "low": 2976.35,
            "close": 2981.14
          },
          {
            "time": 1744143300000,
            "open": 2981.26,
            "high": 2984.27,
            "low": 2975.29,
            "close": 2976.53
          },
          {
            "time": 1744144200000,
            "open": 2976.53,
            "high": 2983.79,
            "low": 2974.76,
            "close": 2983.4
          },
          {
            "time": 1744145100000,
            "open": 2983.4,
            "high": 2987.64,
            "low": 2981.95,
            "close": 2985.23
          },
          {
            "time": 1744146000000,
            "open": 2985.23,
            "high": 2985.64,
            "low": 2979.37,
            "close": 2980.62
          },
          {
            "time": 1744146900000,
            "open": 2980.62,
            "high": 2985.9,
            "low": 2979.99,
            "close": 2985.72
          },
          {
            "time": 1744147800000,
            "open": 2985.73,
            "high": 2992.37,
            "low": 2985.73,
            "close": 2986.74
          },
          {
            "time": 1744148700000,
            "open": 2986.74,
            "high": 2988.2,
            "low": 2981.62,
            "close": 2983.69
          },
          {
            "time": 1744149600000,
            "open": 2983.62,
            "high": 2987.57,
            "low": 2981.6,
            "close": 2982.48
          },
          {
            "time": 1744150500000,
            "open": 2982.43,
            "high": 2982.93,
            "low": 2977.95,
            "close": 2981.29
          },
          {
            "time": 1744151400000,
            "open": 2981.3,
            "high": 2982.92,
            "low": 2976.72,
            "close": 2981.74
          },
          {
            "time": 1744152300000,
            "open": 2981.74,
            "high": 2987.32,
            "low": 2980.83,
            "close": 2984.98
          },
          {
            "time": 1744153200000,
            "open": 2984.87,
            "high": 2986.58,
            "low": 2980.33,
            "close": 2980.33
          },
          {
            "time": 1744154100000,
            "open": 2980.33,
            "high": 2980.72,
            "low": 2977.05,
            "close": 2980.69
          },
          {
            "time": 1744155000000,
            "open": 2980.69,
            "high": 2981.81,
            "low": 2979.22,
            "close": 2980.74
          },
          {
            "time": 1744155900000,
            "open": 2980.74,
            "high": 2983.01,
            "low": 2980.66,
            "close": 2982.4
          },
          {
            "time": 1744160400000,
            "open": 2983.54,
            "high": 2985.66,
            "low": 2981.13,
            "close": 2981.67
          },
          {
            "time": 1744161300000,
            "open": 2981.67,
            "high": 2985.14,
            "low": 2980.99,
            "close": 2984.54
          },
          {
            "time": 1744162200000,
            "open": 2984.54,
            "high": 2985.35,
            "low": 2980.62,
            "close": 2980.8
          },
          {
            "time": 1744163100000,
            "open": 2980.8,
            "high": 2983.05,
            "low": 2980.24,
            "close": 2981.91
          },
          {
            "time": 1744164000000,
            "open": 2981.91,
            "high": 2990.83,
            "low": 2981.91,
            "close": 2985.02
          },
          {
            "time": 1744164900000,
            "open": 2985.02,
            "high": 2985.16,
            "low": 2979.27,
            "close": 2981.11
          },
          {
            "time": 1744165800000,
            "open": 2981.11,
            "high": 2981.3,
            "low": 2970.04,
            "close": 2973.87
          },
          {
            "time": 1744166700000,
            "open": 2973.87,
            "high": 2980.01,
            "low": 2970.46,
            "close": 2978.5
          },
          {
            "time": 1744167600000,
            "open": 2978.69,
            "high": 2984.84,
            "low": 2975.07,
            "close": 2977.98
          },
          {
            "time": 1744168500000,
            "open": 2977.97,
            "high": 2985.62,
            "low": 2975.71,
            "close": 2984.37
          },
          {
            "time": 1744169400000,
            "open": 2984.35,
            "high": 2987.06,
            "low": 2976.88,
            "close": 2984.64
          },
          {
            "time": 1744170300000,
            "open": 2984.64,
            "high": 2986.18,
            "low": 2974.81,
            "close": 2980.42
          },
          {
            "time": 1744171200000,
            "open": 2980.42,
            "high": 2981.32,
            "low": 2972.53,
            "close": 2978.7
          },
          {
            "time": 1744172100000,
            "open": 2978.54,
            "high": 2991.67,
            "low": 2977.3,
            "close": 2990.29
          },
          {
            "time": 1744173000000,
            "open": 2990.15,
            "high": 3002.58,
            "low": 2988.52,
            "close": 3000.23
          },
          {
            "time": 1744173900000,
            "open": 3000.23,
            "high": 3009.89,
            "low": 2999.62,
            "close": 3008.72
          },
          {
            "time": 1744174800000,
            "open": 3008.74,
            "high": 3011.18,
            "low": 3004.33,
            "close": 3007.69
          },
          {
            "time": 1744175700000,
            "open": 3007.56,
            "high": 3009.55,
            "low": 3000.02,
            "close": 3004.65
          },
          {
            "time": 1744176600000,
            "open": 3004.65,
            "high": 3007.87,
            "low": 3002.92,
            "close": 3006.27
          },
          {
            "time": 1744177500000,
            "open": 3006.27,
            "high": 3008.96,
            "low": 3000.09,
            "close": 3003.12
          },
          {
            "time": 1744178400000,
            "open": 3003.04,
            "high": 3008.01,
            "low": 3002.65,
            "close": 3007.64
          },
          {
            "time": 1744179300000,
            "open": 3007.64,
            "high": 3008.8,
            "low": 3004.62,
            "close": 3008.32
          },
          {
            "time": 1744180200000,
            "open": 3008.35,
            "high": 3009.56,
            "low": 3003.13,
            "close": 3006.57
          },
          {
            "time": 1744181100000,
            "open": 3006.55,
            "high": 3009.08,
            "low": 3003.56,
            "close": 3004.53
          },
          {
            "time": 1744182000000,
            "open": 3004.53,
            "high": 3009.35,
            "low": 2999.8,
            "close": 3006.81
          },
          {
            "time": 1744182900000,
            "open": 3006.81,
            "high": 3012.11,
            "low": 3006.29,
            "close": 3008.51
          },
          {
            "time": 1744183800000,
            "open": 3008.51,
            "high": 3011.88,
            "low": 3007.57,
            "close": 3010.44
          },
          {
            "time": 1744184700000,
            "open": 3010.44,
            "high": 3014.11,
            "low": 3008.52,
            "close": 3012.4
          },
          {
            "time": 1744185600000,
            "open": 3012.4,
            "high": 3018.39,
            "low": 3005.47,
            "close": 3015.73
          },
          {
            "time": 1744186500000,
            "open": 3015.78,
            "high": 3020.51,
            "low": 3013.87,
            "close": 3017.43
          },
          {
            "time": 1744187400000,
            "open": 3017.52,
            "high": 3018.53,
            "low": 3012.04,
            "close": 3015.91
          },
          {
            "time": 1744188300000,
            "open": 3015.8,
            "high": 3018.33,
            "low": 3014.33,
            "close": 3015.51
          },
          {
            "time": 1744189200000,
            "open": 3015.51,
            "high": 3025.3,
            "low": 3015.04,
            "close": 3020.42
          },
          {
            "time": 1744190100000,
            "open": 3020.42,
            "high": 3033.21,
            "low": 3019.89,
            "close": 3029.45
          },
          {
            "time": 1744191000000,
            "open": 3029.45,
            "high": 3035.68,
            "low": 3028.08,
            "close": 3030.46
          },
          {
            "time": 1744191900000,
            "open": 3030.45,
            "high": 3040.83,
            "low": 3029.63,
            "close": 3038.99
          },
          {
            "time": 1744192800000,
            "open": 3039.15,
            "high": 3052.38,
            "low": 3034.35,
            "close": 3045.15
          },
          {
            "time": 1744193700000,
            "open": 3045.29,
            "high": 3046.56,
            "low": 3041.13,
            "close": 3043.11
          },
          {
            "time": 1744194600000,
            "open": 3043.11,
            "high": 3048.44,
            "low": 3041.24,
            "close": 3046.1
          },
          {
            "time": 1744195500000,
            "open": 3046.1,
            "high": 3047.49,
            "low": 3039.65,
            "close": 3041.03
          },
          {
            "time": 1744196400000,
            "open": 3040.93,
            "high": 3047.42,
            "low": 3038.39,
            "close": 3043.51
          },
          {
            "time": 1744197300000,
            "open": 3044.07,
            "high": 3051.05,
            "low": 3044.03,
            "close": 3045.42
          },
          {
            "time": 1744198200000,
            "open": 3045.42,
            "high": 3046.56,
            "low": 3040.39,
            "close": 3044.94
          },
          {
            "time": 1744199100000,
            "open": 3044.99,
            "high": 3046.92,
            "low": 3041.87,
            "close": 3044.08
          },
          {
            "time": 1744200000000,
            "open": 3044.07,
            "high": 3046.41,
            "low": 3038.95,
            "close": 3042.3
          },
          {
            "time": 1744200900000,
            "open": 3042.3,
            "high": 3048.08,
            "low": 3041.89,
            "close": 3043.83
          },
          {
            "time": 1744201800000,
            "open": 3043.84,
            "high": 3049.84,
            "low": 3043.54,
            "close": 3047.16
          },
          {
            "time": 1744202700000,
            "open": 3047.16,
            "high": 3047.36,
            "low": 3044.65,
            "close": 3045.02
          },
          {
            "time": 1744203600000,
            "open": 3045.04,
            "high": 3047.2,
            "low": 3040.73,
            "close": 3041.26
          },
          {
            "time": 1744204500000,
            "open": 3040.98,
            "high": 3042.57,
            "low": 3038.37,
            "close": 3039.44
          },
          {
            "time": 1744205400000,
            "open": 3039.44,
            "high": 3044.63,
            "low": 3039.4,
            "close": 3043.23
          },
          {
            "time": 1744206300000,
            "open": 3043.23,
            "high": 3045.71,
            "low": 3041.43,
            "close": 3042.83
          },
          {
            "time": 1744207200000,
            "open": 3042.86,
            "high": 3045.77,
            "low": 3036.06,
            "close": 3045.61
          },
          {
            "time": 1744208100000,
            "open": 3045.61,
            "high": 3064.84,
            "low": 3045.36,
            "close": 3060.37
          },
          {
            "time": 1744209000000,
            "open": 3060.33,
            "high": 3067.15,
            "low": 3057.92,
            "close": 3063.02
          },
          {
            "time": 1744209900000,
            "open": 3063.08,
            "high": 3068.08,
            "low": 3058.43,
            "close": 3066.52
          },
          {
            "time": 1744210800000,
            "open": 3066.66,
            "high": 3073.07,
            "low": 3058.61,
            "close": 3062.9
          },
          {
            "time": 1744211700000,
            "open": 3062.9,
            "high": 3067.55,
            "low": 3048.97,
            "close": 3054.0
          },
          {
            "time": 1744212600000,
            "open": 3054.0,
            "high": 3055.16,
            "low": 3043.92,
            "close": 3043.96
          },
          {
            "time": 1744213500000,
            "open": 3043.96,
            "high": 3051.39,
            "low": 3042.68,
            "close": 3047.45
          },
          {
            "time": 1744214400000,
            "open": 3047.49,
            "high": 3060.61,
            "low": 3047.38,
            "close": 3057.04
          },
          {
            "time": 1744215300000,
            "open": 3057.04,
            "high": 3061.53,
            "low": 3056.16,
            "close": 3060.43
          },
          {
            "time": 1744216200000,
            "open": 3060.57,
            "high": 3078.0,
            "low": 3060.26,
            "close": 3072.85
          },
          {
            "time": 1744217100000,
            "open": 3072.86,
            "high": 3076.85,
            "low": 3067.62,
            "close": 3075.17
          },
          {
            "time": 1744218000000,
            "open": 3074.84,
            "high": 3078.14,
            "low": 3068.5,
            "close": 3074.95
          },
          {
            "time": 1744218900000,
            "open": 3075.15,
            "high": 3084.67,
            "low": 3075.06,
            "close": 3083.46
          },
          {
            "time": 1744219800000,
            "open": 3083.46,
            "high": 3083.99,
            "low": 3075.39,
            "close": 3075.96
          },
          {
            "time": 1744220700000,
            "open": 3075.99,
            "high": 3079.47,
            "low": 3069.23,
            "close": 3070.52
          },
          {
            "time": 1744221600000,
            "open": 3070.56,
            "high": 3075.48,
            "low": 3065.33,
            "close": 3075.09
          },
          {
            "time": 1744222500000,
            "open": 3075.09,
            "high": 3087.82,
            "low": 3075.09,
            "close": 3084.66
          },
          {
            "time": 1744223400000,
            "open": 3084.66,
            "high": 3087.67,
            "low": 3078.92,
            "close": 3079.19
          },
          {
            "time": 1744224300000,
            "open": 3079.19,
            "high": 3086.44,
            "low": 3078.66,
            "close": 3086.37
          },
          {
            "time": 1744225200000,
            "open": 3086.36,
            "high": 3090.36,
            "low": 3082.71,
            "close": 3088.75
          },
          {
            "time": 1744226100000,
            "open": 3088.75,
            "high": 3090.75,
            "low": 3083.85,
            "close": 3085.98
          },
          {
            "time": 1744227000000,
            "open": 3086.06,
            "high": 3090.67,
            "low": 3085.62,
            "close": 3088.28
          },
          {
            "time": 1744227900000,
            "open": 3088.28,
            "high": 3094.87,
            "low": 3088.0,
            "close": 3092.45
          },
          {
            "time": 1744228800000,
            "open": 3092.46,
            "high": 3095.34,
            "low": 3084.38,
            "close": 3089.25
          },
          {
            "time": 1744229700000,
            "open": 3089.25,
            "high": 3099.06,
            "low": 3058.73,
            "close": 3060.15
          },
          {
            "time": 1744230600000,
            "open": 3060.02,
            "high": 3070.45,
            "low": 3051.36,
            "close": 3063.93
          },
          {
            "time": 1744231500000,
            "open": 3063.71,
            "high": 3075.58,
            "low": 3059.25,
            "close": 3059.88
          },
          {
            "time": 1744232400000,
            "open": 3059.87,
            "high": 3068.95,
            "low": 3051.3,
            "close": 3052.25
          },
          {
            "time": 1744233300000,
            "open": 3052.26,
            "high": 3067.14,
            "low": 3048.66,
            "close": 3064.12
          },
          {
            "time": 1744234200000,
            "open": 3064.16,
            "high": 3073.48,
            "low": 3064.1,
            "close": 3064.29
          },
          {
            "time": 1744235100000,
            "open": 3064.29,
            "high": 3069.64,
            "low": 3063.44,
            "close": 3067.27
          },
          {
            "time": 1744236000000,
            "open": 3067.28,
            "high": 3091.04,
            "low": 3064.34,
            "close": 3086.1
          },
          {
            "time": 1744236900000,
            "open": 3086.15,
            "high": 3095.79,
            "low": 3085.49,
            "close": 3091.81
          },
          {
            "time": 1744237800000,
            "open": 3091.61,
            "high": 3098.94,
            "low": 3087.67,
            "close": 3098.39
          },
          {
            "time": 1744238700000,
            "open": 3098.41,
            "high": 3099.52,
            "low": 3084.56,
            "close": 3093.52
          },
          {
            "time": 1744239600000,
            "open": 3093.56,
            "high": 3095.42,
            "low": 3090.11,
            "close": 3091.79
          },
          {
            "time": 1744240500000,
            "open": 3091.81,
            "high": 3091.97,
            "low": 3086.28,
            "close": 3090.56
          },
          {
            "time": 1744241400000,
            "open": 3090.53,
            "high": 3091.44,
            "low": 3080.35,
            "close": 3082.7
          },
          {
            "time": 1744242300000,
            "open": 3082.7,
            "high": 3083.17,
            "low": 3078.1,
            "close": 3082.97
          },
          {
            "time": 1744246800000,
            "open": 3083.59,
            "high": 3083.9,
            "low": 3071.45,
            "close": 3075.76
          },
          {
            "time": 1744247700000,
            "open": 3075.74,
            "high": 3082.89,
            "low": 3073.8,
            "close": 3078.68
          },
          {
            "time": 1744248600000,
            "open": 3078.71,
            "high": 3090.19,
            "low": 3078.47,
            "close": 3083.73
          },
          {
            "time": 1744249500000,
            "open": 3083.73,
            "high": 3086.63,
            "low": 3079.94,
            "close": 3080.09
          },
          {
            "time": 1744250400000,
            "open": 3080.09,
            "high": 3084.3,
            "low": 3079.69,
            "close": 3083.18
          },
          {
            "time": 1744251300000,
            "open": 3083.14,
            "high": 3086.12,
            "low": 3079.66,
            "close": 3085.6
          },
          {
            "time": 1744252200000,
            "open": 3085.6,
            "high": 3088.39,
            "low": 3083.77,
            "close": 3085.39
          },
          {
            "time": 1744253100000,
            "open": 3085.09,
            "high": 3089.08,
            "low": 3082.48,
            "close": 3086.8
          },
          {
            "time": 1744254000000,
            "open": 3086.8,
            "high": 3088.63,
            "low": 3081.35,
            "close": 3086.95
          },
          {
            "time": 1744254900000,
            "open": 3087.02,
            "high": 3096.72,
            "low": 3086.09,
            "close": 3096.16
          },
          {
            "time": 1744255800000,
            "open": 3096.42,
            "high": 3101.33,
            "low": 3094.14,
            "close": 3097.23
          },
          {
            "time": 1744256700000,
            "open": 3097.24,
            "high": 3098.29,
            "low": 3093.05,
            "close": 3097.29
          },
          {
            "time": 1744257600000,
            "open": 3097.3,
            "high": 3100.63,
            "low": 3085.19,
            "close": 3086.4
          },
          {
            "time": 1744258500000,
            "open": 3086.51,
            "high": 3089.93,
            "low": 3082.8,
            "close": 3087.81
          },
          {
            "time": 1744259400000,
            "open": 3087.81,
            "high": 3089.21,
            "low": 3078.58,
            "close": 3088.2
          },
          {
            "time": 1744260300000,
            "open": 3088.27,
            "high": 3095.54,
            "low": 3085.37,
            "close": 3094.15
          },
          {
            "time": 1744261200000,
            "open": 3094.15,
            "high": 3112.72,
            "low": 3093.98,
            "close": 3105.46
          },
          {
            "time": 1744262100000,
            "open": 3105.37,
            "high": 3117.27,
            "low": 3105.37,
            "close": 3111.55
          },
          {
            "time": 1744263000000,
            "open": 3111.6,
            "high": 3119.52,
            "low": 3110.61,
            "close": 3114.28
          },
          {
            "time": 1744263900000,
            "open": 3114.28,
            "high": 3120.41,
            "low": 3111.65,
            "close": 3119.35
          },
          {
            "time": 1744264800000,
            "open": 3119.29,
            "high": 3126.27,
            "low": 3115.53,
            "close": 3125.77
          },
          {
            "time": 1744265700000,
            "open": 3125.77,
            "high": 3132.01,
            "low": 3121.37,
            "close": 3123.96
          },
          {
            "time": 1744266600000,
            "open": 3123.96,
            "high": 3130.44,
            "low": 3120.49,
            "close": 3122.05
          },
          {
            "time": 1744267500000,
            "open": 3122.08,
            "high": 3126.79,
            "low": 3121.53,
            "close": 3125.51
          },
          {
            "time": 1744268400000,
            "open": 3125.51,
            "high": 3128.29,
            "low": 3125.0,
            "close": 3126.04
          },
          {
            "time": 1744269300000,
            "open": 3126.02,
            "high": 3129.39,
            "low": 3124.46,
            "close": 3127.02
          },
          {
            "time": 1744270200000,
            "open": 3127.02,
            "high": 3127.02,
            "low": 3121.0,
            "close": 3122.4
          },
          {
            "time": 1744271100000,
            "open": 3122.4,
            "high": 3127.76,
            "low": 3122.24,
            "close": 3125.4
          },
          {
            "time": 1744272000000,
            "open": 3125.41,
            "high": 3132.68,
            "low": 3124.72,
            "close": 3129.8
          },
          {
            "time": 1744272900000,
            "open": 3129.8,
            "high": 3130.66,
            "low": 3125.06,
            "close": 3125.33
          },
          {
            "time": 1744273800000,
            "open": 3125.33,
            "high": 3125.71,
            "low": 3114.13,
            "close": 3115.62
          },
          {
            "time": 1744274700000,
            "open": 3115.67,
            "high": 3123.73,
            "low": 3112.75,
            "close": 3122.58
          },
          {
            "time": 1744275600000,
            "open": 3122.58,
            "high": 3126.54,
            "low": 3120.37,
            "close": 3125.54
          },
          {
            "time": 1744276500000,
            "open": 3125.47,
            "high": 3125.49,
            "low": 3120.22,
            "close": 3121.63
          },
          {
            "time": 1744277400000,
            "open": 3121.64,
            "high": 3123.49,
            "low": 3118.99,
            "close": 3121.12
          },
          {
            "time": 1744278300000,
            "open": 3121.12,
            "high": 3123.12,
            "low": 3119.45,
            "close": 3122.19
          },
          {
            "time": 1744279200000,
            "open": 3122.07,
            "high": 3122.72,
            "low": 3116.79,
            "close": 3118.68
          },
          {
            "time": 1744280100000,
            "open": 3118.77,
            "high": 3123.58,
            "low": 3116.8,
            "close": 3117.06
          },
          {
            "time": 1744281000000,
            "open": 3117.04,
            "high": 3117.11,
            "low": 3106.66,
            "close": 3112.01
          },
          {
            "time": 1744281900000,
            "open": 3112.04,
            "high": 3115.96,
            "low": 3108.52,
            "close": 3108.8
          },
          {
            "time": 1744282800000,
            "open": 3108.8,
            "high": 3115.76,
            "low": 3108.8,
            "close": 3111.19
          },
          {
            "time": 1744283700000,
            "open": 3111.19,
            "high": 3115.7,
            "low": 3110.41,
            "close": 3114.37
          },
          {
            "time": 1744284600000,
            "open": 3114.35,
            "high": 3114.35,
            "low": 3104.76,
            "close": 3112.12
          },
          {
            "time": 1744285500000,
            "open": 3112.13,
            "high": 3113.57,
            "low": 3104.8,
            "close": 3105.0
          },
          {
            "time": 1744286400000,
            "open": 3105.0,
            "high": 3107.91,
            "low": 3103.54,
            "close": 3107.26
          },
          {
            "time": 1744287300000,
            "open": 3107.27,
            "high": 3111.18,
            "low": 3106.87,
            "close": 3109.91
          },
          {
            "time": 1744288200000,
            "open": 3109.92,
            "high": 3113.35,
            "low": 3105.22,
            "close": 3111.5
          },
          {
            "time": 1744289100000,
            "open": 3111.52,
            "high": 3118.08,
            "low": 3109.41,
            "close": 3116.64
          },
          {
            "time": 1744290000000,
            "open": 3116.72,
            "high": 3118.66,
            "low": 3114.34,
            "close": 3118.6
          },
          {
            "time": 1744290900000,
            "open": 3118.6,
            "high": 3122.58,
            "low": 3116.08,
            "close": 3119.51
          },
          {
            "time": 1744291800000,
            "open": 3119.47,
            "high": 3121.45,
            "low": 3115.62,
            "close": 3116.58
          },
          {
            "time": 1744292700000,
            "open": 3116.58,
            "high": 3120.94,
            "low": 3115.24,
            "close": 3120.26
          },
          {
            "time": 1744293600000,
            "open": 3120.28,
            "high": 3120.9,
            "low": 3113.32,
            "close": 3116.0
          },
          {
            "time": 1744294500000,
            "open": 3116.01,
            "high": 3122.61,
            "low": 3114.63,
            "close": 3122.29
          },
          {
            "time": 1744295400000,
            "open": 3122.31,
            "high": 3124.94,
            "low": 3120.75,
            "close": 3122.25
          },
          {
            "time": 1744296300000,
            "open": 3122.26,
            "high": 3125.74,
            "low": 3118.96,
            "close": 3124.79
          },
          {
            "time": 1744297200000,
            "open": 3124.68,
            "high": 3129.03,
            "low": 3122.52,
            "close": 3125.99
          },
          {
            "time": 1744298100000,
            "open": 3125.98,
            "high": 3128.79,
            "low": 3123.1,
            "close": 3126.54
          },
          {
            "time": 1744299000000,
            "open": 3126.62,
            "high": 3134.06,
            "low": 3116.38,
            "close": 3124.84
          },
          {
            "time": 1744299900000,
            "open": 3124.79,
            "high": 3131.02,
            "low": 3120.92,
            "close": 3123.14
          },
          {
            "time": 1744300800000,
            "open": 3123.14,
            "high": 3127.58,
            "low": 3121.31,
            "close": 3125.74
          },
          {
            "time": 1744301700000,
            "open": 3125.74,
            "high": 3136.75,
            "low": 3125.74,
            "close": 3132.84
          },
          {
            "time": 1744302600000,
            "open": 3132.85,
            "high": 3132.99,
            "low": 3119.48,
            "close": 3122.24
          },
          {
            "time": 1744303500000,
            "open": 3122.0,
            "high": 3127.67,
            "low": 3116.21,
            "close": 3117.04
          },
          {
            "time": 1744304400000,
            "open": 3117.06,
            "high": 3145.03,
            "low": 3116.88,
            "close": 3142.86
          },
          {
            "time": 1744305300000,
            "open": 3142.82,
            "high": 3149.31,
            "low": 3141.26,
            "close": 3144.66
          },
          {
            "time": 1744306200000,
            "open": 3144.55,
            "high": 3152.55,
            "low": 3144.23,
            "close": 3151.35
          },
          {
            "time": 1744307100000,
            "open": 3151.35,
            "high": 3154.82,
            "low": 3144.9,
            "close": 3154.64
          },
          {
            "time": 1744308000000,
            "open": 3154.58,
            "high": 3159.74,
            "low": 3154.53,
            "close": 3159.46
          },
          {
            "time": 1744308900000,
            "open": 3159.39,
            "high": 3170.67,
            "low": 3158.75,
            "close": 3170.67
          },
          {
            "time": 1744310700000,
            "open": 3168.1,
            "high": 3169.17,
            "low": 3154.93,
            "close": 3158.15
          },
          {
            "time": 1744311600000,
            "open": 3158.18,
            "high": 3161.28,
            "low": 3154.18,
            "close": 3159.91
          },
          {
            "time": 1744312500000,
            "open": 3159.9,
            "high": 3165.27,
            "low": 3156.14,
            "close": 3162.58
          },
          {
            "time": 1744313400000,
            "open": 3162.62,
            "high": 3167.23,
            "low": 3160.23,
            "close": 3164.83
          },
          {
            "time": 1744314300000,
            "open": 3164.8,
            "high": 3166.42,
            "low": 3158.46,
            "close": 3158.53
          },
          {
            "time": 1744315200000,
            "open": 3158.45,
            "high": 3158.9,
            "low": 3151.56,
            "close": 3157.75
          },
          {
            "time": 1744316100000,
            "open": 3157.75,
            "high": 3163.6,
            "low": 3156.87,
            "close": 3159.81
          },
          {
            "time": 1744317000000,
            "open": 3160.25,
            "high": 3165.65,
            "low": 3158.25,
            "close": 3163.75
          },
          {
            "time": 1744317900000,
            "open": 3163.76,
            "high": 3164.78,
            "low": 3159.87,
            "close": 3162.83
          },
          {
            "time": 1744318800000,
            "open": 3162.83,
            "high": 3164.02,
            "low": 3158.07,
            "close": 3158.37
          },
          {
            "time": 1744319700000,
            "open": 3158.31,
            "high": 3166.64,
            "low": 3158.31,
            "close": 3164.79
          },
          {
            "time": 1744320600000,
            "open": 3164.89,
            "high": 3174.08,
            "low": 3164.18,
            "close": 3173.91
          },
          {
            "time": 1744321500000,
            "open": 3173.91,
            "high": 3175.61,
            "low": 3171.13,
            "close": 3173.24
          },
          {
            "time": 1744322400000,
            "open": 3173.21,
            "high": 3175.56,
            "low": 3168.0,
            "close": 3170.36
          },
          {
            "time": 1744323300000,
            "open": 3170.36,
            "high": 3173.98,
            "low": 3168.45,
            "close": 3171.47
          },
          {
            "time": 1744324200000,
            "open": 3171.47,
            "high": 3175.96,
            "low": 3170.05,
            "close": 3174.23
          },
          {
            "time": 1744325100000,
            "open": 3174.23,
            "high": 3176.31,
            "low": 3170.35,
            "close": 3170.84
          },
          {
            "time": 1744326000000,
            "open": 3170.84,
            "high": 3176.35,
            "low": 3170.49,
            "close": 3174.37
          },
          {
            "time": 1744326900000,
            "open": 3174.37,
            "high": 3174.43,
            "low": 3170.2,
            "close": 3170.23
          },
          {
            "time": 1744327800000,
            "open": 3170.23,
            "high": 3172.7,
            "low": 3168.53,
            "close": 3172.7
          },
          {
            "time": 1744328700000,
            "open": 3172.7,
            "high": 3176.1,
            "low": 3171.39,
            "close": 3175.83
          }
        ];

        // ----------------------------------------------------------------------------
        // 1. 狀態管理與常數 (State Management & Constants)
        // ----------------------------------------------------------------------------

        const CONFIG = {
            TICK_INTERVAL: 500,
            CHART_PADDING: { top: 20, right: 60, bottom: 30, left: 10 },
            CANDLE_WIDTH_DEFAULT: 8,
            CANDLE_SPACING: 3,
            CONTRACT_SIZE: 100,
            INITIAL_BALANCE: 5000,
            SIMULATION_DURATION_DAYS: 7,
            // V11.0: Zoom Constraints (Feature 3)
            MIN_VISIBLE_CANDLES: 10,
            MAX_VISIBLE_CANDLES: 200,
        };
        
        // 修改：績效回饋文字調整。移除與真實投資人的比較，改為強調學習與技巧提升。
        const PERFORMANCE_BENCHMARKS = {
            GENERAL: [
                { ror: -Infinity, text: "你目前的模擬績效還有很大的進步空間，繼續學習！", beat: 0 },
                { ror: -0.20, text: "模擬剛開始，請謹慎操作，掌握風險管理。", beat: 0 },
                { ror: 0.00, text: "保持穩健！你成功在模擬中保護了初始虛擬資金。", beat: 0 },
                { ror: 0.02, text: "表現穩健，你正在掌握模擬交易的節奏。", beat: 0 },
                { ror: 0.05, text: "技巧提升中！你的模擬績效持續進步。", beat: 0 },
                { ror: 0.10, text: "優秀的模擬表現！你展現了良好的交易策略理解。", beat: 0 },
            ],
            // 修改：進階評估，強調策略與紀律
            FUND: [
                { ror: -Infinity, text: "在高波動模擬環境中，風險控制是首要任務。", beat: 0 },
                { ror: 0.03, text: "穩定的操作策略，在模擬中逐步積累經驗。", beat: 0 },
                { ror: 0.06, text: "展現紀律性，你的模擬策略開始奏效。", beat: 0 },
                { ror: 0.11, text: "表現亮眼！你對市場動態有敏銳的觀察力。", beat: 0 },
                { ror: 0.16, text: "模擬交易大師！你展現了高水準的策略應用能力。", beat: 0 },
                { ror: 0.21, text: "卓越的模擬成果！你的交易技巧已達頂尖水準。", beat: 0 },
            ]
        };

        // 修改：成就係統調整。移除所有金融敏感詞彙、俚語或可能暗示快速致富的描述。
        const ACHIEVEMENTS = {
            FIRST_TRADE: { title: "模擬初體驗", description: "完成了第一筆模擬交易。", icon: "🎓" },
            BIG_WIN: { title: "漂亮的操作", description: "單筆模擬交易獲得顯著分數。(>3000 分)", icon: "🎯" },
            BIG_LOSS: { title: "寶貴的經驗", description: "從大幅虧損中學習風險管理的重要性。(>3000 分)", icon: "💡" },
            WIN_STREAK_3: { title: "連戰連捷", description: "連續三次模擬交易獲得分數。", icon: "⭐" },
            LOSS_STREAK_3: { title: "需要冷靜", description: "連續三次模擬交易出現虧損，建議重新審視策略。", icon: "🤔" },
            HOLD_LOSS_7D: { title: "長期觀察", description: "持有處於虧損狀態的部位超過7天。", icon: "⏳" },
            HOLD_WIN_7D: { title: "趨勢跟隨者", description: "成功持有一個處於獲利狀態的部位超過7天。", icon: "📈" },
            TRADER_10: { title: "積極練習", description: "累積完成了10筆模擬交易。", icon: "🔄" },
            QUICK_DRAW: { title: "短線高手", description: "在1小時內完成一筆有分數的模擬交易。", icon: "⚡" },
            DOUBLE_UP: { title: "績效卓越", description: "學習分數達到初始分數的兩倍。(>20000 分)", icon: "🏆" },
            MARGIN_CALL: { title: "風險警示", description: "學習分數曾低於 2000 分，請注意風險控管。", icon: "⚠️" },
            CONSISTENT: { title: "穩健操作", description: "模擬結束時勝率>60%且至少10筆交易。", icon: "📊" },
            DIAMOND_HANDS_LOSS: { title: "深度回撤觀察", description: "持有單一虧損部位超過30%仍未平倉。", icon: "👀" },
            AVERAGE_DOWN: { title: "分批進場", description: "對同一方向建立模擬部位3次以上。", icon: "🧱" },
            BAD_DAY: { title: "逆風考驗", description: "單日內執行了三次虧損的模擬交易。", icon: "🌧️" },
            RUG_PULL: { title: "劇烈波動", description: "學習分數在同日內由獲利轉為虧損超過 2000 分。", icon: "🎢" },
        };

        const state = {
            rawData: [],
            gameData: [],
            isLoading: true,
            isPlaying: false,
            isEnded: false,
            speedMultiplier: 1,
            currentIndex: 0,
            barAnimationProgress: 0,
            balance: CONFIG.INITIAL_BALANCE,
            equity: CONFIG.INITIAL_BALANCE,
            floatingPL: 0,
            openPositions: [],
            tradeHistory: [],
            orderIdCounter: 1,
            chart: {
                canvas: null,
                ctx: null,
                width: 0,
                height: 0,
                viewStartIndex: 0, 
                viewEndIndex: 0,
                minPrice: 0,
                maxPrice: 0,
                candleWidth: CONFIG.CANDLE_WIDTH_DEFAULT,
                candleSpacing: CONFIG.CANDLE_SPACING,
                isDragging: false,
                dragStartX: 0,
                dragStartY: 0, 
                dragStartScroll: 0,
                scrollOffset: 0, 
                isCrosshairPinned: false,
                pinnedCrosshairPos: { x: 0, y: 0 },
                // V11.0: New state properties for interactions (Feature 1 & 3)
                draggedLineType: null, // 'SL' or 'TP' (Feature 1)
                pinchStartDistance: 0,
                pinchStartCandleWidth: 0,
                isPinching: false,
                dragVelocity: 0,
                inertiaAnimationFrameId: null,
                dragLastX: 0,
                dragLastTime: 0,
            },
            mouse: { x: -1, y: -1, isOverChart: false },
            isMobile: false,
            tutorialActive: false,
            tutorialCompletedOnce: false,
            gameStartTime: null,
            remainingTime: 60,
            timerIntervalId: null,
            current7DayRange: { high: null, low: null },
            lastAlertedHigh: null,
            lastAlertedLow: null,
            unlockedAchievements: new Set(),
            achievementStats: {
                consecutiveWins: 0,
                consecutiveLosses: 0,
                maxEquity: CONFIG.INITIAL_BALANCE,
                minEquity: CONFIG.INITIAL_BALANCE,
                currentDay: null,
                dailyLossCount: 0,
                dailyMaxPL: 0,
            },
            // 財經事件描述保持中性，符合規範
            financialEvents: [
                { triggerDay: 2, title: '關稅事件', description: '2025/04/02 美麗國宣布對所有進口商品施加最低 10% 關稅，對中心國進一步提高至25%。' },
                { triggerDay: 4, title: '關稅反制', description: '2025/04/04 中心國宣布對美國商品加徵 34% 關稅。' },
                { triggerDay: 5, title: '美國非農就業數據 (NFP)', description: '非農數據即將公布，市場預期將出現劇烈波動。請注意風險！' },
                { triggerDay: 15, title: '美國 CPI 公布', description: '消費者物價指數 (CPI) 高於預期，可能引發市場對通膨的擔憂。' },
                { triggerDay: 25, title: 'FOMC 利率決議', description: '聯準會即將宣布利率決議。市場普遍預期將維持現有利率。' },
            ],
            triggeredEvents: new Set(),
            wasPlayingBeforeEvent: false,
            fireworkParticles: [],
        };

        const DOM = {};

        // ----------------------------------------------------------------------------
        // 2. 數據處理 (Data Processing)
        // ----------------------------------------------------------------------------

        async function loadData() {
            // Data is now embedded, so we can process it directly.
            processData(tradingData);
        }

        function promptForFileUpload(errorMessage) {
            // This function is now a fallback and may not be used, but kept for robustness.
            document.getElementById('loader-status').classList.add('hidden');
            document.getElementById('fileUploadFallback').classList.remove('hidden');
            if (errorMessage) {
                document.getElementById('loader-error-message').textContent = errorMessage;
            }
             document.getElementById('csvFileInput').style.display = 'none';
             document.getElementById('loader-error-message').textContent = "無法載入內嵌數據。請刷新頁面或嘗試使用其他瀏覽器。";
        }

        function processData(data) {
            try {
                // Data is already in the correct format.
                state.rawData = data;
                if (state.rawData.length === 0) {
                    throw new Error("內嵌交易數據為空或格式不正確。");
                }
                // Sort by time just in case
                state.rawData.sort((a, b) => a.time - b.time);
                startGame();
            } catch (error) {
                console.error("處理數據失敗:", error);
                promptForFileUpload(error.message);
            }
        }

        // parseData is no longer needed as the data is pre-formatted.
        function parseData() {
            return [];
        }

        // ----------------------------------------------------------------------------
        // 3. 遊戲初始化與流程控制 (Game Initialization & Flow Control)
        // ----------------------------------------------------------------------------

        function init() {
            // V9.0: Determine mobile based on screen width (900px breakpoint)
            state.isMobile = window.innerWidth <= 900 || 'ontouchstart' in window || navigator.maxTouchPoints > 0;
            cacheDOMElements();
            setupEventListeners();
            initChart();
            loadData();
        }

        function cacheDOMElements() {
            // V9.0: Updated DOM caching for new layout
            Object.assign(DOM, {
                hudDate: document.getElementById('hud-date'),
                hudEquity: document.getElementById('hud-equity'),
                hudPL: document.getElementById('hud-pl'),
                hudProgress: document.getElementById('hud-progress'),
                hudTimer: document.getElementById('hud-timer'),
                btnPlayPause: document.getElementById('btnPlayPause'),
                btnStepForward: document.getElementById('btnStepForward'),
                speedSelector: document.getElementById('speedSelector'),
                chartWrap: document.getElementById('chartWrap'),
                chartCanvas: document.getElementById('chartCanvas'),
                chartOverlay: document.getElementById('chartOverlay'),
                chartControls: document.getElementById('chartControls'),
                // V9.0: New elements
                bottomNavBar: document.getElementById('bottomNavBar'),
                positionsCountNav: document.getElementById('positionsCountNav'),
                btnToggleControls: document.getElementById('btnToggleControls'),
            });
            Object.assign(DOM, {
                inputLots: document.getElementById('inputLots'),
                inputSL: document.getElementById('inputSL'),
                inputTP: document.getElementById('inputTP'),
                estimateSL: document.getElementById('estimateSL'),
                estimateTP: document.getElementById('estimateTP'),
                positionsList: document.getElementById('positionsList'),
                historyList: document.getElementById('historyList'),
                // V9.0: Keep positionsCount (used inside the Positions/History tab)
                positionsCount: document.getElementById('positionsCount'),
                btnCloseAllGlobal: document.getElementById('btnCloseAllGlobal'),
                emptyPositions: document.getElementById('emptyPositions'),
                emptyHistory: document.getElementById('emptyHistory'),
            });
            Object.assign(DOM, {
                loader: document.getElementById('loader'),
                eventModal: document.getElementById('eventModal'),
                endGameModal: document.getElementById('endGameModal'),
                tutorialHighlight: document.getElementById('tutorialHighlight'),
                tutorialMessage: document.getElementById('tutorialMessage'),
                tutorialText: document.getElementById('tutorialText'),
                tutorialNextBtn: document.getElementById('tutorialNextBtn'),
                notificationContainer: document.getElementById('notification-container'),
            });
        }

        function startGame() {
            if (state.rawData.length === 0) return;
            DOM.endGameModal.classList.remove('active');
            resetState();
            selectRandomDataSegment();
            if (state.gameData.length === 0) return;
            
            const initialVisibleCandles = calculateVisibleCandles();
            // Start with some history visible
            state.currentIndex = 0;
            
            updateDailyStats();
            state.current7DayRange = calculate7DayRange();
            state.isLoading = false;
            DOM.loader.classList.add('hidden');
            
            startTimer();
            updateUI();
            requestAnimationFrame(draw);

        // Start the game simulation. It will run during the tutorial if applicable.
        if (!state.isPlaying && !state.isEnded) {
            togglePlayPause();
        }
        }

        function resetState() {
            if (state.timerIntervalId) {
                clearInterval(state.timerIntervalId);
                state.timerIntervalId = null;
            }
            DOM.hudTimer.classList.remove('timer-warning');
            state.balance = CONFIG.INITIAL_BALANCE;
            state.equity = CONFIG.INITIAL_BALANCE;
            state.floatingPL = 0;
            state.openPositions = [];
            state.tradeHistory = [];
            state.orderIdCounter = 1;
            state.isPlaying = false;
            state.isEnded = false;
            state.currentIndex = 0;
            state.barAnimationProgress = 0;
            state.triggeredEvents.clear();
            state.chart.candleWidth = CONFIG.CANDLE_WIDTH_DEFAULT;
            state.chart.candleSpacing = CONFIG.CANDLE_SPACING;
            state.chart.scrollOffset = 0;
            state.chart.isCrosshairPinned = false;
            // V11.0: Reset interaction states
            state.chart.isDragging = false;
            state.chart.isPinching = false;
            state.chart.draggedLineType = null;

            DOM.chartOverlay.innerHTML = '';

            // Clear lists correctly while retaining empty state elements
            DOM.positionsList.querySelectorAll('.trade-item').forEach(item => item.remove());
            DOM.historyList.querySelectorAll('.trade-item').forEach(item => item.remove());
            
            DOM.inputLots.value = "1.00";
            DOM.inputSL.value = "";
            DOM.inputTP.value = "";

            state.gameStartTime = null;
            state.remainingTime = 60;
            DOM.hudTimer.textContent = "01:00";

            state.current7DayRange = { high: null, low: null };
            state.lastAlertedHigh = null;
            state.lastAlertedLow = null;

            // V9.0 (R3): Ensure controls are collapsed on restart
            if (!DOM.chartControls.classList.contains('controls-collapsed')) {
                DOM.chartControls.classList.add('controls-collapsed');
                DOM.btnToggleControls.textContent = '展開設定';
            }

            state.unlockedAchievements.clear();
            state.achievementStats = {
                consecutiveWins: 0,
                consecutiveLosses: 0,
                maxEquity: CONFIG.INITIAL_BALANCE,
                minEquity: CONFIG.INITIAL_BALANCE,
                currentDay: null,
                dailyLossCount: 0,
                dailyMaxPL: 0,
            };
        }

        function selectRandomDataSegment() {
            if (state.rawData.length === 0) return;

            // 1. Define the fixed start and end dates (UTC)
            // Note: Months are 0-indexed in JavaScript's Date, so April is 3.
            const startDate = new Date(Date.UTC(2025, 3, 1, 0, 0, 0));
            const endDate = new Date(Date.UTC(2025, 3, 7, 23, 59, 59));

            const startTime = startDate.getTime();
            const endTime = endDate.getTime();

            // 2. Filter the rawData to get the data within this fixed range
            state.gameData = state.rawData.filter(d => d.time >= startTime && d.time <= endTime);

            if (state.gameData.length === 0) {
                console.error(`No data found for the specified date range: 2025-04-01 to 2025-04-10. Please check the embedded data.`);
                // As a fallback, use the first 10 days of data if available
                const tenDaysMs = 10 * 24 * 60 * 60 * 1000;
                const fallbackEndTime = state.rawData[0].time + tenDaysMs;
                state.gameData = state.rawData.filter(d => d.time < fallbackEndTime);
            }
        }

        let lastTickTime = 0;
        let animationFrameId;

        function gameLoop(timestamp) {
            if (!state.isPlaying || state.isEnded) {
                cancelAnimationFrame(animationFrameId);
                return;
            }
            const effectiveInterval = CONFIG.TICK_INTERVAL / state.speedMultiplier;
            if (lastTickTime === 0) lastTickTime = timestamp;
            const deltaTime = timestamp - lastTickTime;

             // Ensure deltaTime is positive before proceeding
             if (deltaTime > 0) { 
                 const progressIncrement = deltaTime / effectiveInterval;
                 state.barAnimationProgress = Math.min(1, state.barAnimationProgress + progressIncrement);
                 
                 // Update systems based on the current (animating) bar
                 updateDailyStats(); 
                 updatePositions();
                 check7DayBreakout(); 
                 updateAccount();
                 updateUI(); 
                 checkDurationAchievements();
                 checkDrawdownAchievement(); 

                 if (state.barAnimationProgress >= 1) {
                    finalizeCurrentBar();
                    if (!advanceSimulation()) {
                        endGame();
                        return;
                    }
                    state.barAnimationProgress = 0;
                    checkForEvents();
                    // Auto-scroll if the chart was already at the latest data
                    if (state.chart.scrollOffset > 0) {
                        state.chart.scrollOffset++;
                    }
                 }
                 lastTickTime = timestamp;
            }
            draw();
            animationFrameId = requestAnimationFrame(gameLoop);
        }

        function finalizeCurrentBar() {
            // Ensure the bar is fully drawn before moving to the next index
            state.barAnimationProgress = 1;
            updatePositions();
            updateAccount();
        }

        function advanceSimulation() {
            if (state.currentIndex < state.gameData.length - 1) {
                state.currentIndex++;
                updateDailyStats(); // Update stats for the new day
                state.current7DayRange = calculate7DayRange();
                return true;
            }
            return false;
        }

        function endGame() {
            if (state.isEnded) return;
            state.isPlaying = false;
            state.isEnded = true;
            cancelAnimationFrame(animationFrameId);
            stopTimer();
            
            // Close all remaining positions at the final price
            if (state.gameData.length > 0) {
                let closeIndex = state.currentIndex;
                if (closeIndex >= state.gameData.length) {
                    closeIndex = state.gameData.length - 1;
                }
                const closePrice = state.gameData[closeIndex].close;
                while(state.openPositions.length > 0) {
                    // Skip final achievement check during forced closure at game end
                    closeOrder(state.openPositions[0].id, closePrice, false); 
                }
            }
            checkFinalAchievements();
            updateAccount();
            updateUI();
            showEndGameModal();
        }

        function startTimer() {
            if (state.timerIntervalId) clearInterval(state.timerIntervalId);
            state.timerIntervalId = setInterval(updateTimer, 1000);
        }

        function updateTimer() {
            if (state.isEnded) return;

            state.remainingTime--;

            const minutes = Math.floor(state.remainingTime / 60);
            const seconds = state.remainingTime % 60;
            DOM.hudTimer.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;

            if (state.remainingTime <= 10) {
                DOM.hudTimer.classList.add('timer-warning');
            } else {
                DOM.hudTimer.classList.remove('timer-warning');
            }

            if (state.remainingTime <= 0) {
                endGame();
            }
        }

        function stopTimer() {
            if (state.timerIntervalId) {
                clearInterval(state.timerIntervalId);
                state.timerIntervalId = null;
            }
        }

        // ----------------------------------------------------------------------------
        // 4. 圖表繪製與渲染 (Chart Drawing & Rendering)
        // ----------------------------------------------------------------------------
        
        function initChart() {
            state.chart.canvas = DOM.chartCanvas;
            state.chart.ctx = state.chart.canvas.getContext('2d');
            resizeCanvas();
        }

        function resizeCanvas() {
            // V9.0: Update mobile detection on resize (using 900px breakpoint)
            const newIsMobile = window.innerWidth <= 900 || 'ontouchstart' in window || navigator.maxTouchPoints > 0;

            if (newIsMobile !== state.isMobile) {
                state.isMobile = newIsMobile;
                // If the mobile state changed, we might need to refresh tutorial positioning if active
                if (state.tutorialActive) {
                    setTimeout(showTutorialStep, 50);
                }
            }

            const dpr = window.devicePixelRatio || 1;
            const rect = DOM.chartWrap.getBoundingClientRect();
            // Ensure dimensions are at least 1px
            const width = Math.max(1, Math.floor(rect.width));
            const height = Math.max(1, Math.floor(rect.height));

            if (state.chart.width !== width || state.chart.height !== height) {
                state.chart.canvas.width = width * dpr;
                state.chart.canvas.height = height * dpr;
                state.chart.canvas.style.width = `${width}px`;
                state.chart.canvas.style.height = `${height}px`;
                state.chart.ctx.scale(dpr, dpr);
                state.chart.width = width;
                state.chart.height = height;
                validateScrollOffset();
            }
            if (!state.isLoading) {
                draw();
            }
        }

        function draw() {
            if (state.isLoading || state.gameData.length === 0) return;
            const ctx = state.chart.ctx;
            ctx.clearRect(0, 0, state.chart.width, state.chart.height);
            calculateViewport();
            drawBackground(ctx);
            drawGrid(ctx);
            drawCandles(ctx);
            // V11.0: Draw SL/TP setup lines (Feature 1)
            drawOrderSetupLines(ctx);
            drawYAxis(ctx);
            drawXAxis(ctx);
            drawCrosshair(ctx);
            drawTradeAnimations(ctx);
            drawChartAlertAnimations(ctx);
            drawFireworks(ctx);
            updatePositionOverlays();
        }

        // V11.0: New function to draw interactive SL/TP lines (Feature 1)
        function drawOrderSetupLines(ctx) {
            // Ensure inputs are available (e.g. during initialization)
            if (!DOM.inputSL || !DOM.inputTP || !DOM.inputLots) return;

            const slPrice = parseFloat(DOM.inputSL.value);
            const tpPrice = parseFloat(DOM.inputTP.value);
            const lots = parseFloat(DOM.inputLots.value);

            if (!isNaN(slPrice) && slPrice > 0) {
                drawSetupLine(ctx, slPrice, 'SL', lots);
            }
            if (!isNaN(tpPrice) && tpPrice > 0) {
                drawSetupLine(ctx, tpPrice, 'TP', lots);
            }
        }

        // V11.0: Helper function for drawing individual setup lines (Feature 1)
        function drawSetupLine(ctx, price, type, lots) {
            const y = priceToY(price);
            const { left, right, top, bottom } = CONFIG.CHART_PADDING;
            const { width, height } = state.chart;

            // Don't draw if outside the visible area
            if (y < top || y > height - bottom) return;

            const color = type === 'SL' ? getComputedStyle(document.documentElement).getPropertyValue('--color-danger').trim() : getComputedStyle(document.documentElement).getPropertyValue('--color-success').trim();
            
            // Draw the line
            ctx.strokeStyle = color;
            // V11.0: Enhance visibility if dragging
            ctx.lineWidth = state.chart.draggedLineType === type ? 2.5 : 1.5;
            // Make it slightly dashed for distinction from existing position lines
            ctx.setLineDash([10, 5]); 
            ctx.beginPath();
            ctx.moveTo(left, y);
            ctx.lineTo(width - right, y);
            ctx.stroke();
            ctx.setLineDash([]);

            // Calculate and draw estimated P/L label
            const currentPrice = getCurrentPrice();
            let estimatedPL = 0;
            if (!isNaN(lots) && lots > 0 && currentPrice > 0) {
                // P/L is calculated as the absolute difference between current price and target price
                estimatedPL = Math.abs(currentPrice - price) * CONFIG.CONTRACT_SIZE * lots;
            }

            const labelText = `${type}: ${type === 'SL' ? '-' : '+'}${Math.round(estimatedPL)} 分`;
            const padding = 5;
            
            ctx.font = 'bold 12px sans-serif';
            ctx.textAlign = 'left';
            ctx.textBaseline = 'bottom';

            const textMetrics = ctx.measureText(labelText);
            const labelWidth = textMetrics.width + padding * 2;
            const labelHeight = 20;

            // Position label just above the line, starting from the left padding edge
            ctx.fillStyle = color;
            // Add a slight background opacity for better readability
            ctx.globalAlpha = 0.85; 
            ctx.fillRect(left, y - labelHeight, labelWidth, labelHeight);
            ctx.globalAlpha = 1.0;

            ctx.fillStyle = 'white';
            // Adjust vertical alignment within the box
            ctx.fillText(labelText, left + padding, y - (labelHeight - 16) / 2 );
        }


        function calculateVisibleCandles() {
            const { width, candleWidth, candleSpacing } = state.chart;
            const { left, right } = CONFIG.CHART_PADDING;
            const chartAreaWidth = width - left - right;
            const candleUnitWidth = candleWidth + candleSpacing;
            if (candleUnitWidth <= 0) return 100; // Fallback
            return Math.max(1, Math.floor(chartAreaWidth / candleUnitWidth));
        }

        function calculateViewport() {
            const visibleCandles = calculateVisibleCandles();
            
            // Calculate start and end indices based on scroll offset
            let endIndex = state.currentIndex + 1 - state.chart.scrollOffset;
            let startIndex = endIndex - visibleCandles;

            // Constrain the viewport to the available data
            if (endIndex > state.currentIndex + 1) {
                endIndex = state.currentIndex + 1;
                startIndex = Math.max(0, endIndex - visibleCandles);
            }
            if (startIndex < 0) {
                startIndex = 0;
                endIndex = Math.min(state.currentIndex + 1, startIndex + visibleCandles);
            }
            state.chart.viewStartIndex = startIndex;
            state.chart.viewEndIndex = endIndex;

            // Calculate price range (Y-axis)
            let minPrice = Infinity;
            let maxPrice = -Infinity;
            for (let i = startIndex; i < endIndex; i++) {
                if (i >= state.gameData.length || i < 0) continue; 
                const bar = state.gameData[i];
                
                // Include the animation progress for the current bar if visible and not scrolled
                if (i === state.currentIndex && state.chart.scrollOffset === 0) {
                    const animatedBar = getAnimatedBar(bar);
                    minPrice = Math.min(minPrice, animatedBar.low);
                    maxPrice = Math.max(maxPrice, animatedBar.high);
                } else {
                    minPrice = Math.min(minPrice, bar.low);
                    maxPrice = Math.max(maxPrice, bar.high);
                }
            }
            
            // Handle edge cases where price range is zero or invalid
            const priceRange = maxPrice - minPrice;
            if (priceRange <= 0 || !isFinite(priceRange)) {
                const centerPrice = (minPrice === Infinity) ? (state.gameData[0]?.close || 1900) : minPrice;
                const padding = centerPrice * 0.001; // Small padding based on price magnitude
                state.chart.minPrice = centerPrice - padding;
                state.chart.maxPrice = centerPrice + padding;
            } else {
                const padding = priceRange * 0.1; // 10% padding top and bottom
                state.chart.minPrice = minPrice - padding;
                state.chart.maxPrice = maxPrice + padding;
            }
        }

        function priceToY(price) {
            const { height, minPrice, maxPrice } = state.chart;
            const { top, bottom } = CONFIG.CHART_PADDING;
            const chartAreaHeight = height - top - bottom;
            const priceRange = maxPrice - minPrice;
            if (chartAreaHeight <= 0 || priceRange <= 0) return top + chartAreaHeight / 2;
            const y = top + chartAreaHeight * (1 - (price - minPrice) / priceRange);
            return Math.max(top, Math.min(height - bottom, y));
        }

        function yToPrice(y) {
            const { height, minPrice, maxPrice } = state.chart;
            const { top, bottom } = CONFIG.CHART_PADDING;
            const chartAreaHeight = height - top - bottom;
            const priceRange = maxPrice - minPrice;
            if (chartAreaHeight <= 0) return (minPrice + maxPrice) / 2;
            // V11.0: Constrain Y to the chart area boundaries before calculation (Feature 1)
            const constrainedY = Math.max(top, Math.min(height - bottom, y));
            const price = minPrice + priceRange * (1 - (constrainedY - top) / chartAreaHeight);
            return price;
        }

        function indexToX(index) {
            const { viewStartIndex, candleWidth, candleSpacing } = state.chart;
            const { left } = CONFIG.CHART_PADDING;
            const candleUnitWidth = candleWidth + candleSpacing;
            return left + (index - viewStartIndex) * candleUnitWidth + candleWidth / 2;
        }

        function drawBackground(ctx) {
            ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--chart-bg').trim();
            ctx.fillRect(0, 0, state.chart.width, state.chart.height);
        }

        function drawGrid(ctx) {
            const gridColor = getComputedStyle(document.documentElement).getPropertyValue('--chart-grid').trim();
            const dateSeparatorColor = getComputedStyle(document.documentElement).getPropertyValue('--chart-date-separator').trim();
            const { left, right, top, bottom } = CONFIG.CHART_PADDING;

            // Horizontal grid lines (Y-axis ticks)
            ctx.strokeStyle = gridColor;
            ctx.lineWidth = 1;
            const yTicks = calculateYAxisTicks();
            yTicks.forEach(tick => {
                const y = priceToY(tick.price);
                ctx.beginPath();
                ctx.moveTo(left, y);
                ctx.lineTo(state.chart.width - right, y);
                ctx.stroke();
            });

            // Vertical grid lines (X-axis ticks)
            const xTicks = calculateXAxisTicks();
            xTicks.forEach(tick => {
                const x = indexToX(tick.index);
                if (x >= left && x <= state.chart.width - right) {
                    if (tick.isDateSeparator) {
                        ctx.strokeStyle = dateSeparatorColor;
                        ctx.lineWidth = 1.5;
                    } else {
                        ctx.strokeStyle = gridColor;
                        ctx.lineWidth = 1;
                    }
                    ctx.beginPath();
                    ctx.moveTo(x, top);
                    ctx.lineTo(x, state.chart.height - bottom);
                    ctx.stroke();
                }
            });
            ctx.lineWidth = 1;
        }

        function getAnimatedBar(bar) {
            const progress = state.barAnimationProgress;
            const open = bar.open;
            
            // Simulate wick formation (faster) then body fill
            const wickProgress = Math.min(1, progress * 2); 
            const high = open + (bar.high - open) * wickProgress;
            const low = open + (bar.low - open) * wickProgress;
            
            const close = open + (bar.close - open) * progress;
            
            // Ensure high/low encompass the current close price
            const finalHigh = Math.max(high, close, open);
            const finalLow = Math.min(low, close, open);
            
            return { open, high: finalHigh, low: finalLow, close };
        }

        function drawCandles(ctx) {
            const { viewStartIndex, viewEndIndex, candleWidth } = state.chart;
            const colorBull = getComputedStyle(document.documentElement).getPropertyValue('--color-bull').trim();
            const colorBear = getComputedStyle(document.documentElement).getPropertyValue('--color-bear').trim();

            for (let i = viewStartIndex; i < viewEndIndex; i++) {
                 if (i >= state.gameData.length || i < 0) continue;
                const bar = state.gameData[i];
                let displayBar = bar;
                
                // Apply animation to the current bar if at the edge
                if (i === state.currentIndex && state.chart.scrollOffset === 0) {
                    displayBar = getAnimatedBar(bar);
                }
                
                const x = indexToX(i);
                const openY = priceToY(displayBar.open);
                const highY = priceToY(displayBar.high);
                const lowY = priceToY(displayBar.low);
                const closeY = priceToY(displayBar.close);
                
                const color = displayBar.close >= displayBar.open ? colorBull : colorBear;
                ctx.strokeStyle = color;
                ctx.fillStyle = color;
                ctx.lineWidth = 1;
                
                // Draw wick
                ctx.beginPath();
                ctx.moveTo(x, highY);
                ctx.lineTo(x, lowY);
                ctx.stroke();
                
                // Draw body
                const bodyTop = Math.min(openY, closeY);
                const bodyHeight = Math.abs(openY - closeY);
                const finalHeight = Math.max(1, bodyHeight); // Ensure at least 1px height
                const finalWidth = Math.max(1, candleWidth);
                ctx.fillRect(x - finalWidth / 2, bodyTop, finalWidth, finalHeight);
            }
        }

        function calculateYAxisTicks() {
            const { minPrice, maxPrice, height } = state.chart;
            const priceRange = maxPrice - minPrice;
            if (priceRange <= 0) return [];
            
            // Determine appropriate tick spacing
            const targetCount = Math.max(2, Math.floor(height / 50)); // Aim for ticks every 50px
            const rawSpacing = priceRange / targetCount;
            
            // Calculate a "nice" spacing (e.g., 0.1, 0.2, 0.5, 1, 2, 5, 10...)
            const magnitude = Math.pow(10, Math.floor(Math.log10(rawSpacing)));
            const normalizedSpacing = rawSpacing / magnitude;
            
            let tickSpacing;
            if (normalizedSpacing > 5) tickSpacing = 10 * magnitude;
            else if (normalizedSpacing > 2) tickSpacing = 5 * magnitude;
            else if (normalizedSpacing > 1) tickSpacing = 2 * magnitude;
            else tickSpacing = magnitude;
            
            const ticks = [];
            let currentTick = Math.ceil(minPrice / tickSpacing) * tickSpacing;
            while (currentTick <= maxPrice) {
                if (isFinite(currentTick)) ticks.push({ price: currentTick });
                currentTick += tickSpacing;
                if (tickSpacing === 0) break; // Prevent infinite loop if spacing is 0
            }
            return ticks;
        }

        function drawYAxis(ctx) {
            const { width, height } = state.chart;
            const { right } = CONFIG.CHART_PADDING;
            const axisX = width - right;
            
            // Background for the axis area
            ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--chart-bg').trim();
            ctx.fillRect(axisX, 0, right, height);
            
            // Axis line
            ctx.strokeStyle = getComputedStyle(document.documentElement).getPropertyValue('--color-border').trim();
            ctx.beginPath();
            ctx.moveTo(axisX, 0);
            ctx.lineTo(axisX, height);
            ctx.stroke();
            
            // Ticks labels
            ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--color-text-secondary').trim();
            ctx.font = '12px sans-serif';
            ctx.textAlign = 'left';
            ctx.textBaseline = 'middle';
            const ticks = calculateYAxisTicks();
            ticks.forEach(tick => {
                const y = priceToY(tick.price);
                ctx.fillText(tick.price.toFixed(2), axisX + 5, y);
            });
            
            // Current price indicator (only when not using crosshair and at the latest data)
            // V11.0: Added check for !state.chart.draggedLineType
            const isCrosshairActive = (state.mouse.isOverChart || state.chart.isCrosshairPinned) && !state.chart.isDragging && !state.chart.draggedLineType;
            if (state.currentIndex < state.gameData.length && state.chart.scrollOffset === 0 && !isCrosshairActive) {
                const currentPrice = getCurrentPrice();
                const currentY = priceToY(currentPrice);
                const color = currentPrice >= state.gameData[state.currentIndex].open 
                    ? getComputedStyle(document.documentElement).getPropertyValue('--color-bull').trim()
                    : getComputedStyle(document.documentElement).getPropertyValue('--color-bear').trim();
                
                ctx.fillStyle = color;
                ctx.fillRect(axisX + 1, currentY - 10, right - 1, 20);
                ctx.fillStyle = 'white';
                ctx.fillText(currentPrice.toFixed(2), axisX + 5, currentY);
            }
        }

        function calculateXAxisTicks() {
            const { viewStartIndex, viewEndIndex, width } = state.chart;
            if (viewEndIndex <= viewStartIndex || viewStartIndex >= state.gameData.length) return [];
            
            const targetCount = Math.max(2, Math.floor(width / 100)); // Aim for ticks every 100px
            const visibleCandles = viewEndIndex - viewStartIndex;
            const interval = Math.max(1, Math.round(visibleCandles / targetCount));
            
            const ticks = [];
            let lastDateStr = null;
            
            for (let i = viewStartIndex; i < viewEndIndex; i++) {
                if (i < 0 || i >= state.gameData.length) continue;
                const time = state.gameData[i].time;
                const currentDate = new Date(time);
                const currentDateStr = currentDate.toDateString(); 
                
                let isDateSeparator = false;
                if (lastDateStr !== null && currentDateStr !== lastDateStr) {
                    isDateSeparator = true;
                }
                lastDateStr = currentDateStr;
                
                if (isDateSeparator || (i - viewStartIndex) % interval === 0) {
                     // Prevent duplicate ticks
                     if (!ticks.some(t => t.index === i)) {
                        ticks.push({ index: i, time: time, isDateSeparator: isDateSeparator });
                     }
                }
            }
            return ticks;
        }

        function drawXAxis(ctx) {
            const { width, height } = state.chart;
            const { bottom, right, left } = CONFIG.CHART_PADDING;
            const axisY = height - bottom;
            
            // Background for the axis area
            ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--chart-bg').trim();
            ctx.fillRect(0, axisY, width, bottom);
            
            // Axis line
            ctx.strokeStyle = getComputedStyle(document.documentElement).getPropertyValue('--color-border').trim();
            ctx.beginPath();
            ctx.moveTo(0, axisY);
            ctx.lineTo(width - right, axisY);
            ctx.stroke();
            
            // Ticks labels
            ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--color-text-secondary').trim();
            ctx.textAlign = 'center';
            ctx.textBaseline = 'top';
            
            const ticks = calculateXAxisTicks();
            
            // Determine time difference to decide label format
            let timeDiff = 0;
            if (state.chart.viewEndIndex > state.chart.viewStartIndex && state.gameData.length > 0) {
                const startIndex = Math.max(0, state.chart.viewStartIndex);
                const endIndex = Math.min(state.gameData.length - 1, state.chart.viewEndIndex - 1);
                if (endIndex >= startIndex) {
                    timeDiff = state.gameData[endIndex].time - state.gameData[startIndex].time;
                }
            }
            
            ticks.forEach(tick => {
                const x = indexToX(tick.index);
                if (x >= left && x <= width - right) {
                    const date = new Date(tick.time);
                    let label;
                    if (tick.isDateSeparator) {
                         label = date.toLocaleDateString([], { month: 'numeric', day: 'numeric' });
                         ctx.font = 'bold 12px sans-serif'; 
                    } else {
                        ctx.font = '12px sans-serif';
                        // Show time if duration is short, otherwise show date
                        if (timeDiff < 48 * 3600 * 1000) { // Less than 2 days
                            label = date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', hour12: false });
                        } else {
                            label = date.toLocaleDateString([], { month: 'numeric', day: 'numeric' });
                        }
                    }
                    ctx.fillText(label, x, axisY + 5);
                }
            });
        }

        function drawCrosshair(ctx) {
            // V11.0: If dragging the chart (panning), don't show crosshair. (Feature 1)
            if (state.chart.isDragging && state.chart.draggedLineType === null) return;
            
            let x, y;
            if (state.chart.isCrosshairPinned) {
                x = state.chart.pinnedCrosshairPos.x;
                y = state.chart.pinnedCrosshairPos.y;
            } else if (state.mouse.isOverChart) {
                x = state.mouse.x;
                y = state.mouse.y;
            } else {
                return;
            }
            
            const { left, right, top, bottom } = CONFIG.CHART_PADDING;
            const { width, height } = state.chart;
            
            // Constrain crosshair to the chart area
            if (x < left || x > width - right || y < top || y > height - bottom) return;
            
            // V11.0: If dragging a line, only show the horizontal component (Feature 1)
            const showVertical = state.chart.draggedLineType === null;

            const crosshairColor = getComputedStyle(document.documentElement).getPropertyValue('--chart-crosshair').trim();
            ctx.strokeStyle = crosshairColor;
            ctx.lineWidth = 1;
            ctx.setLineDash([5, 5]);
            
            // Horizontal line
            ctx.beginPath();
            ctx.moveTo(left, y);
            ctx.lineTo(width - right, y);
            ctx.stroke();
            
            // Vertical line
            if (showVertical) {
                ctx.beginPath();
                ctx.moveTo(x, top);
                ctx.lineTo(x, height - bottom);
                ctx.stroke();
            }
            
            ctx.setLineDash([]);
            
            // Price label on Y-axis
            const crosshairPrice = yToPrice(y);
            const axisX = width - right;
            ctx.fillStyle = crosshairColor;
            ctx.fillRect(axisX + 1, y - 10, right - 1, 20);
            ctx.fillStyle = 'white'; 
            ctx.font = '12px sans-serif';
            ctx.textAlign = 'left';
            ctx.textBaseline = 'middle';
            ctx.fillText(crosshairPrice.toFixed(2), axisX + 5, y);
        }

        function updatePositionOverlays() {
            const overlay = DOM.chartOverlay;
            const linesToKeep = new Set();
            
            state.openPositions.forEach(pos => {
                const entryId = `line-entry-${pos.id}`;
                const slId = `line-sl-${pos.id}`;
                const tpId = `line-tp-${pos.id}`;
                
                const entryColor = pos.type === 'BUY' ? 'var(--color-bull)' : 'var(--color-bear)';
                
                // Entry Price Line
                createOrUpdatePositionLine(overlay, entryId, pos.entryPrice, entryColor, `進場價 ${pos.entryPrice.toFixed(2)}`, pos);
                linesToKeep.add(entryId);
                
                // SL Line
                if (pos.sl) {
                    const potentialPL = calculateProfit(pos, pos.sl);
                    createOrUpdatePositionLine(overlay, slId, pos.sl, 'var(--color-danger)', `停損 ${pos.sl.toFixed(2)}`, null, potentialPL);
                    linesToKeep.add(slId);
                }
                
                // TP Line
                if (pos.tp) {
                    const potentialPL = calculateProfit(pos, pos.tp);
                    createOrUpdatePositionLine(overlay, tpId, pos.tp, 'var(--color-success)', `停利 ${pos.tp.toFixed(2)}`, null, potentialPL);
                    linesToKeep.add(tpId);
                }
            });
            
            // Remove lines for closed positions
            Array.from(overlay.children).forEach(child => {
                if (child.classList.contains('position-line') && !linesToKeep.has(child.id)) {
                    overlay.removeChild(child);
                }
            });
        }

        function createOrUpdatePositionLine(container, id, price, color, labelText, position = null, potentialPL = null) {
            let line = document.getElementById(id);
            if (!line) {
                line = document.createElement('div');
                line.id = id;
                line.className = 'position-line';
                const label = document.createElement('div');
                label.className = 'position-label';
                line.appendChild(label);
                const plDisplay = document.createElement('div');
                plDisplay.className = 'position-pl';
                line.appendChild(plDisplay);
                const dash = document.createElement('div');
                dash.className = 'position-line-dash';
                line.appendChild(dash);
                container.appendChild(line);
            }
            
            const y = priceToY(price);
            
            // Hide if outside the visible chart area
            if (y < CONFIG.CHART_PADDING.top || y > state.chart.height - CONFIG.CHART_PADDING.bottom) {
                line.style.opacity = 0;
            } else {
                line.style.opacity = 1;
                line.style.top = `${y - 10}px`; // Center vertically
            }
            
            line.style.width = `calc(100% - ${CONFIG.CHART_PADDING.right}px)`;
            
            const dash = line.querySelector('.position-line-dash');
            dash.style.borderTopColor = color;
            
            const label = line.querySelector('.position-label');
            label.style.backgroundColor = color;
            label.textContent = labelText;
            
            const plDisplay = line.querySelector('.position-pl');
            let displayValue = null;
            if (position) {
                displayValue = position.profit;
            } else if (potentialPL !== null) {
                displayValue = potentialPL;
            }
            
            if (displayValue !== null) {
                plDisplay.textContent = `$${displayValue.toFixed(2)}`;
                plDisplay.style.color = displayValue >= 0 ? 'var(--color-success)' : 'var(--color-danger)';
                plDisplay.style.display = 'block';
            } else {
                plDisplay.style.display = 'none';
            }
        }

        const tradeAnimations = [];
        const chartAlertAnimations = [];

        function addTradeAnimation(type, price, index, profit = 0) {
            tradeAnimations.push({ type, price, index, profit, startTime: performance.now(), duration: type === 'CLOSE' ? 1500 : 800 });
            if (!state.isPlaying) requestAnimationFrame(draw);
        }

        function addChartAlertAnimation(type, price, index) {
            chartAlertAnimations.push({ type, price, index, startTime: performance.now(), duration: 2500 });
            if (!state.isPlaying) requestAnimationFrame(draw);
        }
        
        // V10.1: Updated animation drawing for centered display and smaller size
        function drawChartAlertAnimations(ctx) {
            const now = performance.now();
            let animationsRunning = false;
            // V10.1: Use all paddings and dimensions for accurate positioning
            const { left, right, top, bottom } = CONFIG.CHART_PADDING;
            const { width, height } = state.chart;

            for (let i = chartAlertAnimations.length - 1; i >= 0; i--) {
                const anim = chartAlertAnimations[i];
                const elapsed = now - anim.startTime;
                const progress = Math.min(1, elapsed / anim.duration);
                // Slightly faster fade out
                const opacity = progress < 0.7 ? 1 : 1 - ((progress - 0.7) / 0.3);
                const y = priceToY(anim.price);
                
                let color, text;
                if (anim.type === 'BREAKOUT') {
                    color = '#FFD700'; // Gold color for breakout
                    text = '💥 突破 7 日新高！';
                } else {
                    color = getComputedStyle(document.documentElement).getPropertyValue('--color-danger').trim();
                    text = '🔻 跌破 7 日新低！';
                }
                
                // Draw the pulsating line
                ctx.globalAlpha = opacity * 0.8;
                ctx.strokeStyle = color;
                // Reduced pulsation intensity slightly
                ctx.lineWidth = 2 + Math.sin(progress * Math.PI * 8) * 0.5; 
                ctx.beginPath();
                ctx.moveTo(left, y);
                ctx.lineTo(width - right, y);
                ctx.stroke();
                
                // Draw the floating text
                ctx.globalAlpha = opacity;

                // V10.1: Configuration for smaller, centered animation
                const fontSize = 16; // Reduced from 20px
                const padding = 8; // Reduced from 10px
                const floatDistance = progress * 30 + 20; // Reduced distance

                // V10.1: Center horizontally
                const chartAreaWidth = width - left - right;
                const textX = left + chartAreaWidth / 2;
                
                // Calculate Y position
                // Try positioning above the line first
                let floatY = y - floatDistance;
                
                ctx.font = `bold ${fontSize}px sans-serif`;
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle'; // Center vertically around floatY

                const textMetrics = ctx.measureText(text);
                const rectHeight = fontSize + padding * 2;
                const halfHeight = rectHeight / 2;

                // Robust Vertical Positioning:
                // Check if it goes off the top boundary
                if (floatY - halfHeight < top) {
                    // If it does, try positioning below the line
                    floatY = y + floatDistance;
                    
                    // Check if it goes off the bottom boundary
                    if (floatY + halfHeight > height - bottom) {
                        // If both top and bottom are cramped, place it at the boundary (top or bottom depending on where the price line 'y' is)
                        if (y < (top + height - bottom) / 2) {
                             // Price line is in the top half, place animation at the very top
                             floatY = top + halfHeight;
                        } else {
                            // Price line is in the bottom half, place animation at the very bottom
                            floatY = height - bottom - halfHeight;
                        }
                    }
                }

                const rectWidth = textMetrics.width + padding * 2;
                const rectX = textX - rectWidth / 2;
                const rectY = floatY - halfHeight;

                ctx.fillStyle = `rgba(50, 50, 50, ${opacity * 0.7})`;
                ctx.fillRect(rectX, rectY, rectWidth, rectHeight);
                
                ctx.fillStyle = color;
                ctx.fillText(text, textX, floatY);
                
                ctx.globalAlpha = 1;
                ctx.lineWidth = 1;
                
                if (progress >= 1) {
                    chartAlertAnimations.splice(i, 1);
                } else {
                    animationsRunning = true;
                }
            }
            if (animationsRunning && !state.isPlaying) requestAnimationFrame(draw);
        }

        function createFireworks(x, y, count = 100) {
            const colors = ['#ffc700', '#ff004d', '#00e0ff', '#2bff88', '#ffffff'];
            for (let i = 0; i < count; i++) {
                const angle = Math.random() * Math.PI * 2;
                const speed = Math.random() * 5 + 2;
                const vx = Math.cos(angle) * speed;
                const vy = Math.sin(angle) * speed;
                const color = colors[Math.floor(Math.random() * colors.length)];
                const size = Math.random() * 2 + 1;
                const lifespan = Math.random() * 60 + 60;

                state.fireworkParticles.push({
                    x, y, vx, vy, color, size, lifespan,
                    initialLifespan: lifespan,
                });
            }
        }

        function drawFireworks(ctx) {
            const gravity = 0.1;
            let animationsRunning = false;

            for (let i = state.fireworkParticles.length - 1; i >= 0; i--) {
                const p = state.fireworkParticles[i];
                p.vy += gravity;
                p.vx *= 0.99;
                p.vy *= 0.99;
                p.x += p.vx;
                p.y += p.vy;
                p.lifespan--;

                if (p.lifespan <= 0) {
                    state.fireworkParticles.splice(i, 1);
                    continue;
                }

                const opacity = Math.max(0, p.lifespan / p.initialLifespan);
                ctx.globalAlpha = opacity;
                ctx.fillStyle = p.color;
                ctx.beginPath();
                ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                ctx.fill();

                animationsRunning = true;
            }

            ctx.globalAlpha = 1.0;

            if (animationsRunning && !state.isPlaying) {
                requestAnimationFrame(draw);
            }
        }

        function drawTradeAnimations(ctx) {
            const now = performance.now();
            let animationsRunning = false;
            for (let i = tradeAnimations.length - 1; i >= 0; i--) {
                const anim = tradeAnimations[i];
                const elapsed = now - anim.startTime;
                const progress = Math.min(1, elapsed / anim.duration);
                const opacity = 1 - progress;
                
                const x = indexToX(anim.index);
                const y = priceToY(anim.price);
                
                // Skip if off-screen
                if (x < CONFIG.CHART_PADDING.left || x > state.chart.width - CONFIG.CHART_PADDING.right) {
                     if (progress >= 1) tradeAnimations.splice(i, 1);
                     else animationsRunning = true;
                    continue;
                }
                
                ctx.globalAlpha = opacity;
                
                if (anim.type === 'BUY' || anim.type === 'SELL') {
                    // Draw pulsating arrows for entry
                    const color = anim.type === 'BUY' ? getComputedStyle(document.documentElement).getPropertyValue('--color-bull').trim() : getComputedStyle(document.documentElement).getPropertyValue('--color-bear').trim();
                    ctx.fillStyle = color;
                    const size = 12 + progress * 5; 
                    const offsetY = anim.type === 'BUY' ? 15 : -15;
                    
                    ctx.beginPath();
                    if (anim.type === 'BUY') {
                        ctx.moveTo(x, y + offsetY);
                        ctx.lineTo(x - size/2, y + offsetY + size);
                        ctx.lineTo(x + size/2, y + offsetY + size);
                    } else {
                        ctx.moveTo(x, y + offsetY);
                        ctx.lineTo(x - size/2, y + offsetY - size);
                        ctx.lineTo(x + size/2, y + offsetY - size);
                    }
                    ctx.closePath();
                    ctx.fill();
                } else if (anim.type === 'CLOSE') {
                    // Draw floating profit/loss text
                    const color = anim.profit >= 0 ? getComputedStyle(document.documentElement).getPropertyValue('--color-success').trim() : getComputedStyle(document.documentElement).getPropertyValue('--color-danger').trim();
                    ctx.globalAlpha = opacity;
                    ctx.fillStyle = color;
                    ctx.font = 'bold 18px sans-serif';
                    ctx.textAlign = 'center';
                    const floatY = y - progress * 60;
                    const profitText = anim.profit >= 0 ? `+${Math.round(anim.profit)}` : `${Math.round(anim.profit)}`;
                    ctx.fillText(`${profitText} 分`, x, floatY);

                    // Draw ripple effect
                    const rippleRadius = progress * 40;
                    const rippleOpacity = 1 - progress;
                    ctx.globalAlpha = rippleOpacity * 0.5;
                    ctx.strokeStyle = color;
                    ctx.lineWidth = 3;
                    ctx.beginPath();
                    ctx.arc(x, y, rippleRadius, 0, Math.PI * 2);
                    ctx.stroke();
                }
                
                ctx.globalAlpha = 1;
                
                if (progress >= 1) {
                    tradeAnimations.splice(i, 1);
                } else {
                    animationsRunning = true;
                }
            }
            if (animationsRunning && !state.isPlaying) requestAnimationFrame(draw);
        }

        // ----------------------------------------------------------------------------
        // 5. 交易邏輯與帳戶管理 (Trading Logic & Account Management)
        // ----------------------------------------------------------------------------
        
        function getCurrentPrice() {
            if (state.gameData.length === 0 || state.currentIndex >= state.gameData.length) return 0;
            const currentBar = state.gameData[state.currentIndex];
            return getAnimatedBar(currentBar).close;
        }

         function openOrder(type, lots, sl = null, tp = null) {
            if (state.isEnded || state.gameData.length === 0) return;
            const entryPrice = getCurrentPrice();
            if (entryPrice <= 0) return;
            
            // Validation checks (使用標準技術性提示，符合規範)
            if (type === 'BUY') {
                if (sl && sl >= entryPrice) { alert("買單 (BUY) 的停損價格 (SL) 必須低於進場價格。"); return; }
                if (tp && tp <= entryPrice) { alert("買單 (BUY) 的停利價格 (TP) 必須高於進場價格。"); return; }
            } else {
                if (sl && sl <= entryPrice) { alert("賣單 (SELL) 的停損價格 (SL) 必須高於進場價格。"); return; }
                if (tp && tp >= entryPrice) { alert("賣單 (SELL) 的停利價格 (TP) 必須低於進場價格。"); return; }
            }
            
            const position = { id: state.orderIdCounter++, type, lots, entryPrice, entryTime: state.gameData[state.currentIndex].time, sl, tp, profit: 0 };
            
            // Check achievement for averaging down
            const sameTypeCount = state.openPositions.filter(p => p.type === type).length;
            if (sameTypeCount + 1 >= 3) unlockAchievement('AVERAGE_DOWN');

            state.openPositions.push(position);

            // V11.0: Clear SL/TP inputs after successful order (Feature 1 behavior refinement)
            DOM.inputSL.value = "";
            DOM.inputTP.value = "";

            addTradeAnimation(type, entryPrice, state.currentIndex);
            updateAccount();
            updateUI();
            if (!state.isPlaying) requestAnimationFrame(draw);
        }

        function closeOrder(id, closePrice, skipAchievementCheck = false) {
            const index = state.openPositions.findIndex(p => p.id === id);
            if (index === -1) return;
            
            const position = state.openPositions[index];
            const profit = calculateProfit(position, closePrice);
            state.balance += profit;
            
            if (profit > 0) {
                const x = indexToX(Math.min(state.currentIndex, state.gameData.length - 1));
                const y = priceToY(closePrice);
                const count = Math.min(300, 50 + Math.floor(profit / 50));
                createFireworks(x, y, count);
            }

            let closeTime;
            if (state.gameData && state.gameData.length > 0) {
                let closeIndex = state.currentIndex;
                if (closeIndex >= state.gameData.length) closeIndex = state.gameData.length - 1;
                closeTime = state.gameData[closeIndex].time;
            } else {
                closeTime = position.entryTime; // Fallback
            }
            
            const historyEntry = { ...position, closePrice, closeTime, profit };
            state.tradeHistory.push(historyEntry);
            state.openPositions.splice(index, 1);
            
            if (!skipAchievementCheck) {
                updateAchievementStats(historyEntry);
                checkTradeAchievements(historyEntry);
            }
            
            addTradeAnimation('CLOSE', closePrice, Math.min(state.currentIndex, state.gameData.length - 1), profit);
            updateAccount();
            updateUI();
            if (!state.isPlaying) requestAnimationFrame(draw);
        }
         
        function calculateProfit(position, currentPrice) {
            const priceDiff = position.type === 'BUY' ? currentPrice - position.entryPrice : position.entryPrice - currentPrice;
            return priceDiff * CONFIG.CONTRACT_SIZE * position.lots;
        }

        function updatePositions() {
            if (state.currentIndex >= state.gameData.length || state.gameData.length === 0) return;
            
            const currentBar = state.gameData[state.currentIndex];
            const animatedBar = getAnimatedBar(currentBar);
            const currentPrice = animatedBar.close;
            const currentHigh = animatedBar.high;
            const currentLow = animatedBar.low;
            
            const positionsToClose = [];
            
            // Iterate over a copy of the array to allow modification during loop (if needed later)
            [...state.openPositions].forEach(pos => {
                // Re-check if position still exists (might have been closed by SL/TP interaction)
                if (!state.openPositions.find(p => p.id === pos.id)) return;

                pos.profit = calculateProfit(pos, currentPrice);
                
                // Check achievement for diamond hands loss
                if (pos.profit < 0) {
                    const positionValue = pos.entryPrice * CONFIG.CONTRACT_SIZE * pos.lots;
                    if (positionValue > 0) {
                        const lossPercentage = (Math.abs(pos.profit) / positionValue) * 100;
                        if (lossPercentage > 30) unlockAchievement('DIAMOND_HANDS_LOSS');
                    }
                }

                // Check SL/TP triggers based on wicks (High/Low)
                if (pos.type === 'BUY') {
                    if (pos.sl && currentLow <= pos.sl) positionsToClose.push({ id: pos.id, price: pos.sl, reason: 'SL' });
                    else if (pos.tp && currentHigh >= pos.tp) positionsToClose.push({ id: pos.id, price: pos.tp, reason: 'TP' });
                } else { // SELL
                    if (pos.sl && currentHigh >= pos.sl) positionsToClose.push({ id: pos.id, price: pos.sl, reason: 'SL' });
                    else if (pos.tp && currentLow <= pos.tp) positionsToClose.push({ id: pos.id, price: pos.tp, reason: 'TP' });
                }
            });
            
            // Process closures sequentially to avoid race conditions
            const closedIds = new Set();
            positionsToClose.forEach(order => {
                if (!closedIds.has(order.id)) {
                    closeOrder(order.id, order.price);
                    closedIds.add(order.id);
                }
            });
        }

        function updateAccount() {
            state.floatingPL = state.openPositions.reduce((sum, pos) => sum + pos.profit, 0);
            state.equity = state.balance + state.floatingPL;
            
            // Update equity stats for achievements
            if (state.equity > state.achievementStats.maxEquity) state.achievementStats.maxEquity = state.equity;
            if (state.equity < state.achievementStats.minEquity) state.achievementStats.minEquity = state.equity;
            
            checkEquityAchievements();

            if (state.equity <= 0 && !state.isEnded) {
                endGame();
            }
        }

        // ----------------------------------------------------------------------------
        // 6. UI 更新與互動 (UI Updates & Interaction)
        // ----------------------------------------------------------------------------
        function updateUI() {
            updateHUD();
            updatePositionsPanel();
            updateHistoryPanel();
            updateControls();
            updateOrderPanel();
            // V11.0: If not playing, trigger a redraw to update the SL/TP lines (Feature 1)
            // This ensures lines update when inputs change (typing, scrubbing, or dragging).
            if (!state.isPlaying) {
                requestAnimationFrame(draw);
            }
        }

        function updateOrderPanel() {
            DOM.btnCloseAllGlobal.disabled = state.openPositions.length === 0 || state.isEnded;
            updateEstimatedPL();
        }

        function updateEstimatedPL() {
            // Ensure DOM elements are ready
            if (!DOM.inputLots || !DOM.inputSL || !DOM.inputTP || !DOM.estimateSL || !DOM.estimateTP) return;

            const lots = parseFloat(DOM.inputLots.value);
            const slPrice = parseFloat(DOM.inputSL.value);
            const tpPrice = parseFloat(DOM.inputTP.value);
            const currentPrice = getCurrentPrice();
            
            DOM.estimateSL.textContent = '';
            DOM.estimateTP.textContent = '';
            if (isNaN(lots) || lots <= 0 || currentPrice <= 0) return;
            
            if (!isNaN(slPrice) && slPrice > 0) {
                const slPL = Math.abs(currentPrice - slPrice) * CONFIG.CONTRACT_SIZE * lots;
                DOM.estimateSL.textContent = `SL: -${Math.round(slPL)} 分`;
            }
            if (!isNaN(tpPrice) && tpPrice > 0) {
                const tpPL = Math.abs(currentPrice - tpPrice) * CONFIG.CONTRACT_SIZE * lots;
                DOM.estimateTP.textContent = `TP: +${Math.round(tpPL)} 分`;
            }
        }
        
        function updateHUD() {
            if (state.gameData.length === 0) return;
            let displayIndex = Math.min(state.currentIndex, state.gameData.length - 1);
            if (displayIndex < 0) return;

            const currentDate = new Date(state.gameData[displayIndex].time);
            DOM.hudDate.textContent = currentDate.toLocaleString('zh-TW', { year: 'numeric', month: 'numeric', day: 'numeric', hour: '2-digit', minute: '2-digit', hour12: false });
            
            DOM.hudEquity.textContent = `${Math.round(state.equity)} 分`;
            const plText = state.floatingPL >= 0 ? `+${Math.round(state.floatingPL)}` : `${Math.round(state.floatingPL)}`;
            DOM.hudPL.textContent = `${plText} 分`;
            DOM.hudPL.classList.toggle('positive', state.floatingPL > 0);
            DOM.hudPL.classList.toggle('negative', state.floatingPL < 0);
            
            const progress = (displayIndex / (state.gameData.length - 1)) * 100;
            DOM.hudProgress.style.width = `${Math.min(100, progress)}%`;
        }
        
        // V9.0: Updated to update navigation bar count
        function updatePositionsPanel() {
            DOM.positionsCount.textContent = state.openPositions.length;
            // V9.0: Update the count in the navigation bar as well
            if (DOM.positionsCountNav) {
                DOM.positionsCountNav.textContent = state.openPositions.length;
            }
            
            // Handle Empty State visibility
            if (state.openPositions.length === 0) {
                DOM.emptyPositions.style.display = 'flex';
            } else {
                DOM.emptyPositions.style.display = 'none';
            }

            // Select only trade items, not the empty state
            const existingItems = DOM.positionsList.querySelectorAll('.trade-item');
            const currentIds = new Set(state.openPositions.map(p => p.id));
            
            // Remove closed positions
            existingItems.forEach(item => {
                if (!currentIds.has(parseInt(item.dataset.id))) {
                    DOM.positionsList.removeChild(item);
                }
            });

            // Add or update existing positions
            state.openPositions.forEach(pos => {
                let item = DOM.positionsList.querySelector(`[data-id="${pos.id}"]`);
                if (!item) {
                    item = document.createElement('div');
                    item.className = 'trade-item';
                    item.dataset.id = pos.id;
                    item.innerHTML = `
                        <div class="trade-header">
                            <span class="trade-type ${pos.type}">#${pos.id} ${pos.type === 'BUY' ? '買入' : '賣出'} ${pos.lots.toFixed(2)}手</span>
                            <span class="trade-profit"></span>
                        </div>
                        <div class="trade-details">
                            <div><div class="trade-detail-label">進場價</div><div>${pos.entryPrice.toFixed(2)}</div></div>
                            <div><div class="trade-detail-label">停損(SL)</div><div class="trade-sl"></div></div>
                            <div><div class="trade-detail-label">停利(TP)</div><div class="trade-tp"></div></div>
                        </div>
                        <div class="trade-actions-buttons">
                            <button class="btn btn-small btn-secondary btn-modify">修改</button>
                            <button class="btn btn-small btn-danger btn-close">平倉</button>
                        </div>
                    `;
                    // Insert before the empty state element
                    DOM.positionsList.insertBefore(item, DOM.emptyPositions);
                }
                
                // Update profit and SL/TP values
                const profitElement = item.querySelector('.trade-profit');
                const profitText = pos.profit >= 0 ? `+${Math.round(pos.profit)}` : `${Math.round(pos.profit)}`;
                const newProfitText = `${profitText} 分`;
                if (profitElement.textContent !== newProfitText) {
                    profitElement.textContent = newProfitText;
                    profitElement.style.color = pos.profit >= 0 ? 'var(--color-success)' : 'var(--color-danger)';
                }
                item.querySelector('.trade-sl').textContent = pos.sl ? pos.sl.toFixed(2) : 'N/A';
                item.querySelector('.trade-tp').textContent = pos.tp ? pos.tp.toFixed(2) : 'N/A';
            });
        }

        function updateHistoryPanel() {
            // Handle Empty State visibility
            if (state.tradeHistory.length === 0) {
                DOM.emptyHistory.style.display = 'flex';
            } else {
                DOM.emptyHistory.style.display = 'none';
            }

            // Check against actual trade items, excluding the empty state
            const tradeItemCount = DOM.historyList.querySelectorAll('.trade-item').length;
            if (tradeItemCount === state.tradeHistory.length) return;
            
            // Clear existing items (but keep the empty state element)
            DOM.historyList.querySelectorAll('.trade-item').forEach(item => item.remove());

            [...state.tradeHistory].reverse().forEach(trade => {
                const item = document.createElement('div');
                item.className = 'trade-item';
                item.innerHTML = `
                    <div class="trade-header">
                        <span class="trade-type ${trade.type}">#${trade.id} ${trade.type === 'BUY' ? '買入' : '賣出'} ${trade.lots.toFixed(2)}手</span>
                        <span style="color: ${trade.profit >= 0 ? 'var(--color-success)' : 'var(--color-danger)'}">${trade.profit >= 0 ? '+' : ''}${Math.round(trade.profit)} 分</span>
                    </div>
                    <div class="trade-details">
                        <div><div class="trade-detail-label">開倉價</div><div>${trade.entryPrice.toFixed(2)}</div></div>
                        <div><div class="trade-detail-label">平倉價</div><div>${trade.closePrice.toFixed(2)}</div></div>
                        <div><div class="trade-detail-label">持有時間</div><div>${formatDuration(trade.closeTime - trade.entryTime)}</div></div>
                    </div>
                `;
                // Insert before the empty state
                DOM.historyList.insertBefore(item, DOM.emptyHistory);
            });
        }

        function updateControls() {
            DOM.btnPlayPause.textContent = state.isPlaying ? '⏸️ 暫停' : '▶️ 播放';
            DOM.btnStepForward.disabled = state.isPlaying || state.isEnded;
            DOM.btnPlayPause.disabled = state.isEnded;
            document.getElementById('btnBuy').disabled = state.isEnded;
            document.getElementById('btnSell').disabled = state.isEnded;
            document.getElementById('btnEndGame').disabled = state.isEnded;
        }

        function setupEventListeners() {
            window.addEventListener('resize', resizeCanvas);
            DOM.btnPlayPause.addEventListener('click', togglePlayPause);
            DOM.btnStepForward.addEventListener('click', stepForward);
            DOM.speedSelector.addEventListener('click', handleSpeedChange);
            document.getElementById('btnZoomIn').addEventListener('click', () => zoomChart(1.2));
            document.getElementById('btnZoomOut').addEventListener('click', () => zoomChart(1/1.2));
            document.getElementById('btnEndGame').addEventListener('click', handleEndGameClick);

            // V9.0: Handle the internal tabs (Positions vs History)
            document.querySelectorAll('.tab-btn').forEach(btn => btn.addEventListener('click', handleInternalTabSwitch));
            
            // V9.0: Handle the main navigation tabs (Order vs Positions/History)
            document.querySelectorAll('.nav-btn-v9').forEach(btn => btn.addEventListener('click', handleNavigationTabSwitch));
            
            DOM.btnToggleControls.addEventListener('click', toggleCollapsibleControls);

            setupInputScrubbing();

            // V11.0: Added 'change' event listener for manual input updates (Feature 1)
            // Using 'input' covers real-time changes (typing/scrubbing), 'change' covers final confirmation.
            DOM.inputLots.addEventListener('input', updateUI);
            DOM.inputSL.addEventListener('input', updateUI);
            DOM.inputTP.addEventListener('input', updateUI);
            DOM.inputLots.addEventListener('change', updateUI);
            DOM.inputSL.addEventListener('change', updateUI);
            DOM.inputTP.addEventListener('change', updateUI);

            document.getElementById('btnBuy').addEventListener('click', () => handleTrade('BUY'));
            document.getElementById('btnSell').addEventListener('click', () => handleTrade('SELL'));
            
            DOM.btnCloseAllGlobal.addEventListener('click', closeAllOrders);


            DOM.positionsList.addEventListener('click', (e) => {
                const target = e.target;
                const tradeItem = target.closest('.trade-item');
                if (!tradeItem) return;
                const id = parseInt(tradeItem.dataset.id);
                if (!state.openPositions.find(p => p.id === id)) return;
                if (target.classList.contains('btn-close')) closeOrder(id, getCurrentPrice());
                else if (target.classList.contains('btn-modify')) modifyOrder(id);
            });
            
            // Chart Interactions
            DOM.chartWrap.addEventListener('mousemove', handleMouseMove);
            DOM.chartWrap.addEventListener('mouseleave', handleMouseLeave);
            DOM.chartWrap.addEventListener('wheel', handleMouseWheel, { passive: false });
            DOM.chartWrap.addEventListener('mousedown', handleDragStart);
            window.addEventListener('mousemove', handleDragging);
            window.addEventListener('mouseup', handleDragEnd);

            // V11.0: Updated touch listeners for Pinch-to-Zoom (Feature 3)
            DOM.chartWrap.addEventListener('touchstart', handleTouchStart, { passive: false });
            window.addEventListener('touchmove', handleTouchMove, { passive: false });
            window.addEventListener('touchend', handleTouchEnd);
            
            document.getElementById('eventContinueBtn').addEventListener('click', continueFromEvent);
            document.getElementById('restartButton').addEventListener('click', startGame);
        }
        
        function handleEndGameClick() {
            if (state.isEnded) return;
            if (state.isPlaying) togglePlayPause();
            if (confirm("確定要提前結束本次挑戰嗎？")) endGame();
        }

        function toggleCollapsibleControls() {
            // V9.0 (R3): Updated logic for new initial state
            DOM.chartControls.classList.toggle('controls-collapsed');
            
            if (DOM.chartControls.classList.contains('controls-collapsed')) {
                DOM.btnToggleControls.textContent = '展開設定';
            } else {
                DOM.btnToggleControls.textContent = '隱藏設定';
            }

            // Trigger a resize just in case layout changes affect the chart wrap dimensions.
            setTimeout(resizeCanvas, 50);
        }
        
        function togglePlayPause() {
            if (state.isEnded) return;
            state.isPlaying = !state.isPlaying;
            if (state.isPlaying) {
                lastTickTime = 0; 
                animationFrameId = requestAnimationFrame(gameLoop);
            } else {
                cancelAnimationFrame(animationFrameId);
            }
            updateControls();
        }

        function stepForward() {
            if (state.isPlaying || state.isEnded) return;
            finalizeCurrentBar();
            if (!advanceSimulation()) {
                endGame();
            } else {
                state.barAnimationProgress = 1; // Show the new bar immediately
                updatePositions();
                check7DayBreakout(); 
                updateAccount();
                checkDurationAchievements();
                checkDrawdownAchievement();
                updateUI();
                checkForEvents();
                // If scrolled back, step forward should decrease the offset
                if (state.chart.scrollOffset > 0) state.chart.scrollOffset = Math.max(0, state.chart.scrollOffset - 1);
                requestAnimationFrame(draw);
            }
        }
        
        function handleSpeedChange(e) {
            if (e.target.classList.contains('speed-btn')) {
                document.querySelectorAll('.speed-btn').forEach(btn => btn.classList.remove('active'));
                e.target.classList.add('active');
                state.speedMultiplier = parseInt(e.target.dataset.speed);
                lastTickTime = 0; // Reset tick timing when speed changes
            }
        }
        
        // V9.0: New function for main navigation tabs
        function handleNavigationTabSwitch(e) {
            const target = e.target.closest('.nav-btn-v9');
            if (!target) return;
            const targetId = target.dataset.target;

            document.querySelectorAll('.nav-btn-v9').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.tab-content-v9').forEach(c => c.classList.remove('active'));
            
            target.classList.add('active');
            document.getElementById(targetId).classList.add('active');

            // V10.0: Trigger resize when switching tabs. Crucial for the Grid/Flex hybrid layout.
            setTimeout(resizeCanvas, 50);

            if (state.tutorialActive) setTimeout(showTutorialStep, 50); 
        }

        // V9.0: Renamed from handleTabSwitch to handleInternalTabSwitch
        function handleInternalTabSwitch(e) {
            const target = e.target.closest('.tab-btn');
            if (!target) return;
            // V9.0: Selectors target the internal tabs (tab-btn and tab-content)
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            target.classList.add('active');
            document.getElementById(target.dataset.target).classList.add('active');
            if (state.tutorialActive) setTimeout(showTutorialStep, 50); 
        }

        function handleTrade(type) {
            const lots = parseFloat(DOM.inputLots.value);
            const sl = DOM.inputSL.value ? parseFloat(DOM.inputSL.value) : null;
            const tp = DOM.inputTP.value ? parseFloat(DOM.inputTP.value) : null;
            
            if (isNaN(lots) || lots < 0.01) { alert("請輸入有效的手數 (Lots)，最小為 0.01。"); return; }
            if ((sl !== null && (isNaN(sl) || sl <= 0)) || (tp !== null && (isNaN(tp) || tp <= 0))) {
                alert("停損/停利價格必須是正數。"); return;
            }
            
            openOrder(type, lots, sl, tp);
        }

        function closeAllOrders() {
            if (state.openPositions.length === 0 || state.isEnded) return;

            const currentPrice = getCurrentPrice();
            // Iterate over a copy of the array as closeOrder modifies the original array
            [...state.openPositions].forEach(pos => closeOrder(pos.id, currentPrice));
        }

        function modifyOrder(id) {
            const position = state.openPositions.find(p => p.id === id);
            if (!position) return;
            
            if (state.isPlaying) togglePlayPause(); // Pause simulation during modification
            
            const currentSL = position.sl ? position.sl.toFixed(2) : '';
            const currentTP = position.tp ? position.tp.toFixed(2) : '';
            
            const newSLInput = prompt(`修改訂單 #${id} 停損 (SL)。\n進場價: ${position.entryPrice.toFixed(2)}\n留空則取消 SL。目前值: ${currentSL}`, currentSL);
            if (newSLInput === null) return; // User cancelled
            
            const newTPInput = prompt(`修改訂單 #${id} 停利 (TP)。\n進場價: ${position.entryPrice.toFixed(2)}\n留空則取消 TP。目前值: ${currentTP}`, currentTP);
            if (newTPInput === null) return; // User cancelled

            // Parse and validate SL
            let newSL = null;
            if (newSLInput !== '') {
                newSL = parseFloat(newSLInput);
                if (isNaN(newSL) || newSL <= 0) { alert("無效的 SL 價格。"); return; }
                if (position.type === 'BUY' && newSL >= position.entryPrice) { alert("買單的停損必須低於進場價。"); return; }
                if (position.type === 'SELL' && newSL <= position.entryPrice) { alert("賣單的停損必須高於進場價。"); return; }
            }
            
            // Parse and validate TP
            let newTP = null;
            if (newTPInput !== '') {
                newTP = parseFloat(newTPInput);
                if (isNaN(newTP) || newTP <= 0) { alert("無效的 TP 價格。"); return; }
                if (position.type === 'BUY' && newTP <= position.entryPrice) { alert("買單的停利必須高於進場價。"); return; }
                if (position.type === 'SELL' && newTP >= position.entryPrice) { alert("賣單的停利必須低於進場價。"); return; }
            }
            
            position.sl = newSL;
            position.tp = newTP;
            updateUI();
            if (!state.isPlaying) requestAnimationFrame(draw);
        }
        
        function handleMouseMove(e) {
            const rect = DOM.chartWrap.getBoundingClientRect();
            state.mouse.x = e.clientX - rect.left;
            state.mouse.y = e.clientY - rect.top;
            state.mouse.isOverChart = true;
            // Unpin crosshair on mouse move (Desktop behavior)
            if (state.chart.isCrosshairPinned && !state.isMobile) state.chart.isCrosshairPinned = false;
            
            // V11.0: Update cursor style based on hover (Feature 1)
            updateCursorStyle();

            if (!state.isPlaying && !state.chart.isDragging) requestAnimationFrame(draw);
        }

        function handleMouseLeave() {
            state.mouse.isOverChart = false;
            // V11.0: Reset cursor style on leave (Feature 1)
            updateCursorStyle();
            if (!state.isPlaying && !state.chart.isDragging) requestAnimationFrame(draw);
        }

        function handleMouseWheel(e) {
            e.preventDefault();
            zoomChart(e.deltaY > 0 ? 1 / 1.1 : 1.1);
        }

        function zoomChart(factor) {
            if (state.chart.inertiaAnimationFrameId) {
                cancelAnimationFrame(state.chart.inertiaAnimationFrameId);
                state.chart.inertiaAnimationFrameId = null;
            }
            const newWidth = state.chart.candleWidth * factor;
            
            // V11.0: Enforce Zoom Constraints (Feature 3)
            // Define physical constraints based on candle width
            const MIN_CANDLE_WIDTH = 2; 
            const MAX_CANDLE_WIDTH = 50; 

            // Calculate potential visible candles with the new width
            const chartAreaWidth = state.chart.width - CONFIG.CHART_PADDING.left - CONFIG.CHART_PADDING.right;
            const newSpacing = state.chart.candleSpacing * factor;
            const newUnitWidth = newWidth + newSpacing;

            if (newUnitWidth <= 0) return;

            // Check constraints based on visible candles (if chart area is valid)
            if (chartAreaWidth > 0) {
                const visibleCandles = Math.floor(chartAreaWidth / newUnitWidth);

                // Enforce minimum visible candles (Zoom In Limit)
                if (visibleCandles < CONFIG.MIN_VISIBLE_CANDLES && factor > 1) {
                    // Allow zoom if the chart area is inherently very small, otherwise restrict
                    if (chartAreaWidth > CONFIG.MIN_VISIBLE_CANDLES * (CONFIG.CANDLE_WIDTH_DEFAULT + CONFIG.CANDLE_SPACING)) {
                        return;
                    }
                }

                // Enforce maximum visible candles (Zoom Out Limit)
                if (visibleCandles > CONFIG.MAX_VISIBLE_CANDLES && factor < 1) {
                    return;
                }
            }

            // Fallback physical constraints (important if chartAreaWidth is 0 or for extreme aspect ratios)
            if (newWidth < MIN_CANDLE_WIDTH || newWidth > MAX_CANDLE_WIDTH) return;

            state.chart.candleWidth = newWidth;
            state.chart.candleSpacing = newSpacing; // Keep spacing proportional
            validateScrollOffset();
            if (!state.isPlaying) requestAnimationFrame(draw);
        }

        // V11.0: Helper to check if a point is near a setup line (Feature 1)
        function getLineNearPoint(x, y) {
            const proximityThreshold = 8; // pixels tolerance
            const { left, right } = CONFIG.CHART_PADDING;
            const { width } = state.chart;

            // Only check if cursor is within the main chart area horizontally
            if (x < left || x > width - right) return null;

            // Ensure inputs are available
            if (!DOM.inputSL || !DOM.inputTP) return null;

            const slPrice = parseFloat(DOM.inputSL.value);
            const tpPrice = parseFloat(DOM.inputTP.value);

            // Check SL proximity
            if (!isNaN(slPrice) && slPrice > 0) {
                const slY = priceToY(slPrice);
                if (Math.abs(y - slY) <= proximityThreshold) return 'SL';
            }
            // Check TP proximity
            if (!isNaN(tpPrice) && tpPrice > 0) {
                const tpY = priceToY(tpPrice);
                if (Math.abs(y - tpY) <= proximityThreshold) return 'TP';
            }
            return null;
        }

        // V11.0: Helper to manage cursor style based on hover state (Feature 1)
        function updateCursorStyle() {
            if (state.chart.isDragging || state.chart.isPinching) return; // Dragging/Pinching handles its own cursor

            const chartX = state.mouse.x;
            const chartY = state.mouse.y;

            if (state.mouse.isOverChart) {
                const lineType = getLineNearPoint(chartX, chartY);
                if (lineType) {
                    DOM.chartWrap.style.cursor = 'ns-resize'; // Vertical resize cursor when hovering a line
                } else {
                    DOM.chartWrap.style.cursor = 'crosshair';
                }
            } else {
                DOM.chartWrap.style.cursor = 'crosshair';
            }
        }


        function handleDragStart(e) { if (e.button === 0) startDrag(e.clientX, e.clientY); }
        function handleDragging(e) { if (state.chart.isDragging) performDrag(e.clientX, e.clientY); }
        
        // V11.0: Updated handleDragEnd for desktop
        function handleDragEnd() { 
            // V11.0: Only call endDrag if dragging was active (handles desktop/mobile differences)
            if (state.chart.isDragging) {
                endDrag(); 
            }
        }

        // V11.0: Updated touch handlers for Pinch-to-Zoom and Line Dragging (Feature 1 & 3)
        function handleTouchStart(e) {
            // Only handle touches that originated within the chart wrap area
            if (!e.target.closest('#chartWrap')) return;

            // V11.0: Handle multi-touch (Pinch-to-zoom) (Feature 3)
            if (e.touches.length === 2) {
                if (e.cancelable) e.preventDefault();
                state.chart.isDragging = false; // Cancel any ongoing panning/line dragging
                state.chart.isPinching = true;
                
                // Calculate initial distance between fingers
                const dx = e.touches[0].clientX - e.touches[1].clientX;
                const dy = e.touches[0].clientY - e.touches[1].clientY;
                state.chart.pinchStartDistance = Math.sqrt(dx * dx + dy * dy);
                state.chart.pinchStartCandleWidth = state.chart.candleWidth;

            } else if (e.touches.length === 1) {
                // Handle single touch (Panning or Line Dragging)
                // Prevent default scrolling/zooming behavior, unless interacting with controls
                if (!e.target.closest('.controls')) {
                     if (e.cancelable) e.preventDefault();
                }
                // Ensure pinching flag is off
                state.chart.isPinching = false;
                startDrag(e.touches[0].clientX, e.touches[0].clientY);
            }
        }

        function handleTouchMove(e) {
            // V11.0: Handle Pinching (Feature 3)
            if (state.chart.isPinching && e.touches.length === 2) {
                if (e.cancelable) e.preventDefault();

                // Calculate current distance
                const dx = e.touches[0].clientX - e.touches[1].clientX;
                const dy = e.touches[0].clientY - e.touches[1].clientY;
                const currentDistance = Math.sqrt(dx * dx + dy * dy);

                if (state.chart.pinchStartDistance > 0) {
                    const scaleFactor = currentDistance / state.chart.pinchStartDistance;
                    // Calculate the target width based on the width at the start of the pinch
                    const newWidth = state.chart.pinchStartCandleWidth * scaleFactor;
                    // Call zoomChart with the ratio relative to the CURRENT width to apply the change
                    zoomChart(newWidth / state.chart.candleWidth);
                }

            } else if (e.touches.length === 1 && state.chart.isDragging) {
                if (e.cancelable) e.preventDefault();
                const dx = e.touches[0].clientX - state.chart.dragStartX;
                const dy = e.touches[0].clientY - state.chart.dragStartY;
                
                // Unpin crosshair if dragging the chart significantly (Mobile behavior)
                // V11.0: Check specifically if dragging the chart (draggedLineType === null)
                if (state.chart.draggedLineType === null && Math.sqrt(dx * dx + dy * dy) > 10 && state.chart.isCrosshairPinned) {
                    state.chart.isCrosshairPinned = false;
                }
                performDrag(e.touches[0].clientX, e.touches[0].clientY);
            }
        }

        function handleTouchEnd(e) {
            // V11.0: Reset pinching state (Feature 3)
            if (state.chart.isPinching) {
                state.chart.isPinching = false;
                // If one finger remains on screen after pinch ends, potentially initiate drag
                if (e.touches.length === 1) {
                    startDrag(e.touches[0].clientX, e.touches[0].clientY);
                }
                return; 
            }

            if (!state.chart.isDragging) return;

            // V11.0: If dragging a line, just end the drag, don't check for taps (Feature 1)
            if (state.chart.draggedLineType !== null) {
                endDrag();
                return;
            }

            const touchDuration = Date.now() - state.chart.dragStartTimeStamp;
            const dx = state.chart.dragCurrentX - state.chart.dragStartX;
            const dy = state.chart.dragCurrentY - state.chart.dragStartY;
            const isTap = touchDuration < 300 && Math.sqrt(dx * dx + dy * dy) < 10;
            
            // Check if the tap occurred on the chart canvas itself, not on the controls
            // We must check the coordinates of the interaction against the bounds of the controls.
            let isOnControls = false;
            const rect = DOM.chartWrap.getBoundingClientRect();
            // Use the start coordinates (relative to viewport) for checking against control bounds
            const startX = state.chart.dragStartX;
            const startY = state.chart.dragStartY;
            
            // Check if the starting point of the drag was within the bounds of any control container
            const controlsContainers = document.querySelectorAll('.controls-overlay-container .controls');
            controlsContainers.forEach(container => {
                const ctrlRect = container.getBoundingClientRect();
                if (startX >= ctrlRect.left && startX <= ctrlRect.right &&
                    startY >= ctrlRect.top && startY <= ctrlRect.bottom) {
                    isOnControls = true;
                }
            });


            if (isTap && !isOnControls) {
                // Toggle pinned crosshair on tap (Mobile behavior)
                if (state.chart.isCrosshairPinned) {
                    state.chart.isCrosshairPinned = false;
                } else {
                    // Use the current coordinates (relative to chart wrap) for pinning
                    state.chart.pinnedCrosshairPos.x = state.chart.dragCurrentX - rect.left;
                    state.chart.pinnedCrosshairPos.y = state.chart.dragCurrentY - rect.top;
                    state.chart.isCrosshairPinned = true;
                }
            }
            endDrag();
        }

        function startDrag(clientX, clientY) {
            if (state.chart.inertiaAnimationFrameId) {
                cancelAnimationFrame(state.chart.inertiaAnimationFrameId);
                state.chart.inertiaAnimationFrameId = null;
            }
            // V11.0: Check if starting a line drag (Feature 1)
            const rect = DOM.chartWrap.getBoundingClientRect();
            const chartX = clientX - rect.left;
            const chartY = clientY - rect.top;

            const lineType = getLineNearPoint(chartX, chartY);
            if (lineType) {
                state.chart.isDragging = true;
                state.chart.draggedLineType = lineType;
                DOM.chartWrap.style.cursor = 'ns-resize'; // Vertical resize cursor
            } else {
                // Default chart panning behavior
                state.chart.isDragging = true;
                state.chart.draggedLineType = null;
                state.chart.dragStartX = clientX;
                state.chart.dragStartScroll = state.chart.scrollOffset;
                // Only set 'grabbing' cursor if not pinching (prevents flicker on mobile)
                if (!state.chart.isPinching) {
                     DOM.chartWrap.style.cursor = 'grabbing';
                }
            }

            // Common setup
            state.chart.dragCurrentX = clientX;
            state.chart.dragCurrentY = clientY;
            state.chart.dragStartTimeStamp = Date.now();
            state.chart.dragLastX = clientX;
            state.chart.dragLastTime = state.chart.dragStartTimeStamp;
            state.chart.dragVelocity = 0;
        }

        function performDrag(clientX, clientY) {
            const now = Date.now();
            const deltaTime = now - state.chart.dragLastTime;
            const dxSinceLast = clientX - state.chart.dragLastX;

            state.chart.dragCurrentX = clientX;
            state.chart.dragCurrentY = clientY;

            if (deltaTime > 0) {
                state.chart.dragVelocity = dxSinceLast / deltaTime;
            }

            // V11.0: Handle line dragging (Feature 1)
            if (state.chart.draggedLineType) {
                const rect = DOM.chartWrap.getBoundingClientRect();
                const chartY = clientY - rect.top;
                // yToPrice handles boundary constraints
                const newPrice = yToPrice(chartY);
                
                if (newPrice > 0) {
                    const inputField = state.chart.draggedLineType === 'SL' ? DOM.inputSL : DOM.inputTP;
                    // Update input field value in real-time
                    inputField.value = newPrice.toFixed(2);
                    // Update estimates and UI (which redraws the chart)
                    updateUI(); 
                }
            } else {
                // Default chart panning behavior
                const dx = clientX - state.chart.dragStartX;
                const candleUnitWidth = state.chart.candleWidth + state.chart.candleSpacing;
                if (candleUnitWidth <= 0) return;
                state.chart.scrollOffset = state.chart.dragStartScroll + Math.round(dx / candleUnitWidth);
                validateScrollOffset();
                requestAnimationFrame(draw);
            }

            state.chart.dragLastX = clientX;
            state.chart.dragLastTime = now;
        }

        function endDrag() {
            state.chart.isDragging = false;
            // V11.0: Reset dragged line type (Feature 1)
            state.chart.draggedLineType = null;
            // V11.0: Restore cursor based on current hover state
            updateCursorStyle(); 

            if (Math.abs(state.chart.dragVelocity) > 0.1) {
                startInertia();
            }
            if (!state.isPlaying) requestAnimationFrame(draw);
        }

        function startInertia() {
            if (state.chart.inertiaAnimationFrameId) {
                cancelAnimationFrame(state.chart.inertiaAnimationFrameId);
            }
            state.chart.inertiaAnimationFrameId = requestAnimationFrame(inertiaLoop);
        }

        function inertiaLoop() {
            const FRICTION = 0.95;
            state.chart.dragVelocity *= FRICTION;

            if (Math.abs(state.chart.dragVelocity) < 0.01) {
                state.chart.inertiaAnimationFrameId = null;
                return;
            }

            const candleUnitWidth = state.chart.candleWidth + state.chart.candleSpacing;
            if (candleUnitWidth <= 0) return;

            const scrollChange = state.chart.dragVelocity * 16; // 16ms ~ 60fps
            const offsetChange = scrollChange / candleUnitWidth;

            state.chart.scrollOffset += offsetChange;
            validateScrollOffset();
            draw();

            state.chart.inertiaAnimationFrameId = requestAnimationFrame(inertiaLoop);
        }

        function validateScrollOffset() {
            if (state.gameData.length === 0) {
                state.chart.scrollOffset = 0;
                return;
            }
            const visibleCandles = calculateVisibleCandles();
            // Max offset means the chart is scrolled all the way to the beginning (left)
            const maxOffset = Math.max(0, state.currentIndex + 1 - visibleCandles);
            state.chart.scrollOffset = Math.max(0, Math.min(maxOffset, state.chart.scrollOffset));
        }

        // ----------------------------------------------------------------------------
        // 7. 遊戲化功能 (Gamification Features)
        // ----------------------------------------------------------------------------
        
        // (Event and Modal functions remain the same)

        function checkForEvents() {
            if (state.isEnded || state.gameData.length === 0) return;
            const elapsedDays = Math.floor((state.gameData[state.currentIndex].time - state.gameData[0].time) / 86400000) + 1;
            const event = state.financialEvents.find(e => e.triggerDay === elapsedDays);
            const eventKey = `Day${elapsedDays}`;
            if (event && !state.triggeredEvents.has(eventKey)) {
                showEventModal(event);
                state.triggeredEvents.add(eventKey);
            }
        }

        function showEventModal(event) {
            if (state.isPlaying) {
                state.wasPlayingBeforeEvent = true;
                state.isPlaying = false;
                cancelAnimationFrame(animationFrameId);
                updateControls();
            } else {
                state.wasPlayingBeforeEvent = false;
            }
            document.getElementById('eventTitle').textContent = `⚠️ ${event.title}`;
            document.getElementById('eventBody').textContent = event.description;
            DOM.eventModal.classList.add('active');
        }

        function continueFromEvent() {
            DOM.eventModal.classList.remove('active');
            if (state.wasPlayingBeforeEvent) togglePlayPause();
        }
        
        function getPerformanceFeedback(ror, benchmarkType = 'GENERAL') {
            const benchmarks = PERFORMANCE_BENCHMARKS[benchmarkType];
            if (!benchmarks) return null;
            let feedback = benchmarks[0]; 
            for (const benchmark of benchmarks) {
                if (ror >= benchmark.ror) feedback = benchmark;
                else break;
            }
            return feedback;
        }
        
        function showEndGameModal() {
            const finalRoR = (state.equity - CONFIG.INITIAL_BALANCE) / CONFIG.INITIAL_BALANCE;
            
            // Calculate actual simulation days from data
            let simulationDays = CONFIG.SIMULATION_DURATION_DAYS;
            if (state.gameData.length > 1) {
                simulationDays = (state.gameData[state.gameData.length-1].time - state.gameData[0].time) / 86400000;
            }
            
            // Calculate Annualized RoR
            let annualizedRoR = 0;
            if (simulationDays > 0) {
                const annualizationFactor = 365 / simulationDays;
                if (1 + finalRoR > 0) {
                    annualizedRoR = Math.pow(1 + finalRoR, annualizationFactor) - 1;
                } else {
                    annualizedRoR = -1; // Handle total loss or negative base
                }
            }
            
            document.getElementById('finalScore').textContent = `${Math.round(state.equity)} 分`;
            // 修改：強調模擬性質
            document.getElementById('finalRoR').style.display = 'none';
            
            const totalDuration = 60;
            const elapsedTimeInSeconds = totalDuration - state.remainingTime;
            const minutes = Math.floor(elapsedTimeInSeconds / 60);
            const seconds = elapsedTimeInSeconds % 60;
            document.getElementById('finalTime').textContent = `遊戲時間: ${minutes}分 ${seconds.toString().padStart(2, '0')}秒`;
            
            // Performance Feedback
            const feedbackGeneral = getPerformanceFeedback(annualizedRoR, 'GENERAL');
            const feedbackFund = getPerformanceFeedback(annualizedRoR, 'FUND');
            let feedbackHTML = '';
            if (feedbackGeneral && feedbackFund) {
                // 修改：標題改為基礎評估與進階評估
                feedbackHTML = `<div class="performance-feedback" style="text-align: left; margin-top: 20px; padding: 15px; background-color: var(--color-bg); border-radius: var(--radius-main);"><h3 style="text-align: center; margin-bottom: 10px;">📊 模擬表現分析</h3><p style="margin-top: 10px;"><strong>基礎評估：</strong><br>${feedbackGeneral.text}</p><p style="margin-top: 10px;"><strong>進階評估：</strong><br>${feedbackFund.text}</p></div>`;
            }
            
            // Statistics
            const totalTrades = state.tradeHistory.length;
            const winRate = totalTrades > 0 ? (state.tradeHistory.filter(t => t.profit > 0).length / totalTrades) * 100 : 0;
            const totalProfit = state.tradeHistory.reduce((sum, t) => sum + t.profit, 0);
            // 修改：標籤強調模擬性質
            document.getElementById('endGameStats').innerHTML = `${feedbackHTML}<div style="margin-top: 20px; padding-top: 10px; border-top: 1px solid var(--color-border); text-align: left;"><p><strong>交易統計：</strong></p><ul style="list-style-position: inside; padding-left: 10px;"><li>總交易次數: ${totalTrades}</li><li>勝率: ${winRate.toFixed(2)}%</li><li>累積學習點數: ${Math.round(totalProfit)} 點</li></ul></div>`;
            
            displayAchievements();
            DOM.endGameModal.classList.add('active');

            if (state.equity > CONFIG.INITIAL_BALANCE) {
                setTimeout(startCelebration, 100);
            }
        }

        const celebrationState = {
            canvas: null,
            ctx: null,
            particles: [],
            animationFrameId: null,
            lastBurstTime: 0,
            duration: 5000,
            startTime: 0,
        };

        function startCelebration() {
            celebrationState.canvas = document.getElementById('celebrationCanvas');
            if (!celebrationState.canvas) return;
            celebrationState.ctx = celebrationState.canvas.getContext('2d');

            const dpr = window.devicePixelRatio || 1;
            const rect = celebrationState.canvas.parentElement.getBoundingClientRect();
            celebrationState.canvas.width = rect.width * dpr;
            celebrationState.canvas.height = rect.height * dpr;
            celebrationState.ctx.scale(dpr, dpr);

            celebrationState.particles = [];
            celebrationState.startTime = performance.now();
            celebrationState.lastBurstTime = 0;

            if (celebrationState.animationFrameId) {
                cancelAnimationFrame(celebrationState.animationFrameId);
            }
            celebrationState.animationFrameId = requestAnimationFrame(celebrationLoop);
        }

        function celebrationLoop(timestamp) {
            const { ctx, canvas, particles } = celebrationState;
            if (!ctx || !canvas) return;

            const elapsed = timestamp - celebrationState.startTime;

            if (elapsed > celebrationState.duration) {
                cancelAnimationFrame(celebrationState.animationFrameId);
                celebrationState.animationFrameId = null;
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                return;
            }

            if (timestamp - celebrationState.lastBurstTime > 400) {
                celebrationState.lastBurstTime = timestamp;
                const x = Math.random() * canvas.width / (window.devicePixelRatio || 1);
                const y = Math.random() * canvas.height / (window.devicePixelRatio || 1) * 0.7;
                createCelebrationFireworks(x, y, 80);
            }

            ctx.clearRect(0, 0, canvas.width, canvas.height);
            const gravity = 0.1;
            for (let i = particles.length - 1; i >= 0; i--) {
                const p = particles[i];
                p.vy += gravity;
                p.x += p.vx;
                p.y += p.vy;
                p.lifespan--;

                if (p.lifespan <= 0) {
                    particles.splice(i, 1);
                    continue;
                }

                const opacity = Math.max(0, p.lifespan / p.initialLifespan);
                ctx.globalAlpha = opacity;
                ctx.fillStyle = p.color;
                ctx.beginPath();
                ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                ctx.fill();
            }
            ctx.globalAlpha = 1.0;

            celebrationState.animationFrameId = requestAnimationFrame(celebrationLoop);
        }

        function createCelebrationFireworks(x, y, count) {
            const colors = ['#ffc700', '#ff004d', '#00e0ff', '#2bff88', '#ffffff'];
            for (let i = 0; i < count; i++) {
                const angle = Math.random() * Math.PI * 2;
                const speed = Math.random() * 4 + 1;
                const vx = Math.cos(angle) * speed;
                const vy = Math.sin(angle) * speed;
                const color = colors[Math.floor(Math.random() * colors.length)];
                const size = Math.random() * 2 + 1;
                const lifespan = Math.random() * 50 + 40;
                celebrationState.particles.push({ x, y, vx, vy, color, size, lifespan, initialLifespan: lifespan });
            }
        }

        // V11.0: Updated Tutorial Steps (including new features)
        // Define steps dynamically to handle mobile/desktop differences correctly
        // 修改：教學引導文字，強調學習和虛擬帳戶
        const TUTORIAL_STEPS = [
            { selector: '.header', message: '歡迎！本次模擬挑戰目標是在7日內學習交易並提升績效。您可以在頂部追蹤虛擬帳戶狀態和進度。', action: 'next' },
            // V11.0 (Feature 3 update)
            { selector: '.chart-container-v9', message: '圖表區域已最大化。拖曳查看歷史數據，使用滑鼠滾輪或手機雙指縮放 (Pinch-to-Zoom) 查看細節。', action: 'next' },
            // V11.0 (Feature 2 update)
            { 
                selector: '#btnToggleControls', 
                message: '圖表設定預設已收合並以半透明顯示。點擊此按鈕展開速度控制和縮放選項。', 
                action: 'next' 
            },
            // V9.0: New step for the bottom navigation/tabs (dynamically adapts)
            { 
                dynamicSelector: () => state.isMobile ? '.bottom-nav-bar-v9' : '.main-container-v9 .bottom-nav-bar-v9', 
                dynamicMessage: () => state.isMobile ? '使用底部導航欄切換「下單」和「倉位/紀錄」頁面。' : '使用側邊欄頂部的頁籤切換「下單」和「倉位/紀錄」面板。',
                action: 'next' 
            },
            // V9.0: Ensure 'Order' tab is active before highlighting controls
            { selector: '#tabOrder', message: '下單介面集中在此。', action: 'ensureActiveTabOrder', skipDraw: true },
            { selector: '.order-controls', message: '設定停損(SL)、手數和停利(TP)。在輸入框上按住並左右拖動 (Scrubbing) 可快速調整數值。', action: 'next' },
             // V11.0 (Feature 1 New Step)
            { 
                selector: '.chart-wrap', 
                message: '當您設定 SL/TP 價格後，圖表上會顯示對應的價格線。您可以直接【拖曳】這些線條來快速微調價格。', 
                action: 'demoSLTPInput' // Add a helper action to populate inputs for demo
            },
            // V10.0: Updated message for 3-button layout
            { selector: '.trade-actions', message: '點擊「賣出」、「全部平倉」或「買入」進行交易。', action: 'next' },
            // V10.0: Updated final step as the button is moved.
            { selector: '.order-info-bar', message: '您可以在此查看預估的停損/停利金額。祝您模擬順利！', action: 'next' },
        ];
        let currentTutorialStep = 0;

        function startTutorial() {
            // if (state.isPlaying) togglePlayPause(); // Game now runs during tutorial
            state.tutorialActive = true;
            currentTutorialStep = 0;
            showTutorialStep();
        }

        // V9.0: Helper for tutorial actions
        function ensureActiveTab(tabId) {
            const tabContent = document.getElementById(tabId);
            if (!tabContent.classList.contains('active')) {
                const navButton = document.querySelector(`.nav-btn-v9[data-target="${tabId}"]`);
                if (navButton) {
                    // Manually trigger the switch logic instead of relying on click() which might be blocked
                    handleNavigationTabSwitch({ target: navButton });
                }
            }
        }

        // V11.0: Helper to demo SL/TP input for tutorial
        function demoSLTPInput() {
            const currentPrice = getCurrentPrice();
            if (currentPrice > 0) {
                // Set SL/TP roughly 10 units away
                DOM.inputSL.value = (currentPrice - 10).toFixed(2);
                DOM.inputTP.value = (currentPrice + 10).toFixed(2);
                updateUI(); // Trigger redraw to show the lines
            }
        }


        function showTutorialStep() {
            if (currentTutorialStep >= TUTORIAL_STEPS.length) {
                endTutorial();
                return;
            }

            const step = TUTORIAL_STEPS[currentTutorialStep];
            
            // V11.0: Handle specific actions before resolving selectors
            if (step.action === 'ensureActiveTabOrder') {
                ensureActiveTab('tabOrder');
                // Proceed to the next step immediately if skipDraw is true
                if (step.skipDraw) {
                    currentTutorialStep++;
                    // Use setTimeout to allow UI to update after tab switch
                    setTimeout(showTutorialStep, 50); 
                    return;
                }
            } else if (step.action === 'demoSLTPInput') {
                // Execute the demo action
                demoSLTPInput();
            }


            // V9.0: Resolve dynamic selectors/messages before use
            if (step.dynamicSelector) {
                step.selector = step.dynamicSelector();
                if (step.dynamicMessage) {
                     step.message = step.dynamicMessage();
                }
            }

            const element = document.querySelector(step.selector);
            
            // V9.0: Handle cases where the element might not be visible (e.g. inside inactive tab)
            // Check if element exists and is visible (offsetParent check), unless it's the nav bar itself
            if (!element || (element.offsetParent === null && !step.selector.includes('bottom-nav-bar-v9'))) {
                
                // If the element is inside a tab content, try activating the tab first (fallback)
                const parentTab = element ? element.closest('.tab-content-v9') : null;
                if (parentTab && !parentTab.classList.contains('active')) {
                    ensureActiveTab(parentTab.id);
                    setTimeout(showTutorialStep, 100); // Wait for activation
                    return;
                }
                
                // Fallback if element genuinely doesn't exist or is still hidden
                if (!element) {
                     console.warn("Tutorial element not found:", step.selector);
                     completeTutorialStep(); // Skip step
                     return;
                }
            }

            // V9.0 (R3): Ensure controls are collapsed if we are highlighting the toggle button
            if (step.selector === '#btnToggleControls' && !DOM.chartControls.classList.contains('controls-collapsed')) {
                toggleCollapsibleControls();
            }

            DOM.tutorialText.textContent = step.message;
            highlightElement(element);
            
            if (!DOM.tutorialMessage.classList.contains('hidden')) {
                DOM.tutorialNextBtn.classList.remove('hidden');
                DOM.tutorialNextBtn.onclick = completeTutorialStep;
            }
        }

        function completeTutorialStep() {
            if (!state.tutorialActive) return;
            currentTutorialStep++;
            showTutorialStep();
        }

        function endTutorial() {
            state.tutorialActive = false;
            state.tutorialCompletedOnce = true;
            DOM.tutorialHighlight.classList.add('hidden');
            DOM.tutorialMessage.classList.add('hidden');

            // V11.0: Clear the demo inputs (Feature 1)
            DOM.inputSL.value = "";
            DOM.inputTP.value = "";
            updateUI();

            // V9.0 (R3): Expand controls automatically after tutorial if they were collapsed
            if (DOM.chartControls.classList.contains('controls-collapsed')) {
                toggleCollapsibleControls();
            }

            // Game is started by startGame, so no need to toggle here.
            // if (!state.isPlaying && !state.isEnded) togglePlayPause();
        }

        // Optimized V7.3 (Kept in V9.0): Robust tutorial positioning
        function highlightElement(element) {
            const rect = element.getBoundingClientRect();
            const padding = 10;

            // V9.0 Check for zero dimensions
            if (rect.width === 0 && rect.height === 0) {
                DOM.tutorialHighlight.classList.add('hidden');
                DOM.tutorialMessage.classList.add('hidden');
                return;
            }

            // Position the highlight box
            DOM.tutorialHighlight.classList.remove('hidden');
            DOM.tutorialHighlight.style.top = `${rect.top + window.scrollY - padding}px`;
            DOM.tutorialHighlight.style.left = `${rect.left + window.scrollX - padding}px`;
            DOM.tutorialHighlight.style.width = `${rect.width + padding * 2}px`;
            DOM.tutorialHighlight.style.height = `${rect.height + padding * 2}px`;

            // Position the message bubble
            DOM.tutorialMessage.classList.remove('hidden');
            DOM.tutorialMessage.style.width = 'auto'; 
            const messageRect = DOM.tutorialMessage.getBoundingClientRect();
            
            // 1. Calculate potential positions (Above and Below)
            let positionAboveTop = rect.top + window.scrollY - messageRect.height - padding - 15;
            let positionBelowTop = rect.bottom + window.scrollY + padding + 15;

            // 2. Check visibility (Vertical)
            const viewportTop = window.scrollY;
            const viewportBottom = window.scrollY + window.innerHeight;
            const safetyMargin = 15;

            const spaceAbove = (rect.top + window.scrollY) - viewportTop;
            const spaceBelow = viewportBottom - (rect.bottom + window.scrollY);

            let finalMessageTop;

            // Prioritize placing below if there is enough space
            if (spaceBelow >= messageRect.height + safetyMargin * 2) {
                finalMessageTop = positionBelowTop;
            } 
            // Otherwise, try placing above if there is enough space
            else if (spaceAbove >= messageRect.height + safetyMargin * 2) {
                finalMessageTop = positionAboveTop;
            } 
            // If neither fits perfectly
            else {
                if (spaceBelow >= spaceAbove) {
                    finalMessageTop = viewportBottom - messageRect.height - safetyMargin;
                } else {
                    finalMessageTop = viewportTop + safetyMargin;
                }
            }

            // 3. Calculate horizontal position
            let messageLeft = rect.left + window.scrollX;
            
            // V9.0 Specific adjustment for desktop side panel (prefer placing message to the left)
            if (!state.isMobile && element.closest('.bottom-content-v9')) {
                 messageLeft = rect.left + window.scrollX - messageRect.width - padding - 15;
            }

            if (messageLeft + messageRect.width > window.innerWidth - safetyMargin) {
                messageLeft = window.innerWidth - messageRect.width - safetyMargin;
            }
            // Ensure messageLeft is not negative (can happen if desktop side panel adjustment pushes it off-screen left)
            messageLeft = Math.max(safetyMargin, messageLeft);

            DOM.tutorialMessage.style.top = `${finalMessageTop}px`;
            DOM.tutorialMessage.style.left = `${messageLeft}px`;
        }

        // ----------------------------------------------------------------------------
        // 8. 成就係統與市場監控 (Achievement System & Market Monitoring)
        // (All achievement and monitoring functions remain the same)
        // ----------------------------------------------------------------------------
        
        const SEVEN_DAYS_MS = 7 * 24 * 60 * 60 * 1000;
        function calculate7DayRange() {
            if (state.gameData.length === 0 || state.currentIndex <= 0) return { high: null, low: null };
            const endTime = state.gameData[state.currentIndex].time; 
            const startTime = endTime - SEVEN_DAYS_MS;
            
            let high = -Infinity, low = Infinity;
            // Look back from the previous bar
            for (let i = state.currentIndex - 1; i >= 0; i--) {
                const bar = state.gameData[i];
                if (bar.time < startTime && i < state.currentIndex - 1) break;
                high = Math.max(high, bar.high);
                low = Math.min(low, bar.low);
            }
            return { high: high === -Infinity ? null : high, low: low === Infinity ? null : low };
        }

        function check7DayBreakout() {
            if (state.currentIndex === 0) return;
            const range = state.current7DayRange;
            if (!range || range.high === null || range.low === null) return;
            
            const animatedBar = getAnimatedBar(state.gameData[state.currentIndex]);
            
            if (animatedBar.high > range.high && range.high !== state.lastAlertedHigh) {
                addChartAlertAnimation('BREAKOUT', range.high, state.currentIndex);
                state.lastAlertedHigh = range.high;
            }
            if (animatedBar.low < range.low && range.low !== state.lastAlertedLow) {
                addChartAlertAnimation('BREAKDOWN', range.low, state.currentIndex);
                state.lastAlertedLow = range.low;
            }
        }

        function unlockAchievement(key) {
            if (!state.unlockedAchievements.has(key)) {
                state.unlockedAchievements.add(key);
                const achievement = ACHIEVEMENTS[key];
                if (achievement) showNotification(`🏆 成就解鎖: ${achievement.title}`, achievement.description);
            }
        }

        function updateDailyStats() {
            if (state.gameData.length === 0 || state.currentIndex >= state.gameData.length) return;
            const currentDay = new Date(state.gameData[state.currentIndex].time).toDateString();
            const currentTotalPL = state.equity - CONFIG.INITIAL_BALANCE;

            if (state.achievementStats.currentDay !== currentDay) {
                state.achievementStats.currentDay = currentDay;
                state.achievementStats.dailyLossCount = 0;
                state.achievementStats.dailyMaxPL = currentTotalPL;
            }
            
            if (currentTotalPL > state.achievementStats.dailyMaxPL) {
                state.achievementStats.dailyMaxPL = currentTotalPL;
            }
        }

        function updateAchievementStats(closedTrade) {
            if (closedTrade.profit > 0) {
                state.achievementStats.consecutiveWins++;
                state.achievementStats.consecutiveLosses = 0;
            } else if (closedTrade.profit < 0) {
                state.achievementStats.consecutiveLosses++;
                state.achievementStats.consecutiveWins = 0;
                if (new Date(closedTrade.closeTime).toDateString() === state.achievementStats.currentDay) {
                   state.achievementStats.dailyLossCount++;
                }
            }
        }

        function checkTradeAchievements(trade) {
            if (state.tradeHistory.length >= 1) unlockAchievement('FIRST_TRADE');
            if (state.tradeHistory.length >= 10) unlockAchievement('TRADER_10');
            if (trade.profit > 3000) unlockAchievement('BIG_WIN');
            if (trade.profit < -3000) unlockAchievement('BIG_LOSS');
            if (state.achievementStats.consecutiveWins >= 3) unlockAchievement('WIN_STREAK_3');
            if (state.achievementStats.consecutiveLosses >= 3) unlockAchievement('LOSS_STREAK_3');
            if (trade.profit > 0 && (trade.closeTime - trade.entryTime) <= 3600000) unlockAchievement('QUICK_DRAW');
            if (state.achievementStats.dailyLossCount >= 3) unlockAchievement('BAD_DAY');
        }

        function checkEquityAchievements() {
            if (state.equity >= 20000) unlockAchievement('DOUBLE_UP');
            if (state.achievementStats.minEquity < 2000) unlockAchievement('MARGIN_CALL');
        }

        function checkDrawdownAchievement() {
            const currentTotalPL = state.equity - CONFIG.INITIAL_BALANCE;
            // Check if PL dropped significantly from the daily high
            if (state.achievementStats.dailyMaxPL > 0 && state.achievementStats.dailyMaxPL - currentTotalPL > 2000 && currentTotalPL < 0) {
                unlockAchievement('RUG_PULL');
            }
        }

        function checkDurationAchievements() {
            if (!state.gameData || state.currentIndex >= state.gameData.length) return;
            const currentTime = state.gameData[state.currentIndex].time;
            state.openPositions.forEach(pos => {
                if (currentTime - pos.entryTime > SEVEN_DAYS_MS) {
                    if (pos.profit > 0) unlockAchievement('HOLD_WIN_7D');
                    else if (pos.profit < 0) unlockAchievement('HOLD_LOSS_7D');
                }
            });
        }

        function checkFinalAchievements() {
            const totalTrades = state.tradeHistory.length;
            if (totalTrades >= 10) {
                const winRate = (state.tradeHistory.filter(t => t.profit > 0).length / totalTrades) * 100;
                if (winRate > 60) unlockAchievement('CONSISTENT');
            }
        }

        function displayAchievements() {
            const listElement = document.getElementById('achievementsList');
            const sectionElement = document.getElementById('achievementsSection');
            listElement.innerHTML = '';
            if (state.unlockedAchievements.size === 0) {
                sectionElement.style.display = 'none';
                return;
            }
            sectionElement.style.display = 'block';
            state.unlockedAchievements.forEach(key => {
                const achievement = ACHIEVEMENTS[key];
                if (achievement) {
                    const item = document.createElement('li');
                    item.className = 'achievement-item';
                    item.innerHTML = `<span class="achievement-icon">${achievement.icon}</span><div><strong>${achievement.title}</strong><p style="font-size: 12px; color: var(--color-text-secondary);">${achievement.description}</p></div>`;
                    listElement.appendChild(item);
                }
            });
        }

        function showNotification(title, message) {
            if (!DOM.notificationContainer) return;
            const toast = document.createElement('div');
            toast.className = 'notification-toast';
            toast.innerHTML = `<strong>${title}</strong><p>${message}</p>`;
            DOM.notificationContainer.insertBefore(toast, DOM.notificationContainer.firstChild);
            setTimeout(() => toast.classList.add('show'), 10);
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => {
                    if (DOM.notificationContainer.contains(toast)) DOM.notificationContainer.removeChild(toast);
                }, 500);
            }, 5000);
        }

        // ----------------------------------------------------------------------------
        // 9. 輔助函式 (Utility Functions)
        // ----------------------------------------------------------------------------
        
        // Scrubbing functionality (V11.0 Update)
        function setupInputScrubbing() {
            document.querySelectorAll('.input-field.scrubbable').forEach(input => {
                let isScrubbing = false;
                let startX = 0;
                let startValue = 0;
                const scrubStep = parseFloat(input.dataset.scrubStep) || 1;
                const inputId = input.id;
                const isLots = inputId === 'inputLots';
                const decimalPlaces = 2;

                const onScrubMove = (e) => {
                    if (!isScrubbing) return;
                    if (e.cancelable) e.preventDefault();

                    const clientX = e.clientX || (e.touches && e.touches[0].clientX);
                    const dx = clientX - startX;

                    const sensitivity = 10;
                    const steps = Math.floor(dx / sensitivity);

                    let newValue = startValue + steps * scrubStep;

                    if (isLots) {
                        if (newValue < 0.01) newValue = 0.01;
                    } else {
                        if (newValue < 0) {
                            newValue = 0;
                        }
                    }

                    const precisionFactor = Math.pow(10, decimalPlaces);
                    newValue = Math.round(newValue * precisionFactor) / precisionFactor;

                    if (newValue === 0 && !isLots) {
                        input.value = '';
                    } else {
                        input.value = newValue.toFixed(decimalPlaces);
                    }

                    // V11.0: Update UI instead of just EstimatedPL to redraw lines (Feature 1)
                    updateUI();
                };

                const onScrubEnd = () => {
                    if (!isScrubbing) return;
                    isScrubbing = false;
                    document.body.style.cursor = '';
                    window.removeEventListener('mousemove', onScrubMove);
                    window.removeEventListener('mouseup', onScrubEnd);
                    window.removeEventListener('touchmove', onScrubMove);
                    window.removeEventListener('touchend', onScrubEnd);
                };

                const onScrubStart = (e) => {
                    if (e.type === 'mousedown' && e.button !== 0) return;

                    if (document.activeElement === input && window.getSelection().toString()) {
                         return;
                    }

                    if (e.cancelable) e.preventDefault();

                    isScrubbing = true;
                    startX = e.clientX || (e.touches && e.touches[0].clientX);

                    let currentValue = parseFloat(input.value);

                    if (isNaN(currentValue) || (!isLots && currentValue <= 0)) {
                         if (!isLots) {
                            const currentPrice = getCurrentPrice();
                            if (currentPrice > 0) {
                                startValue = currentPrice;
                            } else {
                                startValue = 0;
                            }
                         } else {
                            startValue = 0.10;
                         }
                    } else {
                        startValue = currentValue;
                    }


                    document.body.style.cursor = 'ew-resize';
                    window.addEventListener('mousemove', onScrubMove);
                    window.addEventListener('mouseup', onScrubEnd);
                    window.addEventListener('touchmove', onScrubMove, { passive: false });
                    window.addEventListener('touchend', onScrubEnd);
                };

                input.addEventListener('mousedown', onScrubStart);
                input.addEventListener('touchstart', onScrubStart, { passive: false });
            });
        }

        function formatDuration(ms) {
            if (ms < 0) ms = 0;
            const minutes = Math.floor(ms / 60000);
            const hours = Math.floor(minutes / 60);
            const days = Math.floor(hours / 24);
            if (days > 0) return `${days}天 ${hours % 24}小時`;
            if (hours > 0) return `${hours}小時 ${minutes % 60}分鐘`;
            if (minutes === 0) return `${Math.floor(ms / 1000)}秒`;
            return `${minutes}分鐘`;
        }

        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
